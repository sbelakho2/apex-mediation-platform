<linker>
  <!--
    Unity IL2CPP Link.xml Configuration for Apex Mediation SDK
    
    This file prevents Unity's IL2CPP managed code stripping from removing
    critical types that are accessed via reflection or serialization.
    
    Without this file, IL2CPP builds may strip:
    - JSON serialization types (JsonUtility)
    - Reflection-accessed classes
    - Platform bridge implementations
    - Native interop types
    
    Documentation: https://docs.unity3d.com/Manual/ManagedCodeStripping.html
  -->
  
  <!-- Preserve entire Apex Mediation SDK assembly -->
  <assembly fullname="RivalApex.Mediation" preserve="all"/>
  
  <!-- Core SDK Types - Critical for runtime functionality -->
  <assembly fullname="RivalApex.Mediation">
    <!-- Main SDK Entry Point -->
    <type fullname="RivalApex.Mediation.ApexMediation" preserve="all"/>
    <type fullname="RivalApex.Mediation.SDKConfig" preserve="all"/>
    
    <!-- Ad Format Types -->
    <type fullname="RivalApex.Mediation.ApexBanner" preserve="all"/>
    <type fullname="RivalApex.Mediation.ApexInterstitial" preserve="all"/>
    <type fullname="RivalApex.Mediation.ApexRewarded" preserve="all"/>
    <type fullname="RivalApex.Mediation.ApexRewardedInterstitial" preserve="all"/>
    
    <!-- Network Layer - Used by UnityWebRequest -->
    <type fullname="RivalApex.Mediation.AuctionClient" preserve="all"/>
    <type fullname="RivalApex.Mediation.AuctionRequest" preserve="all"/>
    <type fullname="RivalApex.Mediation.AuctionResponse" preserve="all"/>
    <type fullname="RivalApex.Mediation.AdCreative" preserve="all"/>
    
    <!-- Consent & Privacy - Serialized to PlayerPrefs -->
    <type fullname="RivalApex.Mediation.ConsentManager" preserve="all"/>
    <type fullname="RivalApex.Mediation.ConsentData" preserve="all">
      <method signature="System.Void .ctor()" preserve="all"/>
      <field name="gdpr_applies" preserve="all"/>
      <field name="gdpr_consent_string" preserve="all"/>
      <field name="ccpa_opt_out" preserve="all"/>
      <field name="coppa" preserve="all"/>
    </type>
    
    <!-- TCF Parser - Used via reflection in some CMPs -->
    <type fullname="RivalApex.Mediation.TCFParser" preserve="all"/>
    <type fullname="RivalApex.Mediation.TCFParser+TcfCore" preserve="all">
      <field name="GdprApplies" preserve="all"/>
      <field name="Purpose1Consent" preserve="all"/>
      <field name="PurposeConsents" preserve="all"/>
      <field name="VendorConsents" preserve="all"/>
      <field name="SpecialFeatureOptIns" preserve="all"/>
      <field name="Raw" preserve="all"/>
    </type>
    
    <!-- Platform Bridges - Reflection and P/Invoke -->
    <type fullname="RivalApex.Mediation.IPlatformBridge" preserve="all"/>
    <type fullname="RivalApex.Mediation.IOSPlatformBridge" preserve="all"/>
    <type fullname="RivalApex.Mediation.AndroidPlatformBridge" preserve="all"/>
    <type fullname="RivalApex.Mediation.StandalonePlatformBridge" preserve="all"/>
    
    <!-- Models - JSON Serialization via JsonUtility -->
    <type fullname="RivalApex.Mediation.AdError" preserve="all">
      <field name="code" preserve="all"/>
      <field name="message" preserve="all"/>
      <field name="domain" preserve="all"/>
    </type>
    
    <type fullname="RivalApex.Mediation.AdSize" preserve="all">
      <field name="width" preserve="all"/>
      <field name="height" preserve="all"/>
    </type>
    
    <type fullname="RivalApex.Mediation.RewardItem" preserve="all">
      <field name="type" preserve="all"/>
      <field name="amount" preserve="all"/>
    </type>
    
    <!-- Telemetry & Logging -->
    <type fullname="RivalApex.Mediation.Logger" preserve="all"/>
    <type fullname="RivalApex.Mediation.TelemetryEvent" preserve="all">
      <field name="event_type" preserve="all"/>
      <field name="timestamp" preserve="all"/>
      <field name="session_id" preserve="all"/>
      <field name="data" preserve="all"/>
    </type>
    
    <!-- Creative Rendering -->
    <type fullname="RivalApex.Mediation.CreativeRenderer" preserve="all"/>
  </assembly>
  
  <!-- Unity Core Types - Required for IL2CPP -->
  <assembly fullname="UnityEngine">
    <type fullname="UnityEngine.PlayerPrefs" preserve="all"/>
    <type fullname="UnityEngine.Application" preserve="all"/>
    <type fullname="UnityEngine.SystemInfo" preserve="all"/>
    <type fullname="UnityEngine.Screen" preserve="all"/>
    <type fullname="UnityEngine.MonoBehaviour" preserve="all"/>
    <type fullname="UnityEngine.GameObject" preserve="all"/>
    <type fullname="UnityEngine.Transform" preserve="all"/>
    <type fullname="UnityEngine.Networking.UnityWebRequest" preserve="all"/>
    <type fullname="UnityEngine.Networking.UnityWebRequestAsyncOperation" preserve="all"/>
    <type fullname="UnityEngine.Networking.DownloadHandler" preserve="all"/>
    <type fullname="UnityEngine.Networking.UploadHandler" preserve="all"/>
  </assembly>
  
  <!-- Unity UI Types - For banner ad rendering -->
  <assembly fullname="UnityEngine.UI">
    <type fullname="UnityEngine.UI.Image" preserve="all"/>
    <type fullname="UnityEngine.UI.RawImage" preserve="all"/>
    <type fullname="UnityEngine.UI.Button" preserve="all"/>
    <type fullname="UnityEngine.UI.CanvasScaler" preserve="all"/>
  </assembly>
  
  <!-- .NET System Types - Reflection and Serialization -->
  <assembly fullname="mscorlib">
    <type fullname="System.Collections.Generic.Dictionary`2" preserve="all"/>
    <type fullname="System.Collections.Generic.List`1" preserve="all"/>
    <type fullname="System.Action" preserve="all"/>
    <type fullname="System.Action`1" preserve="all"/>
    <type fullname="System.Func`1" preserve="all"/>
    <type fullname="System.Func`2" preserve="all"/>
    <type fullname="System.Convert" preserve="all"/>
    <type fullname="System.BitConverter" preserve="all"/>
    <type fullname="System.Text.Encoding" preserve="all"/>
  </assembly>
  
  <!-- Preserve all types with Serializable attribute -->
  <type fullname="System.SerializableAttribute" preserve="all"/>
  
  <!-- Preserve all types with JsonUtility -->
  <type fullname="UnityEngine.JsonUtility" preserve="all"/>
</linker>
