name: iOS â€” Generate API Baseline (manual)

on:
  workflow_dispatch:
    inputs:
      targetModule:
        description: "Swift module name"
        required: false
        default: "RivalApexMediationSDK"

jobs:
  generate-baseline:
    name: Generate Swift API baseline and open PR
    runs-on: macos-13
    steps:
      - uses: actions/checkout@v4

      - name: Generate baseline
        working-directory: sdk/core/ios
        run: |
          chmod +x ./scripts/generate-api-baseline.sh
          ./scripts/generate-api-baseline.sh

      - name: Commit baseline changes
        uses: peter-evans/create-pull-request@v6
        with:
          commit-message: "iOS: add/refresh Swift API digester baseline"
          title: "iOS: Add/refresh Swift API digester baseline"
          body: |
            This PR adds or refreshes the Swift API digester baseline file under `sdk/core/ios/.api-baseline/`.

            Notes:
            - CI will now enforce breaking-change detection against this baseline on pull requests.
            - If you intentionally introduced breaking changes, update the version (semver-major) and include migration notes.
          add-paths: |
            sdk/core/ios/.api-baseline/*.json
          branch: chore/ios-api-baseline-update
          delete-branch: true
