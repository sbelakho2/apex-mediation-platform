{
  "annotations": { "list": [] },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "type": "stat",
      "title": "Events Enqueued (5m)",
      "targets": [
        {
          "expr": "sum(increase(analytics_events_enqueued_total[5m]))",
          "legendFormat": "enqueued"
        }
      ],
      "gridPos": { "w": 6, "h": 4, "x": 0, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "fixed", "fixedColor": "blue" }
        }
      }
    },
    {
      "type": "stat",
      "title": "Events Written (5m)",
      "targets": [
        {
          "expr": "sum(increase(analytics_events_written_total[5m]))",
          "legendFormat": "written"
        }
      ],
      "gridPos": { "w": 6, "h": 4, "x": 6, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "color": { "mode": "fixed", "fixedColor": "green" }
        }
      }
    },
    {
      "type": "stat",
      "title": "Events Failed (5m)",
      "targets": [
        {
          "expr": "sum(increase(analytics_events_failed_total[5m]))",
          "legendFormat": "failed"
        }
      ],
      "gridPos": { "w": 6, "h": 4, "x": 12, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "unit": "short",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "green" },
               { "value": "${failed_warn}", "color": "yellow" },
               { "value": "${failed_crit}", "color": "red" }
            ]
          }
        }
      }
    },
    {
      "type": "stat",
      "title": "Write Success Rate",
      "targets": [
        {
          "expr": "sum(rate(analytics_events_written_total[5m])) / (sum(rate(analytics_events_written_total[5m])) + sum(rate(analytics_events_failed_total[5m]))) * 100",
          "legendFormat": "success %"
        }
      ],
      "gridPos": { "w": 6, "h": 4, "x": 18, "y": 0 },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 2,
          "thresholds": {
            "mode": "absolute",
            "steps": [
              { "value": null, "color": "red" },
               { "value": "${success_warn}", "color": "yellow" },
               { "value": "${success_pass}", "color": "green" }
            ]
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Analytics Events by Kind",
      "targets": [
        {
          "expr": "sum by (kind) (rate(analytics_events_enqueued_total[5m]))",
          "legendFormat": "{{kind}} enqueued"
        },
        {
          "expr": "sum by (kind) (rate(analytics_events_written_total[5m]))",
          "legendFormat": "{{kind}} written"
        }
      ],
      "gridPos": { "w": 12, "h": 8, "x": 0, "y": 4 },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Analytics Events Failed by Kind",
      "targets": [
        {
          "expr": "sum by (kind) (rate(analytics_events_failed_total[5m]))",
          "legendFormat": "{{kind}}"
        }
      ],
      "gridPos": { "w": 12, "h": 8, "x": 12, "y": 4 },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": { "mode": "palette-classic" },
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 10
          }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Tracking Rate Limited",
      "targets": [
        {
          "expr": "sum(rate(tracking_rate_limited_total[5m]))",
          "legendFormat": "rate limited"
        }
      ],
      "gridPos": { "w": 8, "h": 8, "x": 0, "y": 12 },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": { "mode": "fixed", "fixedColor": "orange" }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Tracking Blocked",
      "targets": [
        {
          "expr": "sum(rate(tracking_blocked_total[5m]))",
          "legendFormat": "blocked"
        }
      ],
      "gridPos": { "w": 8, "h": 8, "x": 8, "y": 12 },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": { "mode": "fixed", "fixedColor": "red" }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Tracking HEAD Requests",
      "targets": [
        {
          "expr": "sum(rate(tracking_head_total[5m]))",
          "legendFormat": "HEAD requests"
        }
      ],
      "gridPos": { "w": 8, "h": 8, "x": 16, "y": 12 },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "color": { "mode": "fixed", "fixedColor": "blue" }
        }
      }
    },
    {
      "type": "timeseries",
      "title": "Event Queue Lag (enqueued vs written)",
      "targets": [
        {
          "expr": "sum(rate(analytics_events_enqueued_total[5m])) - sum(rate(analytics_events_written_total[5m]))",
          "legendFormat": "lag rate"
        }
      ],
      "gridPos": { "w": 12, "h": 8, "x": 0, "y": 20 },
      "fieldConfig": {
        "defaults": {
          "unit": "reqps",
          "custom": {
            "lineWidth": 2,
            "fillOpacity": 20
          }
        }
      }
    },
    {
      "type": "table",
      "title": "Event Kind Summary (1h)",
      "targets": [
        {
          "expr": "sum by (kind) (increase(analytics_events_enqueued_total[1h]))",
          "legendFormat": "{{kind}}",
          "format": "table",
          "instant": true
        },
        {
          "expr": "sum by (kind) (increase(analytics_events_written_total[1h]))",
          "legendFormat": "{{kind}}",
          "format": "table",
          "instant": true
        },
        {
          "expr": "sum by (kind) (increase(analytics_events_failed_total[1h]))",
          "legendFormat": "{{kind}}",
          "format": "table",
          "instant": true
        }
      ],
      "gridPos": { "w": 12, "h": 8, "x": 12, "y": 20 },
      "transformations": [
        {
          "id": "merge",
          "options": {}
        },
        {
          "id": "organize",
          "options": {
            "renameByName": {
              "kind": "Event Kind",
              "Value #A": "Enqueued",
              "Value #B": "Written",
              "Value #C": "Failed"
            }
          }
        }
      ]
    }
  ],
  "refresh": "30s",
  "schemaVersion": 36,
  "style": "dark",
  "tags": ["tracking", "analytics", "ingest"],
  "templating": {
    "list": [
      {
        "name": "failed_warn",
        "type": "textbox",
        "label": "Failed warn",
        "query": "10",
        "current": { "text": "10", "value": "10" }
      },
      {
        "name": "failed_crit",
        "type": "textbox",
        "label": "Failed crit",
        "query": "100",
        "current": { "text": "100", "value": "100" }
      },
      {
        "name": "success_warn",
        "type": "textbox",
        "label": "Success warn %",
        "query": "95",
        "current": { "text": "95", "value": "95" }
      },
      {
        "name": "success_pass",
        "type": "textbox",
        "label": "Success pass %",
        "query": "99",
        "current": { "text": "99", "value": "99" }
      }
    ]
  },
  "timezone": "",
  "title": "Tracking & Ingest",
  "uid": "tracking-ingest",
  "version": 1
}
