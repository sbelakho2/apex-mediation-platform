# SDK Focus Plan — Android and iOS (2025-11-08)

Purpose
- Capture the pivot back to SDK development with concrete, checkable tasks to reach Sandbox Readiness quickly while preserving world‑class DX, zero‑ANR guarantees, privacy/compliance, and documentation excellence.
- This plan is coding‑first, offline‑test‑driven, cost‑bounded (≤ $500/month total ops, including LLM usage), and designed for a single operator to manage.

Scope
- Android SDK (core + facades): Interstitial, Rewarded, Banner, App Open
- iOS SDK (Swift Package): Interstitial, Rewarded, Debug Panel, Demo target
- Documentation: Quickstarts, API docs, SDKs index, troubleshooting, test matrix

Guiding principles
- No network/disk on main thread; prove with StrictMode (Android) and main‑queue tests (iOS)
- Signed, schema‑validated OTA config with kill‑switch; no secrets in client
- Normalized error taxonomy; clear, structured logs; built‑in debugging tools
- Consent privacy correctness (TCF v2.2/GPP/USP/COPPA), data minimization
- Tiny, stable, boring public API; superb docs and samples

Top outcomes (acceptance criteria)
- Android
  - StrictMode sample + CI smoke gate: no main‑thread I/O during initialize() and load/show
  - AAR ≤ 500 KB (warn > 450 KB) enforced by validator
  - Facades: BelInterstitial/BelRewarded/BelBanner/BelAppOpen fully covered by Robolectric tests
  - OTA config: Ed25519 verification on (non‑test); schema validation and kill‑switch proven by tests
  - API docs generated by Dokka; Java ergonomics validated (@JvmOverloads on core APIs)
- iOS
  - Demo target with mocked endpoints; UI smoke ensures main‑queue callbacks and no crash on no_fill
  - Taxonomy tests (429, 5xx, 204 no_fill, malformed JSON → error); consent propagation matrix
  - Debug Panel shows appId, placements, redacted consent snapshot; documented in Quickstart
- Docs
  - Android and iOS Quickstarts up‑to‑date; SDKs index page added; troubleshooting + FAQ
  - “Sandbox Readiness — SDKs” checklist with test commands and evidence paths

Work breakdown (checklist)

1) Android — Reliability & DX
- [ ] StrictMode sample app module (mock config + auction); enable penaltyDeath in debug
- [ ] CI smoke gate task to run sample with StrictMode and fail on violations
- [ ] Public APIs: audit and add @JvmOverloads to any missed facade methods
- [ ] Facade tests: complete coverage for BelBanner adaptive sizing & detach; BelAppOpen cold‑start semantics
- [ ] Integration Validator: enforce INTERNET permission and clear‑text config hints; fail > 500 KB; warn > 450 KB
- [ ] OTA config: add negative test for bad Base64 public key; ensure bypass in testMode only
- [ ] Dokka generation included in CI artifact; publish local HTML in build/dokka/html

2) iOS — Parity & Demo
- [ ] Create Demo app target (mock endpoints) with Interstitial + Rewarded flows
- [ ] UI smoke test: main‑queue callbacks; graceful no_fill; taxonomy spot checks
- [ ] Extend unit tests: 429 non‑retry; 5xx status_5xx; malformed JSON → error
- [ ] Consent matrix tests (gdpr_applies, us_privacy, coppa) → auction metadata
- [ ] Debug Panel enrichment: redacted consent snapshot; show SDK/version
- [ ] Quickstart updates with Demo usage and Debug Panel

3) Documentation & Readiness
- [ ] SDKs index page linking Android/iOS Quickstarts and Debugging guides
- [ ] Troubleshooting/FAQ pages (common errors, invalid placement, config signature, network timeouts)
- [ ] Sandbox Readiness — SDKs checklist with exact test commands and evidence file paths

Test matrix (commands)
- Android unit + Robolectric: `./gradlew :sdk:core:android:test`
- Android StrictMode sample smoke (to add): `./gradlew :sdk:core:android:sample:connectedCheck` (CI: penaltyDeath)
- iOS SwiftPM tests: `cd sdks/ios && swift test`

Cost & safety
- All tasks are offline/test‑driven; no external network costs required.
- LLM usage kept under daily caps (see COST_BUDGET_POLICY.md); autonomy runs in dry‑run as needed.

Deliverables
- Passing test suites (Android/iOS), generated API docs, updated Quickstarts, SDKs index, and Sandbox Readiness checklist boxes checked.

Ownership & cadence
- Primary executor: autonomy/engineering bot + single operator review
- Cadence: daily small PRs, weekly summary PR that updates DEVELOPMENT_TODO_CHECKLIST with evidence links
