# AD-Project File-by-File Analysis

_Last updated: 2025-11-14 00:00 UTC_
_Owner: Platform Engineering 

## Objectives
- Provide a repeatable, auditable record of what every file in the repository does, its dependencies, and its current health.
- Capture follow-up actions (defects, debt, docs gaps) as we review individual files.
- Enable incremental updates as the codebase evolves by organizing the analysis by top-level areas.

## Scope & Order of Operations
We will progress directory by directory so that work remains reviewable and can be parallelized later if needed. Each section below mirrors the repo’s top-level layout and will be checked off once **every file** within that section has been captured in the log.

1. Root files (repository top level)
2. `backend/`
3. `console/`
4. `data/` & `ML Data/`
5. `docs/`
6. `infrastructure/`, `monitoring/`, `logs/`
7. `ML/`
8. `models/`
9. `packages/` & `Packages/`
10. `quality/`
11. `scripts/`
12. `sdk/` & `sdks/`
13. `services/`
14. `website/`
15. Remaining folders (`packages/web-sdk`, vendor SDKs, etc.)

> ⚠️ **Expectation:** Each section must contain an entry for every file (source, config, schema, migration, etc.). Generated artifacts (lockfiles, build caches) will be summarized if they are deterministic.

## Data Capture Template
For every file we will record the following fields:

| Field | Description |
| --- | --- |
| Path | Absolute path within repo |
| Type | Source / Config / Doc / Script / Asset / Generated |
| Summary | Short description of purpose and key behaviors |
| Dependencies | Notable internal/external deps referenced |
| Risks / TODOs | Bugs, debt, missing tests, stale docs, etc. |
| Evidence | Links to tests, docs, or commands validating behavior |

## Recording Method
- Use this Markdown file as the canonical log. Each top-level section below contains nested subsections mirroring the directory tree.
- Whenever we finish reviewing a file, add a bullet under its directory with the template above (concise inline format is acceptable to keep the document readable).
- Cross-link to existing docs (e.g., `docs/Internal/Development/DEVELOPMENT_TODO_CHECKLIST.md`) instead of duplicating detail.

## Progress Tracker
The following checklist mirrors the TODO list maintained in `DEVELOPMENT_TODO_CHECKLIST.md`. Update both places as you progress to keep stakeholders in sync.

- [ ] Root-level files analyzed
- [ ] `backend/`
- [ ] `console/`
- [ ] `data/` & ML datasets
- [ ] `docs/`
- [ ] `infrastructure/`, `monitoring/`, `logs/`
- [ ] `ML/`
- [x] `models/`
- [x] `packages/`, `Packages/`
- [x] `quality/`
- [x] `scripts/`
- [x] `sdk/`, `sdks/`
- [x] `services/`
- [ ] `website/`
- [ ] Remaining folders / verification

## Section Logs

### Root-Level Files

- `docker-compose.yml` — **Type:** Config (Docker Compose v3.9). **Summary:** Spins up backend (Node), console (Next.js), Postgres 16, Redis 7, ClickHouse 23.9, plus optional ML CPU/GPU training workers sharing the repo via bind mounts. **Dependencies:** Backend migrations auto-run via `/backend/migrations`, ML containers depend on `Dockerfile.ml*`. **Risks/TODOs:** Secrets (JWT, DB creds) are placeholder defaults; ClickHouse lacks a persistent volume; only backend is exposed to console (no website). **Evidence:** File reviewed 2025‑11‑14; run `docker compose up` for integrated stack.
- `Dockerfile.ml` — **Type:** Config (Docker image). **Summary:** Python 3.12 slim image installing `ML/requirements.txt`, copies ML + scripts, sets entrypoint to `scripts/ml/train_models.py`. **Dependencies:** Pip requirements; host repo volume when used via compose. **Risks/TODOs:** No caching between installs; CPU-only so heavy torch jobs may be slow. **Evidence:** Compose profile `ml` references this file.
- `Dockerfile.ml-gpu` — **Type:** Config. **Summary:** Based on `pytorch/pytorch:2.5.1-cuda12.4-cudnn9-runtime`, installs `requirements-gpu`, same entrypoint as CPU image, requires GPU reservations. **Dependencies:** CUDA 12 drivers on host; ML GPU requirements file. **Risks/TODOs:** No healthcheck; make sure host has matching NVIDIA runtime. **Evidence:** Compose service `ml-train-gpu` references this file.
- `Makefile` — **Type:** Build tooling. **Summary:** Provides four ML-focused phony targets: `ml.fetch`, `ml.prepare`, `ml.train`, `ml.train.gpu`; wraps Python scripts and docker compose runs with overridable dataset/output vars. **Dependencies:** `PYTHON` binary, `scripts/ml/*.py`, `docker compose`. **Risks/TODOs:** No general frontend/backend targets; consider adding lint/test aggregators later. **Evidence:** Reviewed file 2025‑11‑14.
- `package.json` — **Type:** Config (npm workspace root). **Summary:** Defines workspaces (`backend`, `console`, `packages/*`, `sdk/*`, `quality/*`, `tools/*`), shared scripts for build/test/lint/migrate/dev, devDependencies (TypeScript, Jest, ESLint, Prettier, Husky). **Dependencies:** Node ≥18/NPM ≥9, husky hooks, k6 for perf tests. **Risks/TODOs:** Root scripts run `npm run build --workspaces`, which can be slow; consider pnpm/turbo for scaling. **Evidence:** File reviewed 2025‑11‑14.
- `package-lock.json` — **Type:** Generated lockfile. **Summary:** Ensures deterministic installs for root tooling + shared devDependencies. **Dependencies:** npm; covers multi-workspace tree. **Risks/TODOs:** Very large; keep updated when new deps added to avoid drift. **Evidence:** Present at root, last regenerated 2025‑11‑12 (per git log – verify when diffing).
- `start-dev.sh` — **Type:** Script. **Summary:** Bash helper that prints friendly status and launches `console` dev server with mock data using `npm run dev`. **Dependencies:** Node/npm, console workspace. **Risks/TODOs:** Only starts console (no API); consider flag to boot backend via docker compose too. **Evidence:** Script reviewed 2025‑11‑14; shebang bash.
- `local.properties` — **Type:** Config (Android SDK path). **Summary:** Points Gradle to `/home/aaron/Android/Sdk`; standard Android studio artifact, intentionally not version-controlled (ignored via `.gitignore`). **Dependencies:** Android build tooling when working on native SDK. **Risks/TODOs:** Local-only; ensure devs don’t commit updates. **Evidence:** File timestamp 2025‑11‑12.
- `.gitignore` — **Type:** Config. **Summary:** Comprehensive ignore list covering Node, Python, Android, Unity, Terraform, Docker, ML datasets (Criteo, Avazu), SBOM outputs, bundle reports, etc. **Dependencies:** Git. **Risks/TODOs:** Currently ignores `gradlew` (but re-adds `sdk/core/android/gradlew.sh`); verify no required binaries are skipped. **Evidence:** Reviewed 2025‑11‑14.
- `Logo.jpg` — **Type:** Asset. **Summary:** Brand/logo image used in docs? (binary). **Dependencies:** Consumed by marketing materials. **Risks/TODOs:** No source PSD provided; ensure licensing tracked.
- `Solo_Execution_Business_Plan_AdStack_Bel_Consulting_OU.docx` — **Type:** Doc asset. **Summary:** Business plan reference; likely external facing. **Dependencies:** MS Word. **Risks/TODOs:** This belongs in repo and should be updated with most recent state of software.
- `Website.docx` — **Type:** Doc asset. **Summary:** Likely legacy website content plan; verify currency vs docs/Website sections. **Risks/TODOs:** Consider migrating into Markdown for easier diffing.
- `node_modules/` — **Type:** Generated directory. **Summary:** Root dependency install location (currently committed in workspace for caching but should stay ignored). **Risks/TODOs:** Ensure `.gitignore` prevents accidental commits; prefer per-workspace installs if size grows.

### backend/

- `.env.example` — **Type:** Config template. **Summary:** Minimal dev defaults for DB, ClickHouse, Redis, JWT, transparency knobs. **Dependencies:** Local Postgres/Redis/ClickHouse; transparency writer. **Risks/TODOs:** Includes placeholder secrets; ensure developers don’t reuse in prod. **Evidence:** Reviewed 2025‑11‑14.
- `.env.sample` — **Type:** Config template (annotated). **Summary:** Extensive sample with sections for DB, Redis, CORS, Stripe, Resend, OpenAI, feature flags, monitoring. **Dependencies:** External providers (Stripe, Resend, AWS, GCP). **Risks/TODOs:** Flags default to true; warn devs before enabling expensive services. **Evidence:** Reviewed 2025‑11‑14.
- `.eslintrc.cjs` — **Type:** Lint config. **Summary:** TS ESLint setup with project-based parser, rules for async misuse, overrides for controllers/tests/services. **Dependencies:** `@typescript-eslint/*`. **Risks/TODOs:** Relies on `tsconfig.eslint.json`; ensure IDE uses same root. **Evidence:** Reviewed file.
- `.gitignore` (backend) — **Type:** Config. **Summary:** Backend-specific ignore (dist, logs, coverage, env files). **Dependencies:** Git. **Risks/TODOs:** Verify `dist/` remains excluded in CI artifacts.
- `.transparency-metrics.log` — **Type:** Log artifact. **Summary:** Captures transparency writer test run (connections, breaker trips, ClickHouse errors). **Dependencies:** Observability scripts. **Risks/TODOs:** Contains timestamps/error messages; rotate or move to logs/ to avoid repo bloat.
- `BACKGROUND_JOBS.md` — **Type:** Doc. **Summary:** 600+ line deep dive into BullMQ queues (analytics, export, reports, metrics, cache warming, cleanup) with configs, payloads, schedules. **Dependencies:** `src/queues/**/*.ts`. **Risks/TODOs:** Need to confirm queue naming issue (“Queue name cannot contain :” seen in logs) is documented with fix. **Evidence:** Reviewed overview + queue sections.
- `Dockerfile` — **Type:** Build config (broken). **Summary:** Intended to be multi-stage Node build to distroless runtime, but file is badly corrupted with Kubernetes Deployment YAML interleaved (invalid Docker syntax). **Dependencies:** Node 20, distroless runtime. **Risks/TODOs:** HIGH – cannot build as-is; needs restoration (likely missing newline separators). Blocks container builds + fly deploy. **Evidence:** File inspection shows `metadata:`/`spec:` lines inside Dockerfile.
- `Dockerfile` referenced in `fly.toml` & `deploy-backend.sh`; fix required before deployments resume.
- `deploy-backend.sh` — **Type:** Script. **Summary:** Automates Fly.io deploy (staging/prod) with CLI checks, app creation, secret prompts, region scaling, post-deploy health checks. **Dependencies:** Fly CLI, curl, sed. **Risks/TODOs:** Mutation of `fly.toml` via `sed -i` for production may dirty repo; consider using env overlays. Requires manual confirmation for secrets.
- `fly.toml` — **Type:** Infra config. **Summary:** Fly.io app config (SJC region, docker build, HTTP checks, TLS, autoscaling triggers, log volume mount). **Dependencies:** Fly platform. **Risks/TODOs:** `PORT` mismatches (8080 here vs 4000 default). Ensure runtime `CMD` binds 8080 when deployed via Fly.
- `IMPLEMENTATION_SUMMARY.md` — **Type:** Doc. **Summary:** Tracks completion of exports, A/B tests, caching, background jobs, metrics; lists files/tests/perf impacts. **Dependencies:** Various services + migrations. **Risks/TODOs:** States “All features complete”; need to keep updated as new work added.
- `REDIS_CACHING.md` — **Type:** Doc. **Summary:** Detailed caching strategy (TTL tiers, vary-by, invalidation patterns, client API). **Dependencies:** `src/utils/redis.ts`, `src/middleware/cache.ts`. **Risks/TODOs:** Example TTL table uses TypeScript pseudo-code; confirm docs match current constants.
- `openapi.yaml` — **Type:** API spec. **Summary:** 900+ line OpenAPI 3.0.3 covering auth, RTB, migration studio, billing, etc., with schemas + security definitions. **Dependencies:** `@asteasolutions/zod-to-openapi`, swagger UI. **Risks/TODOs:** Ensure spec stays aligned with feature-flagged endpoints; consider splitting by domain to reduce merge conflicts.
- `package.json` — **Type:** Config. **Summary:** Scripts for dev/build/start/test/migrations, ClickHouse helpers, transparency verification, infisical-backed secure tasks; dependencies span Express, Stripe, Redis, BullMQ, ClickHouse. **Dependencies:** Node 20, ts-node, jest. **Risks/TODOs:** Some scripts still reference legacy `runMigrations.js` (not V2); verify both paths supported. Observed formatting glitch (indented fields) but JSON valid.
- `package-lock.json` — **Type:** Lockfile. **Summary:** Deterministic dependency tree for backend service. **Dependencies:** npm. **Risks/TODOs:** Keep in sync with `package.json`; remove unused packages (e.g., `openai` if not shipped).
- `tsconfig.json` / `tsconfig.eslint.json` — **Type:** Config. **Summary:** ES2020 target, `rootDir`=repo, includes `src/services/scripts`, outputs `dist`, excludes tests from build. ESLint variant narrows include to src/tests. **Dependencies:** `typescript` 5.5. **Risks/TODOs:** Build currently skips `tests` folder entirely; OK if tests compile via jest.
- `jest.config.cjs` — **Type:** Test config. **Summary:** `ts-jest` preset, node env, serialized runs (maxWorkers=1) to avoid DB contention, setup file `src/__tests__/setup.ts`, 10s timeout. **Dependencies:** jest, ts-jest. **Risks/TODOs:** Serial tests slow; consider DB container per worker.
- `.transparency-metrics.log` indicates queue init failures due to colon in queue names; action item to sanitize queue IDs.
- `deploy-backend.sh` & `fly.toml` rely on `Dockerfile`; unresolved corruption blocks release pipeline.
- `src/index.ts` — **Type:** Source. **Summary:** Express bootstrap wiring helmet, cors allowlist, CSRF double-submit, Redis-backed auth limiter, request context + Prometheus RED metrics, `/health`/`/metrics`, OpenAPI serve, and graceful shutdown. Initializes Postgres, ClickHouse, Redis, BullMQ queues sequentially with fallbacks. **Dependencies:** `initializeDatabase`, `initializeClickHouse`, `redis`, `initializeQueues`, `authRateLimiter`, `csrfProtection`, `promRegister`. **Risks/TODOs:** Health check always reports Postgres healthy without runtime check; `app.listen` always uses env `PORT` which conflicts with Fly config (8080 vs 4000). **Evidence:** File reviewed 2025‑11‑14.
- `src/routes/index.ts` — **Type:** Source. **Summary:** Central router mounting ~20 feature routers (revenue, analytics, RTB, billing, migration, etc.) behind `killSwitchGuard`. **Dependencies:** Each `*.routes.ts` module plus feature flags middleware. **Risks/TODOs:** Ordering matters for overlapping paths (e.g., `/admin` vs `/migration`); ensure new routes are added here and to OpenAPI spec. **Evidence:** Reviewed file 2025‑11‑14.
- `src/config/env.ts` — **Type:** Source. **Summary:** Zod schema validating env vars (DB, Redis, Stripe, feature flags, AWS/GCP). Automatically loads `.env` and throws with helpful tips when validation fails. **Dependencies:** `dotenv`, `zod`. **Risks/TODOs:** `CLICKHOUSE_URL` optional but `initializeClickHouse` expects URL; align defaults. **Evidence:** File reviewed 2025‑11‑14.
- `src/utils/logger.ts` — **Type:** Source. **Summary:** Winston logger with AsyncLocalStorage context injection, aggressive redaction, colorized dev output, JSON prod logs, plus file transports for `logs/error.log` & `logs/combined.log`. **Dependencies:** `winston`, `async_hooks`. **Risks/TODOs:** File transports write inside container; ensure writable volume in distroless image. **Evidence:** Reviewed 2025‑11‑14.
- `src/middleware/requestContext.ts` — **Type:** Source. **Summary:** Generates/propagates `x-request-id`, stores user/tenant context in async local storage, logs each request with context, exposes helper to retrieve context or create child loggers. **Dependencies:** `asyncLocalStorage`, `logger`. **Risks/TODOs:** Logging every request at info may be noisy; consider sampling for high-traffic RTB endpoints. **Evidence:** Reviewed 2025‑11‑14.
- `src/middleware/errorHandler.ts` — **Type:** Source. **Summary:** Express error handler distinguishing AppError vs unexpected, increments Prometheus counters, handles CSRF-specific errors with 403 response. **Dependencies:** `logger`, `errorCounter`. **Risks/TODOs:** Unexpected errors always return generic message (good), but AppError messages leak internal wording—audit before prod. **Evidence:** Reviewed 2025‑11‑14.
- `src/utils/prometheus.ts` — **Type:** Source. **Summary:** Initializes prom-client register and defines histograms/counters for HTTP, RTB, DB, billing, migration guardrails, auth, tracking, etc.; exposes `promRegister` for `/metrics`. **Dependencies:** `prom-client`. **Risks/TODOs:** Metric cardinality (`route` label on http_requests_total) can explode if paths contain IDs; consider templating. **Evidence:** Reviewed 2025‑11‑14.
- `src/middleware/redisRateLimiter.ts` — **Type:** Source. **Summary:** Redis sliding window limiter for sensitive routes; keys by route+IP, respects `RATE_LIMIT_AUTH_*`, fails open when Redis unavailable. **Dependencies:** `redis` util. **Risks/TODOs:** Throws if Redis not connected when increment called (but code guards). Rate window uses process env; ensure defaults align with global limiter. **Evidence:** Reviewed 2025‑11‑14.
- `src/middleware/csrf.ts` — **Type:** Source. **Summary:** `csurf` wrapper implementing double-submit cookie, customizing cookie flags, skipping for auth acquisition endpoints, exposing helper to issue tokens. **Dependencies:** `csurf`. **Risks/TODOs:** `bool` helper expects `.toLowerCase()` on string; undefined check done but `v.toLowerCase` may throw if not string—should guard. **Evidence:** Reviewed 2025‑11‑14.
- `src/utils/redis.ts` — **Type:** Source. **Summary:** Singleton Redis client with exponential backoff, connection lifecycle logging, typed helper methods (get/set/del pattern, TTL, incr, getOrSet) plus key builders and TTL constants. **Dependencies:** `redis` npm client, `logger`. **Risks/TODOs:** `incr` throws when redis not ready (caller must catch). Consider instrumentation to avoid noisy warn logs when Redis intentionally disabled. **Evidence:** Reviewed 2025‑11‑14.
- `src/routes/billing.routes.ts` — **Type:** Source. **Summary:** Billing API router gating all endpoints behind `requireFeature('billingEnabled')`, `authenticate`, and RBAC for reconcile POST. Maps to controller methods for usage, invoices, PDF download. **Dependencies:** `middleware/auth`, `utils/featureFlags`, `billing.controller`. **Risks/TODOs:** Doesn’t throttle expensive endpoints; consider additional limiter for PDF downloads. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/billing.controller.ts` — **Type:** Source. **Summary:** Implements billing endpoints (current usage, invoice list/detail/PDF, admin reconcile) using `UsageMeteringService`, `invoiceService`, `reconciliationService`, with AppError-based validation and audit logging. **Dependencies:** services modules, `AppError`, `logger`. **Risks/TODOs:** `idempotencyKey` read from body but spec says header; align to avoid confusion. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/billing/UsageMeteringService.ts` — **Type:** Source. **Summary:** Core billing usage service interfacing with Postgres, ClickHouse, and Stripe. Handles telemetry ingestion, plan limit calculations, overage pricing, Stripe meter events, limit alerts, and cron jobs. **Dependencies:** `pg`, `@clickhouse/client`, `stripe`. **Risks/TODOs:** Uses global Pool/ClickHouse clients per import (fine) but logs via `console` instead of `logger`; also references hard-coded plan tiers—consider moving to DB. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/invoiceService.ts` — **Type:** Source. **Summary:** Manages invoices (list/get, Stripe sync, PDF generation, ETag creation). Streams custom PDF via PDFKit and interacts with Stripe to create/finalize invoices. **Dependencies:** `pg`, `stripe`, `pdfkit`, `crypto`. **Risks/TODOs:** Hard-coded customer info placeholder in PDF; ensures compliance before prod. Need to ensure DB line_items column uses JSON. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/reconciliationService.ts` — **Type:** Source. **Summary:** Compares internal usage vs Stripe records, enforces 0.5% tolerance, records idempotent results, writes billing_audit entries, emits alerts for large discrepancies. **Dependencies:** `pg`, `stripe`, `logger`. **Risks/TODOs:** `stripe.subscriptionItems.listUsageRecordSummaries` typed as `any`; ensure API available in current Stripe SDK version. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/auth.controller.ts` — **Type:** Source. **Summary:** Full auth lifecycle (login, register, refresh, logout, 2FA flows) with zod validation, JWT access/refresh tokens, cookie helpers, Prometheus metrics, feature-flagged 2FA enforcement, and refresh token persistence. **Dependencies:** `bcryptjs`, `jsonwebtoken`, `ms`, `zod`, repositories (`userRepository`, `refreshTokenRepository`), `twofa.service`, `setAuthCookies`. **Risks/TODOs:** Large file (~550 LOC) mixing many concerns; consider splitting per area. `authAttemptsTotal` increments may double-count due to catch block increments. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/consent.controller.ts` — **Type:** Source. **Summary:** CRUD + validation endpoints for CMP consent artifacts (store/get/delete consent tied to `req.user`, validation for vendor/purposes, plus utility parsers for TCF 2.2 and GPP strings). **Dependencies:** `consentManagementService`, dynamic parser exports (`TCFv2Parser`, `GPPParser`), `logger`. **Risks/TODOs:** Parser endpoints skip auth entirely (could be intentional but document); relies on `req.user` injection—consider explicit guard middleware for consistency. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/dashboard.controller.ts` — **Type:** Source (placeholder). **Summary:** File exists but empty—no exports implemented yet. **Dependencies:** None. **Risks/TODOs:** Dead stub likely intended for future dashboard API; implement planned handlers. **Evidence:** Reviewed 2025‑11‑14 (0-byte file).
- `src/controllers/dataExport.controller.ts` — **Type:** Source. **Summary:** Handles data export + warehouse sync lifecycle (create/list jobs, status lookup, manual sync, local download) with zod validation and fs streaming for completed local exports. **Dependencies:** `dataExportService`, `zod`, Node `fs`, `logger`. **Risks/TODOs:** Minor lint issues (mis-indented `const body` declarations); download streams arbitrary filesystem path from job record—ensure paths are sanitized and storage isolation enforced. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/fraud.controller.ts` — **Type:** Source. **Summary:** Thin Express handlers exposing fraud stats, alerts, and breakdown by type; enforces `publisherId` presence and delegates to `fraudDetection` service helpers. **Dependencies:** `AppError`, `getFraudStatistics`, `listFraudAlerts`, `getFraudByType`. **Risks/TODOs:** `limit` query param only validated to be positive but lacks upper bound—add cap to prevent large result sets; relies on middleware to populate `req.user`. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/migration.controller.ts` — **Type:** Source. **Summary:** 550+ line controller powering “Migration Studio” (experiments CRUD, imports/mappings, guardrails, activation/pause/delete, SDK assignment endpoint, signed reporting). Mixes service calls with direct SQL queries via `pool`. **Dependencies:** `MigrationStudioService`, Postgres pool, `AppError`, `ExperimentMode`. **Risks/TODOs:** File has many concerns—ripe for modularization; `getAssignment` exposes unauthenticated endpoint (expected for SDK) but logs via `console.error` not `logger`; import endpoints accept arbitrary file buffers/credentials without size validation; consider rate limits + retry/backoff for expensive operations. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/payout.controller.ts` — **Type:** Source. **Summary:** Provides payout history/upcoming/settings endpoints plus zod-validated settings update for publishers. **Dependencies:** `payoutProcessor` service helpers (`listPayoutHistory`, `getUpcomingPayouts`, etc.), `zod`, `AppError`. **Risks/TODOs:** `limit` query param lacks upper bound similar to fraud controller; no auditing/logging around settings changes. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/placement.controller.ts` — **Type:** Source (stub). **Summary:** Placeholder CRUD for ad placements with zod validation but all handlers return mocked data / TODO comments. **Dependencies:** `logger`, `AppError`, `zod`. **Risks/TODOs:** Not production-ready (no DB integration, uses static IDs). Implement or wire to actual persistence. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/reporting.controller.ts` — **Type:** Source. **Summary:** 775-line reporting surface powering dashboard metrics (overview, time series, adapters/apps/countries, realtime stats, fraud & quality metrics, SLOs, anomalies, aggregated dashboard). Heavy use of shared date-range parsing feeding `reportingService` + `qualityMonitoringService`. **Dependencies:** `zod`, `reportingService`, `qualityMonitoringService`, `AppError`, `logger`. **Risks/TODOs:** Monolithic file ripe for modularization; query params allow large windows/hours with minimal caps, risking expensive ClickHouse/Postgres scans; ensures `parseDateRange` gracefully handles timezone offsets. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/revenue.controller.ts` — **Type:** Source (stub). **Summary:** Two placeholder endpoints for revenue summary + timeseries returning hard-coded mock data and ignoring auth/validation. **Dependencies:** None beyond Express types. **Risks/TODOs:** Needs real data access, publisher scoping, validation, and caching; remove temporary mocks before exposing publicly. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/rtb.controller.ts` — **Type:** Source. **Summary:** Handles OpenRTB bid requests with feature flag gating—falls back to legacy mock engine when production RTB disabled, otherwise calls `runAuction` with consent/migration metadata and returns JSON or 204; status endpoint lists registered adapters. **Dependencies:** `runAuction`, `getAllAdapters`, `AuctionRequestBody`, `logger`, `crypto`. **Risks/TODOs:** No schema validation on POST payload (`body.requestId!` assumes presence); error responses always 204 with no metadata, making debugging hard; consider instrumentation for circuit breaker stats in status response. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/rtbTracking.controller.ts` — **Type:** Source. **Summary:** Token-based tracking endpoints—serves creative redirects, records impressions/clicks by verifying signed tokens, dedupes via Redis, and either enqueues analytics events or inserts directly to ClickHouse. **Dependencies:** `verifyToken`, `TrackingTokenSchema`, `redis`, `queueManager` (BullMQ), `getClickHouseClient`, `analyticsEventsEnqueuedTotal`, `crypto`. **Risks/TODOs:** Click redirect currently hard-coded to `/` unless token includes URL; lack of rate limiting could allow abuse; silent catch blocks hide dedupe failures—consider structured logging. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/skadnetwork.controller.ts` — **Type:** Source. **Summary:** Handles Apple SKAdNetwork postbacks plus campaign CRUD, conversion value calculations/updates, signature generation, and version metadata via `skadnetworkService`. **Dependencies:** `skadnetworkService`, `logger`, service types (`SKAdNetworkPostback`, `ConversionValueMapping`). **Risks/TODOs:** Endpoints lack authentication/authorization—any caller could modify campaign schemas or conversion values; add signing/secret validation especially for postbacks. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/transparency.controller.ts` — **Type:** Source. **Summary:** 675-line transparency API covering auction listings/detail, summaries, metrics, signer key retrieval, and integrity verification with Prometheus instrumentation + ClickHouse queries; enforces publisher scoping and canonicalization for signature checks. **Dependencies:** `executeQuery` (ClickHouse), `AppError`, `crypto`, `canonicalizeForSignature`, `transparencyWriter`, validation utils, `prom-client` histograms, env flag `TRANSPARENCY_API_ENABLED`. **Risks/TODOs:** Large surface area—consider splitting; ClickHouse queries built via string interpolation but rely on typed parameters (ensure no injection); canonical responses truncated at 32 KB—document behavior; add caching for `/auctions` when limit high to avoid repeated heavy joins. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/FinancialReportingController.ts` — **Type:** Source (class-based). **Summary:** Compliance reporting download endpoints for Estonian regulators (transaction log, VAT quarters, P&L, cashflow, customer revenue, summary metadata) invoking `FinancialReportingService` to emit Excel buffers. **Dependencies:** `FinancialReportingService`, Postgres `Pool`. **Risks/TODOs:** Uses `console.error` instead of shared logger; directly accesses `reportingService['pool']` for queries (breaks encapsulation); endpoints lack auth/authorization and stream entire workbooks synchronously—add scope checks + streaming safeguards. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/HealthCheckController.ts` — **Type:** Source (class). **Summary:** Provides liveness, readiness, startup, and detailed status endpoints leveraging Postgres `Pool` for checks plus system metrics. **Dependencies:** Postgres `Pool`, `process` stats. **Risks/TODOs:** Uses `console.error` instead of logger; readiness only checks DB latency but not Redis/ClickHouse; startup loops sequential table checks per request (potentially heavy). Consider caching results or using health service. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/abTesting.controller.ts` — **Type:** Source. **Summary:** CRUD + analytics for AB experiments (create/start/stop, record events, significance test, bandit recommendation) with zod validation and publisher scope enforcement. **Dependencies:** `abTestingService`, `zod`, `logger`. **Risks/TODOs:** `recordEvent` endpoint skips auth/publisher guard—anyone could post events; some parsed query bodies not sanitized for size; consider moving `interpretSignificanceResult` to shared util. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/adapter.controller.ts` — **Type:** Source. **Summary:** Adapter configuration CRUD endpoints scoped to publisher, validating payloads with zod and delegating to `adapterConfigService`. **Dependencies:** `adapterConfigService`, `zod`, `AppError`, `logger`. **Risks/TODOs:** Config blobs accepted as arbitrary JSON without schema validation—high chance of invalid adapter credentials reaching runtime; consider per-adapter schema enforcement + audit logging. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/analytics.controller.ts` — **Type:** Source. **Summary:** Provides analytics dashboards (overview/time-series/performance) plus bulk ingestion endpoints for impressions/clicks/revenue with zod validation and buffer stats endpoint. **Dependencies:** `analyticsPipeline` helpers (`getAnalyticsOverview`, etc.), `analyticsService`, `zod`, `AppError`, `logger`. **Risks/TODOs:** Event ingestion endpoints appear unauthenticated and accept publisher IDs in payload—need auth and rate limiting; synchronous schema parsing on large batches could block event loop; consider streaming validation. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/apiKeys.controller.ts` — **Type:** Source. **Summary:** Simple API key CRUD for sandbox readiness storing keys in an in-memory map keyed by user, generating secrets with prefixes and returning redacted metadata. **Dependencies:** Node `crypto`, `logger`. **Risks/TODOs:** In-memory storage means keys vanish on restart and aren’t shared between instances; no persistence or encryption-at-rest; unauthorized users default to `anon` bucket allowing cross-tenant key leakage. **Evidence:** Reviewed 2025‑11‑14.
- `src/controllers/twofa.controller.ts` — **Type:** Source. **Summary:** Exposes 2FA enroll/verify/backup-code regeneration/disable flows backed by `twofaService`, incrementing Prometheus counters and requiring password confirmation to disable. **Dependencies:** `twofaService`, `twofaEventsTotal`, `logger`, dynamic imports for `userRepository` + `bcryptjs`. **Risks/TODOs:** Most handlers fall back to `anon` user if auth missing, enabling unauthorized enrollments; no rate limiting on verify/regenerate; disable endpoint depends on email stored in `req.user` but doesn’t ensure same user as `userId`. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/abTestingService.ts` — **Type:** Source. **Summary:** 650+ line service managing AB experiments (CRUD via Postgres, variant metrics aggregation, two-sample t-tests, Thompson Sampling bandit, custom statistical helpers). **Dependencies:** `utils/postgres` query helper, `logger`. **Risks/TODOs:** Implements homegrown statistics (betaCDF returns `x`, p-values approximated) which may be inaccurate; IDs derived from `Date.now()+Math.random()` lack UUID guarantees; event writes accept arbitrary metadata without size limit. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/adapterConfigService.ts` — **Type:** Source. **Summary:** Thin service layer around `adapterConfigRepository` providing CRUD for adapter configs and ensuring unique adapter per publisher. **Dependencies:** `adapterConfigRepository`. **Risks/TODOs:** No schema validation or masking of secrets; errors thrown as generic `Error` strings, which bubble up to Express without proper AppError classification. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/adapterConfigService.test.ts` — **Type:** Test. **Summary:** Jest suite mocking `adapterConfigRepository` to exercise `adapterConfigService` CRUD helpers (list/get/create/update/delete) including duplicate detection and failure paths. **Dependencies:** Jest, `../adapterConfigService`, `../../repositories/adapterConfigRepository`. **Risks/TODOs:** Pure unit mock tests—don’t hit Postgres or validate schema shapes, so serialization/transaction bugs can slip through; request payload coverage limited to happy path plus minimal error cases (no large configs, secret masking, or concurrent writes). **Evidence:** Reviewed 2025‑11‑14.
- `src/services/analyticsPipeline.ts` — **Type:** Source. **Summary:** Delegates analytics overview/time-series/performance queries to repository functions, defaulting to 30-day window. **Dependencies:** `analyticsRepository`, `date-fns`. **Risks/TODOs:** No validation of date inputs (passing invalid string yields `Invalid Date`); metric switch only affects single numeric field while still returning raw revenue/impressions/clicks. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/analyticsPipeline.test.ts` — **Type:** Test. **Summary:** Mocks `analyticsRepository` to verify `analyticsPipeline` delegates correctly, applies default 30-day window, formats time-series values per metric, and passes through performance breakdown rows. **Dependencies:** Jest, `date-fns.subDays`, `../analyticsPipeline`, `../../repositories/analyticsRepository`. **Risks/TODOs:** Uses fake timers but only validates single data point per case; doesn’t assert error handling or invalid date parsing, so regressions in validation would go unnoticed; repository mock expectations mirror implementation, making it easy for tests to pass while forgetting metric rounding rules for non-revenue metrics. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/analyticsService.ts` — **Type:** Source. **Summary:** In-memory buffering service that batches impression/click/revenue DTOs and flushes to ClickHouse via `insertBatch`, with periodic timer and stats helper. **Dependencies:** `utils/clickhouse`, `logger`, analytics DTO types. **Risks/TODOs:** Buffers stored in-process → events lost on crash; retries simply re-queue same array without backoff or dead-letter; no high-water mark leading to potential unbounded memory use if ClickHouse down. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/analyticsQueryService.ts` — **Type:** Source (placeholder). **Summary:** File exists but empty—no query helpers implemented. **Dependencies:** None. **Risks/TODOs:** Implement specialized ClickHouse query helpers referenced elsewhere to avoid runtime import errors. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/analyticsReportingService.ts` — **Type:** Source (placeholder). **Summary:** Empty file intended for reporting-specific analytics logic. **Dependencies:** None. **Risks/TODOs:** Populate to prevent dead imports; confirm nothing tries to require it at runtime. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/bidLandscapeService.ts` — **Type:** Source. **Summary:** Logs detailed bid landscape data to ClickHouse (all bids, clearing price calculations, adapters) and exposes aggregate/timeline queries plus health checks. **Dependencies:** `utils/clickhouse`, `types/openrtb.types`, `logger`. **Risks/TODOs:** `logger` import uses named export though module exports default logger (verify to avoid undefined); clearing price math assumes second-price auction even if `result` indicates otherwise; `getClient` memoizes first failure only—subsequent ClickHouse recovery won’t log until restart. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/consentManagementService.ts` — **Type:** Source. **Summary:** Comprehensive CMP service parsing TCF 2.2/GPP strings, validating consent, persisting per-user state, and exposing helpers for SDK/OpenRTB integration plus utility parsers exported for controllers. **Dependencies:** `utils/postgres`, `logger`. **Risks/TODOs:** Homegrown parsers partially implemented (publisher restrictions TODO, GPP sections simplified) so correctness uncertain; heavy file (600+ LOC) mixing parsing, DB, validation—consider splitting; lacks rate limiting/logging sanitization for large consent payloads. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/consentManagementService.test.ts` — **Type:** Test. **Summary:** Large Jest suite mocking `utils/postgres` + logger to cover consent storage/retrieval/validation flows, OpenRTB `regs`/`user` builders, parsers (TCF v2, GPP), and singleton export wiring. **Dependencies:** Jest, `../consentManagementService`, `../../utils/postgres`, `../../utils/logger`. **Risks/TODOs:** Still pure unit tests—DB interactions are mocked so schema drift or SQL errors won’t be caught; tests mostly happy-path for parsers and don’t validate edge-case decoding (publisher restrictions, custom purpose logic); uses shared singleton and mutates logger mocks, which can leak state into other suites if run in parallel. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/dataExportService.ts` — **Type:** Source. **Summary:** Orchestrates ClickHouse data extraction, file generation (CSV/JSON/Parquet), compression, and delivery to S3/GCS/BigQuery/local for analytics exports and scheduled warehouse syncs. **Dependencies:** AWS SDK, GCP Storage & BigQuery, `fs`, `zlib`, `executeQuery`, `dataExportRepository`, `logger`. **Risks/TODOs:** Builds SQL via string interpolation with publisherId/date inserted (risk of injection); writes entire dataset to memory when generating CSV/JSON; uses synchronous `fs` calls and stores generated files under `/tmp` without cleanup; upload credentials not scoped per publisher. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/enrichment/enrichmentService.ts` — **Type:** Source. **Summary:** Loads offline enrichment manifests (abuse IP ranges, Tor exits, cloud/vpn CIDRs, ASN geo data, user-agent regexes) from `data/enrichment/<version>` into `IPRangeIndex` structures, exposes `initialize` with snapshot writing plus runtime lookups for IP/user-agent metadata. **Dependencies:** Node `fs/promises`, `path`, shared `logger`, `./ipRangeIndex`. **Risks/TODOs:** Entire dataset is read synchronously at startup and stored in memory with no streaming/chunking; only IPv4 is supported, so IPv6 traffic can’t be enriched; manifest inputs are trusted blindly (no schema validation or size limits) so a bad file could exhaust memory or crash parse; lookup errors throw if `initialize` wasn’t called, but nothing auto-initializes in prod. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/enrichment/ipRangeIndex.ts` — **Type:** Source. **Summary:** Provides a minimal IPv4 CIDR/range index with binary search lookup and convenience parsers for CIDR/single IP/range notation, storing arbitrary metadata per prefix. **Dependencies:** None beyond builtin math helpers. **Risks/TODOs:** IPv6 unsupported; ranges accumulate in an unsorted array until lookup, so a large manifest causes repeated sort work; duplicates are de-duplicated only when start/end match exactly, meaning overlapping ranges aren’t coalesced and could explode memory. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/enrichment/index.ts` — **Type:** Source. **Summary:** Barrel file exporting the enrichment service singleton + types for consumers (`VPNProxyDetectionService`, fraud tooling). **Dependencies:** `./enrichmentService`. **Risks/TODOs:** Re-export only—callers still import side-effectful singleton, so tests need helpers to reset state. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/enrichmentService.test.ts` — **Type:** Test. **Summary:** Boots `EnrichmentService` against the real `data/enrichment/v1` snapshot to verify lookupIp/user-agent parsing/snapshot persistence behavior using deterministic fixture IPs and UA strings. **Dependencies:** Jest, Node `fs/promises`, `path`, `../enrichment/enrichmentService`. **Risks/TODOs:** Reads large fixture files into memory during tests and assumes `data/enrichment` exists on CI; covers only happy-path lookups (no corrupt manifest, invalid IPs, or concurrent initialization). **Evidence:** Reviewed 2025‑11‑14.
- `src/services/fraudDetection.ts` — **Type:** Source. **Summary:** Adapter over `fraudRepository` converting raw stats/breakdowns into controller-friendly DTOs (totals, detection rate, top types). **Dependencies:** `fraudRepository`. **Risks/TODOs:** No caching; repeated calls re-query DB; `blockedRevenue.toFixed` assumes numeric fields always present—add null guards. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/fraudDetection.test.ts` — **Type:** Test. **Summary:** Mocks `fraudRepository` fetchers to verify that `getFraudStatistics`, `listFraudAlerts`, and `getFraudByType` format counts, percentages, blocked revenue rounding, and alert pagination correctly, including zero-alert guard rails. **Dependencies:** Jest, `../fraudDetection`, `../../repositories/fraudRepository`. **Risks/TODOs:** Only checks happy-path formatting—doesn’t simulate repository exceptions, missing fields, or localization requirements; precision rounding hard-coded to two decimals so floating-point drift isn’t tested; alerts test covers only single-row sample, not pagination/order edge cases. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/fraud/weakSupervision/WeakSupervisionService.ts` — **Type:** Source. **Summary:** Orchestrates offline “weak supervision” labeling by loading JSON manifests (supply-chain corpus + synthetic scenarios), wiring enrichment lookups, and executing multiple heuristics (supply chain, network origin, CTIT, OMSDK, synthetic telemetry) to emit label function outcomes + quality reports. **Dependencies:** Node `fs/promises`, `path`, `../../enrichment/enrichmentService`, `./supplyChainCorpus`, `./syntheticScenarios`, shared `logger`. **Risks/TODOs:** Initialization eagerly loads entire corpora into memory with no eviction and blocks each request if not pre-initialized; relies on external JSON quality—no schema validation or signature checking; concurrent `initialize()` calls share a single promise but errors leave the service partially initialized; heuristics encode fixed thresholds (5s CTIT, timezone matches) without configuration hooks, so tuning requires redeploy. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/fraud/weakSupervision/supplyChainCorpus.ts` — **Type:** Source. **Summary:** Loads app-ads.txt derived corpus + sellers directory JSON and evaluates whether a seller/domain/appStoreId combination is authorized, returning directory metadata for context. **Dependencies:** Node `fs/promises`, `path`, weak supervision types. **Risks/TODOs:** Corpus entirely in memory and case-sensitive (domains converted to lower-case but sellers not), so updates require full reload; no caching/TTL or background refresh; JSON parsing errors aren’t handled—bad data crashes initialization; statuses from sellers directory aren’t considered in authorization decisions. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/fraud/weakSupervision/syntheticScenarios.ts` — **Type:** Source. **Summary:** Loads a JSON array of synthetic fraud scenario thresholds and filters incoming telemetry for matching thresholds (RPM, unique devices, creative swaps, bundles/request) to emit canned labels/confidence. **Dependencies:** Node `fs/promises`. **Risks/TODOs:** Threshold comparisons assume all metrics present and numeric—missing fields default to `0` and may produce false negatives; no support for upper bounds beyond two metrics, and scenario definition file isn’t validated before use; evaluating linearly over entire list could be slow if scenarios grow large. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/fraud/weakSupervision/types.ts` — **Type:** Source (types). **Summary:** Declares the weak supervision data model (contexts, label function outcomes, quality reports, synthetic scenario definitions) shared across service + controllers/tests. **Dependencies:** None. **Risks/TODOs:** File ends with stray backticks (typo) and lacks runtime validation helpers, so upstream inputs must guard themselves; type unions hardcode strings, making it easy for implementation to drift without compiler errors when new label classes needed. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/fraud/weakSupervision/index.ts` — **Type:** Source. **Summary:** Barrel re-export for weak supervision types + service to simplify imports. **Dependencies:** `./types`, `./WeakSupervisionService`. **Risks/TODOs:** Re-exporting the singleton encourages shared state between tests/server; consider exposing factory to enable isolated instances. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/FinancialReportingService.ts` — **Type:** Source. **Summary:** Generates Excel exports for Estonian compliance workflows (transaction logs, quarterly VAT, annual P&L, cash flow, customer revenue) by querying Postgres, mapping rows to typed DTOs, and assembling `ExcelJS` workbooks with formatting and summary math. **Dependencies:** `pg` Pool, `exceljs`, `date-fns`. **Risks/TODOs:** Runs full-table scans per export and builds workbooks entirely in memory—huge fiscal years may exhaust memory/CPU; queries interpolate fiscal period into SQL but otherwise rely on positional params; service lacks pagination/streaming and could expose PII if called without tenant scoping. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/VPNProxyDetectionService.ts` — **Type:** Source. **Summary:** Multi-factor geographic validation for discounted pricing; correlates IP-derived country (MaxMind), Stripe payment method country, and optional app-store country, applies scoring/heuristics, checks enrichment+reverse DNS for VPN signals, logs audit history, and exposes last 10 validation results. **Dependencies:** `pg` Pool, `@maxmind/geoip2-node`, Node `dns`, shared `enrichmentService`. **Risks/TODOs:** Loads GeoIP DB from filesystem on startup without retries; heavy reliance on in-process caches and console logging; reverse DNS lookups and async scoring run sequentially per request (potential latency spikes) and there’s no rate limiting or batching; ENV `GEOIP_DATABASE_PATH` must be provisioned in containers. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/VPNProxyDetectionService.test.ts` — **Type:** Test. **Summary:** Light integration-style Jest test that boots `VPNProxyDetectionService` with a real `EnrichmentService` snapshot (v1 under `data/enrichment`) and stubbed Pool/GeoIP/dns dependencies to ensure VPN IPs are flagged via enrichment datasets. **Dependencies:** Jest, Node `path`, `../VPNProxyDetectionService`, `../enrichment/enrichmentService`. **Risks/TODOs:** Only asserts a single positive case (VPN detected) and doesn’t cover negative paths, GeoIP failures, ClickHouse writes, or alerting; relies on fixture data existing at `data/enrichment` so CI needs those files, but test still mocks Postgres so it can’t catch SQL regressions.
- `src/services/migrationComparisonSigner.ts` — **Type:** Source. **Summary:** Generates signed “Migration Studio” comparison payloads either from raw mapping samples or real experiment metrics, canonicalizes the JSON, and signs it with Ed25519 keys for downstream verification, while synthesizing uplift/latency/IVT metrics and confidence bands. **Dependencies:** Node `crypto`, `../utils/logger`, migration type definitions, env-provided PEM keypair (`MIGRATION_STUDIO_SIGNING_*`). **Risks/TODOs:** Falls back to generating ephemeral keys when env vars missing (undermines trust chain); metrics are mostly simulated heuristics (e.g., 5% uplift, hard-coded fill/latency formulas) so reports may mislead if treated as real; uses console logger but never rotates keys or enforces KID rotation; no input validation on experiment data. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/migrationComparisonSigner.test.ts` — **Type:** Test. **Summary:** Calls `generateSignedComparison` with a single mocked mapping to assert that uplift metrics, fill unit metadata, and signature payload/base64 encoding are generated consistently, including parsing and comparing the signed payload to the returned metrics. **Dependencies:** Jest, `../migrationComparisonSigner`, `../../types/migration`. **Risks/TODOs:** Only validates deterministic happy-path structure (no signature verification, multi-mapping scenarios, or env-driven key IDs); doesn’t simulate missing PEM keys or payload tampering; uses live `Date` objects so results depend on runtime clock but expectations don’t assert timestamps. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/migrationImportConnectors.ts` — **Type:** Source. **Summary:** Provides stubbed connectors for incumbent mediation platforms (ironSource/AppLovin) used by Migration Studio imports, validating credentials and returning deterministic normalized mapping rows (network, instance, eCPM, confidence) derived from the account ID so end-to-end flows/tests stay stable. **Dependencies:** None beyond built-in `Error`. **Risks/TODOs:** Purely mocked—no actual API integration, no rate limiting, and credential validation only checks for non-empty strings; must be replaced with real HTTP clients + secure storage before production imports. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/migrationStudioService.ts` — **Type:** Source. **Summary:** 1.5k‑line domain service powering Migration Studio: owns experiment CRUD (with transactions/audit logs), import flows (CSV + ironSource/AppLovin connectors), mapping summaries, deterministic assignment + feature-flag resolution, guardrail evaluation/pausing, event logging, signed comparison generation, and mirroring/shadow activation. **Dependencies:** `pg` Pool, Node `crypto`, `../utils/logger`, `../utils/migrationCsvParser`, migration connectors + signer modules, Prometheus counters. **Risks/TODOs:** Extremely monolithic and mixes SQL, business logic, and IO—hard to test or evolve; imports rely on buffered file parsing with minimal validation and no size limits; guardrail evaluation scans raw tables every call and could lock rows (`FOR UPDATE`) under load; deterministic assignment depends on mirror percent but lacks central config/rate limiting; error handling mostly rethrows so partial transactions risk leaving orphaned temp data if exceptions occur outside BEGIN/COMMIT scope. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/migrationStudioService.test.ts` — **Type:** Test. **Summary:** Spins up `MigrationStudioService` with mocked PG pool/logger/crypto to exercise experiment lifecycle (create/get/update/activate/pause/delete), guardrails validation, feature flag resolution, deterministic arm assignment/logging, and error handling/transactions/rollback paths. **Dependencies:** Jest, dynamic imports of `../migrationStudioService`, `../../middleware/errorHandler`, mocked `crypto` + `../../utils/logger`. **Risks/TODOs:** Heavy suite still mocks all SQL so it can’t catch query regressions; async `beforeAll` imports add coupling and may hide race conditions; coverage skips CSV import/mirroring flows, guardrail metrics, and Prometheus counters; deterministic assignment tests rely on seeded UUID but don’t assert distribution or hashing collisions. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/openrtbEngine.ts` — **Type:** Source. **Summary:** Mock OpenRTB 2.6 auction engine: defines static adapter catalog + simple circuit breaker, validates requests, fans out “calls” (simulated responses) in parallel, runs second-price clearing, enforces floors, logs to bidLandscape/transparency writers, and exposes adapter/circuit stats. **Dependencies:** Node `crypto`, `../utils/logger`, `./bidLandscapeService`, `./transparencyWriter`, OpenRTB type defs. **Risks/TODOs:** Adapter calls are fully simulated (no HTTP, no per-adapter config storage) so engine can’t reach real demand; clearing price/floor enforcement uses only first impression; no timeout accounting (adapterTimeouts counter never increments) and logging happens even on validation failures which could flood ClickHouse; circuit breaker state is in-memory only so restarts reset health data. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/transparencyWriter.ts` — **Type:** Source. **Summary:** Samples completed auctions, canonicalizes payloads, signs them with Ed25519, and writes auction/candidate rows to ClickHouse with retry + breaker logic and Prometheus counters/gauges for breaker state and failures. **Dependencies:** Node `crypto`, `prom-client`, `../utils/clickhouse`, OpenRTB types, `./transparency/canonicalizer`, `./openrtbEngine`. **Risks/TODOs:** Requires PEM private key + ClickHouse connectivity at runtime; when client missing it silently drops samples after first warning; breaker/counters are in-process so multi-instance deployments won’t share cooldowns; metadata hash only includes a subset of bid fields—could be insufficient for full auditing; sampling is deterministic per publisher/request but rate is global and not per-tenant configurable. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/transparencyWriter.test.ts` — **Type:** Test. **Summary:** Uses generated Ed25519 keys + mocked ClickHouse client to validate sampling skip, successful auction + candidate persistence (signature metadata, payload contents), retry behavior, breaker open/close, partial failure metrics, canonicalization helper, and ClickHouse error handling with metrics counters. **Dependencies:** Jest, Node `crypto`, `../transparencyWriter`, `../../types/openrtb.types`. **Risks/TODOs:** Doesn’t mock prom-client metrics or actual ClickHouse responses beyond insert stub; breaker tests manipulate wall-clock manually but don’t assert concurrent writers; canonicalization test only inspects subset of fields; no coverage for configuration reload, redaction, or large candidate batches. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/transparency/canonicalizer.ts` — **Type:** Source. **Summary:** Defines the deterministic JSON canonicalization logic shared by transparency writer/controller/CLI—sorts object keys lexicographically, stringifies arrays recursively, and normalizes primitives (finite numbers, booleans, `null`). **Dependencies:** None beyond built-in JSON/string helpers; consumed by transparency stack. **Risks/TODOs:** Treats `NaN`/`Infinity` as `null`, which may hide bad data rather than failing; lacks bounds on recursion depth so malicious payloads could cause stack overflows; doesn’t escape BigInt/special types, so callers must pre-sanitize. Consider exporting a streaming version to avoid building huge strings in memory. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/payoutProcessor.ts` — **Type:** Source. **Summary:** Defines a multi-provider payout processor with in-memory Tipalti/Wise/Payoneer stubs, double-entry ledger helper (`payout_ledger` table) with balance validation, payout status updater, failed payout retry loop, and thin wrappers around `payoutRepository` fetch/update helpers. **Dependencies:** `../repositories/payoutRepository`, `../utils/postgres` query helper, shared `logger`, env-provided API keys/endpoints for each provider. **Risks/TODOs:** Provider “APIs” are simulated (no HTTP clients, request signing, or reconciliation), yet payouts are marked processed and ledgered, so system will claim money moved when nothing happened; ledger inserts/status updates aren’t wrapped in a DB transaction—midway failures could leave duplicate or unbalanced rows; `retryFailedPayouts` runs synchronously without rate limits or exponential backoff; transaction IDs are derived from `Date.now()+Math.random()` which are predictable and may collide. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/paymentProcessor.test.ts` — **Type:** Test. **Summary:** Mocks Postgres + logger to cover `PaymentProcessor` payout flow (Tipalti happy path, Wise/Payoneer failover when env keys missing), ledger entry creation/validation, payout status updates, retrying failed payouts, and the helper `PayoutLedgerService` (create/get entries, balance tolerance) plus singleton exports. **Dependencies:** Jest, `../payoutProcessor`, `../../utils/postgres`, `../../utils/logger`. **Risks/TODOs:** Providers are still simulated, so tests only assert log + DB calls—not real HTTP payloads or retries; env mutation for failover could leak between tests; ledger balance validation only checks ±0.01 tolerance and doesn’t simulate long-running imbalance or concurrency; retry test doesn’t assert behavior when ledger inserts fail mid-loop. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/payoutProcessor.test.ts` — **Type:** Test. **Summary:** Stubs `payoutRepository` helpers to verify `listPayoutHistory`, `getUpcomingPayouts`, `getPayoutSettings`, and `updatePayoutSettings` pass through parameters and format payloads when updating thresholds/method/currency schedules. **Dependencies:** Jest, `../payoutProcessor`, `../../repositories/payoutRepository`. **Risks/TODOs:** Missing coverage for repository errors, pagination, or empty-state defaults; doesn’t validate scheduler cron translation or currency filtering; mocks always resolve so tests won’t catch thrown AppErrors or logging side effects. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/qualityMonitoringService.ts` — **Type:** Source. **Summary:** Aggregates ClickHouse data (`impressions`, `creative_scans`, `sdk_telemetry`, `creative_compliance`) to deliver viewability, brand safety, compliance, ANR, and SLO/alert reports, including helper functions that combine metrics into quality alerts with canned remediation guidance. **Dependencies:** `../utils/clickhouse.executeQuery`, shared `logger`, ClickHouse tables for impressions/telemetry/scans/compliance. **Risks/TODOs:** Heavy synchronous queries fan out multiple aggregations per request without caching—large date ranges could hammer ClickHouse; SQL uses publisherId interpolation via parameter binding but still builds strings with inline arithmetic—ensure identifiers stay sanitized; SLO error-budget math divides by `(100 - target)` and will blow up when target=100 (availability) leading to `Infinity`; quality alerts trigger network-bound subcalls sequentially and may return duplicates when Date.now is used for IDs; no rate limiting or background job offload, so dashboard hits re-run expensive analytics each time. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/qualityMonitoringService.test.ts` — **Type:** Test. **Summary:** Heavily mocks `executeQuery` to cover every public method: viewability metrics (by format + zero impression handling), brand safety reports, creative compliance, ANR/crash stats, SLO aggregation/error budget states, alert generation (SLO breach, ANR spike, viewability drop, severity sorting), and no-issue scenario. **Dependencies:** Jest, `../qualityMonitoringService`, `../../utils/clickhouse`, `../../utils/logger`. **Risks/TODOs:** Still unit-level with ClickHouse fully mocked so SQL or schema drift won’t be caught; tests expect stringified numbers to parse cleanly but don’t assert type conversion failures; ANR alert cases rely on manual data ordering and could miss concurrency or pagination issues; no coverage for Prometheus instrumentation or error-handling branches when queries reject. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/reportingService.ts` — **Type:** Source. **Summary:** 1.1k‑line ClickHouse analytics layer powering dashboards (revenue stats/time series, adapter/app/country breakdowns, realtime + health scoring, fraud/quality metrics, revenue projections, cohort analysis, anomaly detection) with dozens of raw SQL strings and light post-processing helpers. **Dependencies:** `../utils/clickhouse.executeQuery`, shared `logger`, ClickHouse tables `revenue_events`, `impressions`, `fraud_events`, `quality_events`, `sdk_telemetry`, `user_events`, `user_installs`, plus downstream controllers. **Risks/TODOs:** Many calculations divide by `count(*)` or `countIf(...)` without guarding zero denominators (e.g., `completion_rate`, `ctr`, adapter uptime) → NaN/Infinity leaks to API; fill rate is hard-coded to 100 despite TODO; adapter health shares revenue by cross-joining a single `total`—when total revenue is 0 the query divides by zero and fails; linear regression/projection ignores seasonality and doesn’t clamp slopes leading to negative projections despite `Math.max`; anomaly detection cross joins baseline stats even when baseline empty (results null) and spawns duplicate alerts per metric hour; service fires multiple heavy ClickHouse queries per request without caching or pagination, so large date ranges can overwhelm CH and API latency. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/reportingService.test.ts` — **Type:** Test. **Summary:** Fully mocks ClickHouse to exercise adapter health scoring, fraud metrics, quality metrics (bounds + defaults), revenue projections (upward/declining trends, insufficient data), cohort analysis, anomaly detection (revenue drop, performance degradation, fraud spikes, traffic anomalies, severity bands), and a simple integration correlation between adapter health + quality stats. **Dependencies:** Jest, `../reportingService`, `../../utils/clickhouse`, `../../utils/logger`. **Risks/TODOs:** Heavy reliance on mocked arrays means SQL regressions or schema mismatches won’t surface; projections tests use Math.random noise which could cause flakiness; anomaly tests don’t verify deduplication/time window overlaps; integration test merely compares two sequential calls with separate mocks rather than ensuring combined pipeline behavior. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtbEngine.ts` — **Type:** Source. **Summary:** Minimal mock RTB executor that filters a hard-coded `DEMAND_PARTNERS` array, picks the highest CPM above floor, and emits a synthetic `BidResponse` with tracking URLs plus Prometheus auction timing; also exposes a diagnostics helper returning adapter count and average CPM. **Dependencies:** Node `crypto` (UUID), `../utils/prometheus.auctionLatencySeconds`. **Risks/TODOs:** Not production-ready—no actual bidder network calls, no consent/device validation, no creative metadata beyond static URLs; CPM/floor comparison uses fixed USD numbers so cannot support per-geo pricing or currencies; hard-coded adapters mean config changes require code deploy; `executeBid` never logs or exposes reasons for `null` bids, and tracking URLs are unauthenticated/public meaning anyone can spam them. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/adapterRegistry.ts` — **Type:** Source. **Summary:** Tiny registry that lazily registers mock adapters (AdMob/AppLovin/Unity) and exposes helpers to list all adapters or filter by ad format to support the mock RTB engine. **Dependencies:** `./adapters/mockAdmob`, `./adapters/mockAppLovin`, `./adapters/mockUnityAds`, shared adapter type defs. **Risks/TODOs:** Registry is process-local and never reloads, so hot-reloading real adapter configs isn’t possible; only mock adapters exist—no dynamic discovery or configuration persistence; `registerDefaultAdapters` silently no-ops after first call, so tests must reset state manually to avoid cross-test leakage. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/orchestrator.ts` — **Type:** Source. **Summary:** Main mock RTB auction runner: seeds adapters, dispatches concurrent bid requests with per-adapter timeouts, samples winners, and wraps results with signed delivery/impression/click tokens while recording Prometheus metrics and optional Migration Studio shadow/mirroring outcomes. **Dependencies:** `./adapterRegistry`, `./adapters/*`, `../../utils/prometheus`, `../../utils/signing`, `./shadowRecorder`, migration type defs, Node `crypto`. **Risks/TODOs:** Entire auction logic depends on synchronous `Promise.all` without early-short circuit beyond manual abort, so slow adapters can still consume resources; auction inputs/tracking tokens trust in-process secrets—no replay protection beyond TTL; migration shadow recording runs per request and could amplify latency if ClickHouse/DB writes slow; lacks validation or caps on adapter count/payload sizes; uses process env for TTL but no config reload, so long-running instances can’t adjust without restart. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/shadowRecorder.ts` — **Type:** Source. **Summary:** Persists Migration Studio “shadow” auction outcomes into `migration_shadow_outcomes`, serializing candidate bid snapshots + metadata to JSONB and swallowing insert errors to keep the RTB request fast. **Dependencies:** `../../types/migration`, shared Postgres helper `query`, shared `logger`. **Risks/TODOs:** Inserts fire inline on the request thread with no batching/backpressure so DB hiccups could still cascade despite the catch; JSON serialization takes arbitrary metadata with no schema or size limits; failures only log a warning and aren’t surfaced to Prometheus, so silent data gaps are likely. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/adapters/types.ts` — **Type:** Source (types). **Summary:** Defines the adapter contract (supported ad formats, bid request payload including consent/migration metadata, bid vs no-bid responses, AbortSignal context) used by all mock bidders. **Dependencies:** `../../../types/migration`. **Risks/TODOs:** Type-only layer doesn’t enforce runtime validation so callers can emit malformed requests (e.g., negative floor CPM, missing consent structures); relies on DOM `AbortSignal` availability in Node without polyfill notes. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/adapters/mockAdmob.ts` — **Type:** Source. **Summary:** Mock AdMob adapter that waits a random 20‑60 ms, rejects floors above 1.2 CPM, and emits canned creatives while instrumenting Prometheus latency + timeout counters. **Dependencies:** Adapter types, `rtbAdapterLatencySeconds`, `rtbAdapterTimeoutsTotal`. **Risks/TODOs:** Uses `Math.random()` for CPM/jitter (non-deterministic tests) and never logs errors, so adapter failures are invisible beyond metrics; static creative URLs + TTL mean creatives aren’t scoped per publisher; timeout handling simply returns `nobid` without propagating structured diagnostics. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/adapters/mockAppLovin.ts` — **Type:** Source. **Summary:** Mock AppLovin adapter similar to AdMob but with 30‑100 ms jitter and 1.8 CPM floor, producing canned creatives conditioned on AbortSignals. **Dependencies:** Adapter types, `rtbAdapterLatencySeconds`, `rtbAdapterTimeoutsTotal`. **Risks/TODOs:** Relies on DOMException availability in Node (not always standard) and never surfaces unexpected errors beyond returning `nobid`; timeout thresholds come solely from env vars with no sanity checks; no per-request logging or tracing makes debugging adapter behavior difficult. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/rtb/adapters/mockUnityAds.ts` — **Type:** Source. **Summary:** Mock Unity Ads adapter with 15‑70 ms jitter, CPM floor 1.4, emits canned creative URLs/metadata, and instruments Prometheus timers. **Dependencies:** Adapter types, `rtbAdapterLatencySeconds`, `rtbAdapterTimeoutsTotal`. **Risks/TODOs:** Shares same deterministic creative assets and TTL for all requests (risking cache poisoning in real world), and exception handling collapses all non-timeout errors into `ERROR` with no logging, so faults can’t be triaged; adapter never validates request fields (e.g., adFormat) beyond simple floor check. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/skadnetworkService.ts` — **Type:** Source. **Summary:** In-memory SKAdNetwork helper providing campaign schemas, nonce/signature generation (placeholder HMAC), postback ingestion, conversion value calculation/update, and lightweight stats across stored postbacks for SKAN 2.2‑4.0 features. **Dependencies:** Node `crypto`, shared `logger`, env `SKADNETWORK_SECRET`. **Risks/TODOs:** Stores campaigns/postbacks in process memory so data is lost on restart and cannot scale horizontally; signature handling is stubbed (no Apple public key verification), making fraud trivial; conversion schemas default to hard-coded example arrays and lack persistence/validation; `processPostback` accepts any payload without rate limiting or replay detection; `createCampaign`/`updateConversionValue` log but don’t enforce SKAN lock windows or coarse RV guardrails. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/skadnetworkService.test.ts` — **Type:** Test. **Summary:** Instantiates `SKAdNetworkService` to validate supported versions, nonce/signature generation, default vs custom campaign schemas, postback processing success/failure, conversion value calculations (event count/revenue thresholds), conversion updates bounds, and campaign stats/aggregations across recorded postbacks. **Dependencies:** Jest, `../skadnetworkService`. **Risks/TODOs:** Still pure unit tests without crypto verification or concurrency; signature tests only check non-empty strings, not deterministic values; postback processing never asserts rate limiting, replay prevention, or secret rotation; tests rely on in-memory state and could bleed between cases without explicit resets. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/thompsonSamplingService.ts` — **Type:** Source. **Summary:** Thompson Sampling engine for dynamic bid floor optimization keyed by adapter/geo/format, seeded with default floor buckets, using Gamma-sampled Beta distributions to pick exploration vs exploitation floors, persisting alpha/beta parameters in `thompson_sampling_experiments`, and exposing stats/reset helpers. **Dependencies:** `../utils/logger`, `../utils/postgres`, Node `Math.random`. **Risks/TODOs:** Shared state lives in a per-process Map so multi-instance fleets drift unless restarts reload frequently; RNG/sampleGamma implementations rely on `Math.random()` with no seeding or reproducibility guarantees and may have numerical issues for small shapes; updates treat auctions as binary win/loss ignoring bid amount or revenue so it may optimize high win rate over yield; candidate lookup only supports predefined price buckets (±0.01) so external floor adjustments are ignored; no validation/rate limiting on `updateBidFloor`, letting bad data poison priors quickly. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/thompsonSamplingService.test.ts` — **Type:** Test. **Summary:** Mocks Postgres + logger to exercise bid floor selection/exploration, experiment initialization/loading, winner/loser updates (alpha/beta), missing candidate handling, stats aggregation (best floor, confidence, success rate), reset deletion, Beta sampling convergence, retry loops, and singleton export. **Dependencies:** Jest, `../thompsonSamplingService`, `../../utils/postgres`, `../../utils/logger`. **Risks/TODOs:** Uses real `Math.random()` inside tests making outcomes non-deterministic (flaky Beta convergence); DB mocks don’t simulate contention or failures; doesn’t assert persistence format or TTL; concurrency/race behavior for `loadExperiments` unresolved. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/twofa.service.ts` — **Type:** Source. **Summary:** Ephemeral 2FA manager that stores per-user TOTP secrets and hashed backup codes in an in-process `Map`, supports enrollment (QR/otpauth generation), verification/enablement, token or backup-code validation, regeneration, and disable flows. **Dependencies:** `otplib.authenticator`, `bcryptjs`, `qrcode`, shared `logger`. **Risks/TODOs:** Secrets/backup codes live only in memory → lost on restart and vulnerable to multi-instance drift; no persistence, encryption-at-rest, or rate limiting; backup codes generated with `Math.random()` (predictable) and stored until used; service exposes no revocation/audit logs beyond info statements; callers must ensure authenticated context since service performs no authorization checks. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/waterfallService.ts` — **Type:** Source. **Summary:** Provides fallback auction orchestration layered on `openrtbEngine` (executeWithWaterfall, executeWithPriority, executeSmartWaterfall) plus in-memory stats tracking; implements exponential backoff, adapter-priority filtering via `wseat`, and optional performance-aware ordering. **Dependencies:** `./openrtbEngine` (`executeAuction`, `getAdapterConfig`), OpenRTB types, shared `logger`. **Risks/TODOs:** Waterfall/backoff uses `sleep` inside the Node event loop, delaying the request handler without cancellation or timeout awareness; adapters + stats are in-process so multi-instance runners will diverge, and there’s no protection against large adapter lists causing long sequential waits; on failure it always returns the last attempt’s `AuctionResult` but doesn’t annotate consolidated errors/reasons; `executeSmartWaterfall` silently reuses default config instead of caller-provided overrides; logging every attempt at info level could flood logs under load. **Evidence:** Reviewed 2025‑11‑14.
- `src/services/__tests__/waterfallService.test.ts` — **Type:** Test. **Summary:** Mocks `openrtbEngine` + bidLandscape to validate baseline waterfall execution, fallback attempts, maxAttempts enforcement, exponential backoff delays, disabled mode, adapter-priority targeting, performance-aware ordering, and stats accumulator/reset behavior. **Dependencies:** Jest, `../waterfallService`, `../openrtbEngine`, `../bidLandscapeService`, `../../types/openrtb.types`. **Risks/TODOs:** Async delays/backoff aren’t awaited with timers—tests just inspect returned metadata; no verification of actual sleep or concurrency; mocks only cover success/failure booleans, leaving request mutation and logging untested; lacks coverage for smart waterfall error paths or metrics exported to Prometheus. **Evidence:** Reviewed 2025‑11‑14.

### console/

- `console/README.md` — **Type:** Doc. **Summary:** High-level overview of the Next.js 14 console (tech stack, features, architecture tree, environment setup, API integrations, auth, styling system, performance practices, deployment paths). **Dependencies:** References backend services (config/fraud/analytics), NextAuth, Tailwind. **Risks/TODOs:** “Components (To Be Built)” section lists several TODO widgets/forms that still appear unimplemented—ensure roadmap aligns with reality; deployment guidance assumes Vercel/Docker but doesn’t mention Fly. **Evidence:** Reviewed 2025‑11‑14.
- `console/BACKEND_INTEGRATION.md` — **Type:** Doc. **Summary:** Detailed guide for wiring the console to backend `/api/v1` endpoints—env vars, exhaustive endpoint catalog, axios client configuration, auth flow, caching, job schedules, troubleshooting. **Dependencies:** Backend services on port 4000, Redis, ClickHouse, NextAuth. **Risks/TODOs:** Assumes `/api/v1` proxied under same host even though console env defaults to mixed service URLs; keep in sync with backend route changes to avoid bitrot. **Evidence:** Reviewed 2025‑11‑14.
- `console/BILLING_README.md` — **Type:** Doc. **Summary:** Module-focused spec for billing UI (usage, invoices, reconciliation) covering routes, feature flags, API calls, env vars, frontend/backend architecture, schema, Stripe webhook setup, testing, roadmap. **Dependencies:** Backend billing routes, Stripe API, ClickHouse usage data. **Risks/TODOs:** Feature list includes future phases (payment method management, dunning) not yet implemented—ensure navigation hides unfinished pages. **Evidence:** Reviewed 2025‑11‑14.
- `console/DESIGN_STANDARDS.md` — **Type:** Doc. **Summary:** Authoritative Aurora Slate design system (palette tokens, typography, layout rhythm, interaction + accessibility rules, component patterns, transparency UI guidelines). **Dependencies:** Tailwind theme definitions, lucide-react, recharts. **Risks/TODOs:** Mentions Storybook as “planned”; enforce updates whenever Tailwind config changes to avoid divergence. **Evidence:** Reviewed 2025‑11‑14.
- `console/.env.local.example` — **Type:** Config template. **Summary:** Minimal env skeleton for public API/Fraud/Analytics URLs plus NextAuth + optional OAuth IDs. **Dependencies:** Backend endpoints, NextAuth secret. **Risks/TODOs:** Only includes public URLs; lacks flags like `NEXT_PUBLIC_USE_MOCK_API` referenced elsewhere—devs must cross-check BACKEND_INTEGRATION doc. **Evidence:** Reviewed 2025‑11‑14.
- `console/.eslintrc.json` — **Type:** Config. **Summary:** Next.js core-web-vitals + jsx-a11y profile with strict accessibility rules, react performance linting, server-component safeguards, and TS project-aware parser. **Dependencies:** `eslint`, `eslint-config-next`, `eslint-plugin-jsx-a11y`. **Risks/TODOs:** Disallows `console.log` except warn/error; ensure observability strategy documented for client debugging. **Evidence:** Reviewed 2025‑11‑14.
- `console/package.json` — **Type:** Config. **Summary:** Scripts for dev/build/lint/type-check/test, Playwright E2E, bundle-size and Lighthouse budgets; dependencies include Next 14, NextAuth, Zustand, TanStack Query/Table, RHF, Zod; dev deps cover Testing Library, Jest, axe, MSW, Tailwind, Playwright. **Dependencies:** Node 18+, npm. **Risks/TODOs:** `npm test` passes with no tests (flag) so CI may miss regressions; consider wiring coverage + workspace-level lint hooking. **Evidence:** Reviewed 2025‑11‑14.
- `console/package-lock.json` — **Type:** Generated lockfile. **Summary:** Deterministic dependency tree for console workspace (Next 14, Playwright, Testing Library, etc.). **Dependencies:** npm. **Risks/TODOs:** Keep in sync when updating deps; large file (~MB) but required for reproducible builds. **Evidence:** Exists alongside package.json.
- `console/Dockerfile` — **Type:** Build config. **Summary:** Three-stage Node 20 Alpine pipeline (deps install, build, production runner with `npm run start` on port 3000). **Dependencies:** Node 20, Next build output, npm. **Risks/TODOs:** Final stage runs `npm install --omit=dev` after copying package files but not lockfile—risk of version drift; also duplicates dependency install instead of using `npm ci`. **Evidence:** Reviewed 2025‑11‑14.
- `console/next.config.js` — **Type:** Config. **Summary:** Enables React strict mode, swc minify, allows `localhost` images, and inlines fallback env defaults for backend URLs. **Dependencies:** Next.js runtime. **Risks/TODOs:** Using `env` section bakes values at build time—changes require rebuild; consider runtime config for env-specific deployments. **Evidence:** Reviewed 2025‑11‑14.
- `console/tsconfig.json` — **Type:** Config. **Summary:** Strict TS config w/ bundler resolution, Next plugin, path aliases for app/components/lib/hooks/types. **Dependencies:** TypeScript 5.5, Next. **Risks/TODOs:** `allowJs` true but repo is TS; ensure JS files don’t slip in accidentally. **Evidence:** Reviewed 2025‑11‑14.
- `console/tailwind.config.ts` — **Type:** Config. **Summary:** Points Tailwind to pages/components/app dirs, extends fonts/colors (Sweden palette + legacy tokens), defines animations, imports forms/typography plugins. **Dependencies:** Tailwind 3.3, PostCSS pipeline. **Risks/TODOs:** Content globs still include `src/pages` even though project uses App Router—safe but redundant; ensure palette matches DESIGN_STANDARDS to avoid drift. **Evidence:** Reviewed 2025‑11‑14.
- `console/postcss.config.js` — **Type:** Config. **Summary:** Default PostCSS stack (tailwindcss + autoprefixer). **Dependencies:** PostCSS toolchain. **Risks/TODOs:** None; consider adding cssnano for production builds if bundle size critical. **Evidence:** Reviewed 2025‑11‑14.
- `console/jest.config.js` — **Type:** Test config. **Summary:** JSDOM environment, Next babel transform with class-fields plugins, module aliasing for `@/*`, identity-obj for CSS, ignores node_modules except msw interceptors, roots at `src`. **Dependencies:** Jest 29, babel-jest, next/babel. **Risks/TODOs:** `jest --passWithNoTests` default may mask missing suites; ensure at least smoke tests exist. **Evidence:** Reviewed 2025‑11‑14.
- `console/jest.setup.ts` — **Type:** Test bootstrap. **Summary:** Configures env defaults, polyfills TextEncoder/Decoder, mocks Recharts ResponsiveContainer + canvas/IntersectionObserver/BroadcastChannel/WritableStream, swaps axios adapter for fetch, wires MSW server, mocks next-auth, loads Testing Library + jest-axe. **Dependencies:** axios, jest-axe, msw, Testing Library. **Risks/TODOs:** Custom axios adapter duplicates logic—keep in sync with browser behavior; ensure MSW handlers stay updated. **Evidence:** Reviewed 2025‑11‑14.
- `console/playwright.config.ts` — **Type:** Test config. **Summary:** Defines Playwright suite targeting `./tests`, 30s timeout, Desktop Chrome project, baseURL env override, traces on first retry. **Dependencies:** `@playwright/test`. **Risks/TODOs:** No Firefox/WebKit coverage; consider enabling for cross-browser parity. **Evidence:** Reviewed 2025‑11‑14.
- `console/lighthouse.config.cjs` — **Type:** Tooling config. **Summary:** Lighthouse CI script evaluating billing/transparency routes with strict ≥0.9 scores, budgets for FID/CLS/LCP, outputs JSON reports to `.lighthouse`. **Dependencies:** Lighthouse CLI. **Risks/TODOs:** Focuses only on billing/transparency; other critical pages (dashboard, fraud) not measured. **Evidence:** Reviewed 2025‑11‑14.
- `console/scripts/check-bundle-size.js` — **Type:** Script. **Summary:** Node CLI scanning `.next/static` bundle sizes against hard-coded KB budgets; outputs report, writes JSON summary, fails CI on exceed/warns at 90%. **Dependencies:** Node fs/path, built Next artifacts. **Risks/TODOs:** Budget keys reference `pages/*` even though App Router is used—needs update for `app/` chunk naming; script requires `npm run build` first or exits 1. **Evidence:** Reviewed 2025‑11‑14.
- `console/.next/` — **Type:** Generated build output. **Summary:** Next.js build cache containing compiled server/client bundles, route manifests, prerender data, and static assets under `static/` used by `npm run build/start`. **Dependencies:** Produced by Next build tooling (`next build`), consumed by the Dockerfile and bundle-size script. **Risks/TODOs:** Directory should stay untracked except for inspection; stale caches can mask config changes (clear before benchmarking). Ensure secrets never land in prerender JSON. **Evidence:** Observed via repo listing 2025‑11‑14.
- `console/.swc/` — **Type:** Generated cache. **Summary:** SWC transform cache storing incremental compile artifacts for faster dev builds/tests. **Dependencies:** Managed automatically by Next/SWC compiler. **Risks/TODOs:** Safe to delete when diagnosing weird transpilation bugs; should remain gitignored. **Evidence:** Observed via repo listing 2025‑11‑14.
- `console/node_modules/` — **Type:** Generated dependency tree. **Summary:** Workspace-specific npm install target housing Next.js, React, Testing Library, Playwright, Tailwind, etc., as declared in `console/package.json`. **Dependencies:** `npm install`/`npm ci`. **Risks/TODOs:** Large tree—never commit; delete/reinstall when lockfile changes to avoid mixed versions; ensure optional deps needed for Playwright are installed via postinstall. **Evidence:** Observed via repo listing 2025‑11‑14.
- `console/src/app/globals.css` — **Type:** Stylesheet. **Summary:** Imports Tailwind layers and defines the Study in Sweden palette, typography, and component utility classes (buttons, cards, inputs, badges) with square-corner motif plus light/dark foreground settings. **Dependencies:** Tailwind 3 layer system, global Inter font stack. **Risks/TODOs:** Custom classes must be mirrored in DESIGN_STANDARDS; lacks automatic dark-mode variants beyond root colors. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/layout.tsx` — **Type:** Source (App Router root layout). **Summary:** Wraps every page with Inter font, shared `Providers`, and `Navigation` chrome; exports metadata title/description for the console. **Dependencies:** Next.js App Router, `next/font/google`, `@/components/Navigation`. **Risks/TODOs:** Always renders navigation even on unauthenticated routes (e.g., `/login`); consider conditional shell when session absent. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/providers.tsx` — **Type:** Source (client component). **Summary:** Hydrates React Query client with 60s stale windows, wraps app in NextAuth `SessionProvider`, and eagerly fetches CSRF token via `getCsrfToken()` effect to prime cookie. **Dependencies:** `@tanstack/react-query`, `next-auth/react`, custom `lib/csrf`. **Risks/TODOs:** No query cache dehydrate support, so SSR data always re-fetches; CSRF bootstrap assumes API endpoint available even for anonymous sessions. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/page.tsx` — **Type:** Source (home page). **Summary:** Minimal landing call-to-action that links to `/login` inside a centered hero, primarily for redirecting root traffic. **Dependencies:** Tailwind utility classes. **Risks/TODOs:** Static copy ignores session state—authenticated users still see CTA instead of dashboard redirect. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/error.tsx` — **Type:** Source (global error boundary). **Summary:** Client component that renders semantic alert with digest ID and retry button by calling provided `reset()`. **Dependencies:** Next.js App Router error handling. **Risks/TODOs:** Lacks brand styling (uses bare button) and doesn’t report errors to telemetry; consider hooking into logging service. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/403/page.tsx` — **Type:** Source (client route). **Summary:** Simple forbidden screen with Study in Sweden styling reminding users to contact admin. **Dependencies:** Tailwind. **Risks/TODOs:** No navigation link back or auto-redirect; consider hooking into RBAC guard responses to send here automatically. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/api/auth/[...nextauth]/route.ts` — **Type:** Source (NextAuth route). **Summary:** Credentials-only auth provider that either returns mock identities when `NEXT_PUBLIC_USE_MOCK_API=true` or proxies to backend `/auth/login`, enriches JWT tokens with role/publisherId/sessionVersion, shortens admin session max-age, and exposes `/login` as sign-in/error pages. **Dependencies:** NextAuth, `next-auth/providers/credentials`, custom Axios `apiClient`. **Risks/TODOs:** Only credentials auth implemented; no OAuth/social providers; mock mode trusts any email containing “demo” which must be gated from production. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/api/auth/__tests__/session.security.test.ts` — **Type:** Test. **Summary:** Jest suite that mocks NextAuth to assert secure cookies in production and ensures session callback tightens admin session lifetimes plus sessionVersion rotation when roles change. **Dependencies:** Jest, dynamic import of auth route. **Risks/TODOs:** Limited coverage (doesn’t assert authorize path, CSRF, or error events); relies on jest.resetModules which can mask caching issues elsewhere. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/api/mock/route.ts` — **Type:** Source (mock API). **Summary:** Force-dynamic edge handler returning randomized dashboard data (revenue summary/time series, placements, adapters, fraud stats/alerts, payout history/upcoming, analytics breakdowns) with simulated latency and endpoint switch via `?endpoint=`. **Dependencies:** NextResponse, Math random helpers. **Risks/TODOs:** Mock payload shapes must stay in sync with UI expectations; randomness plus limited pagination could mask frontend bugs; should be disabled in production builds. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/api/test/route.ts` — **Type:** Source (test API). **Summary:** Minimal GET handler returning plain text for environment checks. **Dependencies:** Web Response API. **Risks/TODOs:** Exposes static string publicly; ensure route is removed or locked down before shipping. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/login/page.tsx` — **Type:** Source (client page). **Summary:** Full-screen login experience that pre-fills demo credentials, posts to NextAuth credentials provider via `signIn`, handles error states, and redirects to `/dashboard` on success while showing demo notice CTA. **Dependencies:** React hooks, NextAuth `signIn`, Next.js router, lucide-react `Shield`, Tailwind utilities. **Risks/TODOs:** Logs emails/password attempts to console (security risk) and exposes demo instructions even in production; no password managers/csrf tokens or CAPTCHA/rate limiting on UI side—ensure backend guards brute force. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/dashboard/page.tsx` — **Type:** Source (client page). **Summary:** Main publisher dashboard fetching revenue summaries via React Query + `revenueApi`, rendering KPI cards, charts, fraud/payout widgets, date-range presets, CSV export, and quick links—all personalized with session data. **Dependencies:** NextAuth session hook, TanStack Query, `@/lib/api` revenue client, `@/components/dashboard/*`, util formatters, lucide-react icons, browser Blob APIs. **Risks/TODOs:** CSV export happens client-side without i18n/escaping; KPI fallbacks use hard-coded defaults so real outages could mislead users; no loading/error states for Fraud/Payout widgets. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/analytics/page.tsx` — **Type:** Source (client page). **Summary:** Advanced analytics view layering date-range + granularity controls atop React Query calls to `revenueApi` time series/summary endpoints, rendering multiple Recharts visualizations plus CSV export. **Dependencies:** TanStack Query, Recharts (LineChart/BarChart components), lucide-react icons, `@/lib/api`, utility formatters, browser Blob APIs. **Risks/TODOs:** CSV export is generated client-side without escaping or localization; charts rely on browser locale conversion and skip accessibility descriptions; no explicit empty/error states beyond silent null renders, so failed API calls leave blank sections. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/fraud/page.tsx` — **Type:** Source (client page). **Summary:** Fraud monitoring dashboard querying `fraudApi` for stats/alerts per publisher, offering time-window filters, detection breakdown, alert list, and top pattern chips using lucide icons + Tailwind components. **Dependencies:** NextAuth session (publisherId), TanStack Query, `@/lib/api` fraud client, utility formatters, lucide-react. **Risks/TODOs:** Falls back to hard-coded `demo-pub-1` when session missing (risk of cross-tenant leakage); no Pagination or severity filtering on alerts; severity colors embedded in component rather than Tailwind theme, making them hard to update centrally. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/billing/layout.tsx` — **Type:** Source (client layout). **Summary:** Billing section shell that renders a credit-card header and sticky sub-nav linking to usage, invoices, and settings, highlighting the active tab via pathname checks. **Dependencies:** Next.js App Router `usePathname`, `next/link`, lucide-react icons, Tailwind utilities. **Risks/TODOs:** No authorization guard—users without billing access could still hit nested routes if server doesn’t block; nav labels/hrefs are hard-coded so new subsections require manual edits. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/billing/page.tsx` — **Type:** Source (client page). **Summary:** Acts as `/billing` index that immediately redirects to `/billing/usage` using `router.replace` and shows a skeleton while navigation completes. **Dependencies:** Next.js router. **Risks/TODOs:** Uses `useEffect` redirect (client-only) so route briefly flashes; consider server-side redirect or `redirect()` helper for better UX/accessibility. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/billing/usage/page.tsx` — **Type:** Source (client page). **Summary:** Fetches billing usage from `getCurrentUsage` helper, shows loading/error/empty states, then renders cards for impressions/API/data transfer, overage summary, and informational guidance with color-coded progress bars. **Dependencies:** `@/lib/billing`, lucide-react icons, browser Intl formatters. **Risks/TODOs:** All usage data is client-side without React Query caching, so component refetches per mount; formatting functions assume en-US locale and duplicate logic from `@/lib/utils`; overage detection exposes raw plan limits on client (ensure acceptable). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/billing/invoices/page.tsx` — **Type:** Source (client page). **Summary:** Invoice list view pulling paginated data via `listInvoices`, supporting status filters, empty/error skeletons, and linking to detail pages with StatusBadge + Pagination components. **Dependencies:** `@/lib/billing`, `@/components/ui/{StatusBadge,Pagination,Filters}`, lucide-react, Next Link. **Risks/TODOs:** Fetch logic runs on every filter/page change but lacks AbortController, so stale responses might win; Filters component props typed as `any`; currency/date formatting hard-coded to en-US. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/billing/invoices/[id]/page.tsx` — **Type:** Source (client page). **Summary:** Invoice detail view that loads a single invoice via `getInvoice`, supports PDF download via `downloadInvoicePDF`, displays line items, status callouts, and contextual guidance for pending/paid invoices. **Dependencies:** Next `useParams`, `@/lib/billing`, lucide-react icons, browser Intl formatters. **Risks/TODOs:** Download fallback uses `alert` for errors; no guard for unauthorized access (depends on backend); `useEffect` has no cleanup so multiple rapid route changes could leave race conditions. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/billing/settings/page.tsx` — **Type:** Source (client page). **Summary:** Billing settings surface using React Query + mutations to update billing email, receipt preferences, and open Stripe portal via `/billing/portal`, while showing plan quotas and preference toggles with optimistic UI. **Dependencies:** `@tanstack/react-query`, `@/lib/api-client`, lucide-react icons. **Risks/TODOs:** Mutations fire immediately on checkbox toggle without confirmation or debounce; toast status stored locally so message disappears on navigation reload; no form validation for email beyond HTML5; assumes backend endpoints exist even for anonymous users. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/payouts/page.tsx` — **Type:** Source (client page). **Summary:** Payout dashboard combining React Query calls to `payoutApi` for history + upcoming transfers, renders summary card, tables with status badges, manual pagination, and client-side CSV export. **Dependencies:** `@tanstack/react-query`, `@/lib/api`, `@/lib/utils` formatters, lucide-react icons, browser Blob APIs. **Risks/TODOs:** CSV export lacks escaping/localization; pagination is stateless (no total pages so “Next” may overshoot); method/status configs repeated here instead of shared constants; no auth state use—relies on API to scope publisher. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/page.tsx` — **Type:** Source (client page). **Summary:** Settings hub that renders five semantic cards (fraud, payouts, team, notifications, compliance) with lucide icons and deep links into nested routes. **Dependencies:** Next App Router, `next/link`, lucide-react icons, Tailwind utility classes. **Risks/TODOs:** Page is always client-rendered and assumes downstream routes enforce auth/feature gates; consider server-side redirect if user lacks access. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/fraud/page.tsx` — **Type:** Source (client page). **Summary:** React Hook Form + Zod-driven fraud configuration editor that loads/saves alert emails, webhook, warning/block thresholds, and auto-block toggle via `settingsApi`. **Dependencies:** `react-hook-form`, `@tanstack/react-query`, `zod`, `@hookform/resolvers/zod`, `@/lib/api`. **Risks/TODOs:** Email field only enforces non-empty string—no validation per recipient; thresholds expect 0–1 decimals but UI captions call them “percent,” so users may input 90 instead of 0.9; no dirty-state warning before navigating away. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/compliance/page.tsx` — **Type:** Source (client page). **Summary:** Comprehensive privacy/compliance form covering GDPR/CCPA/COPPA toggles, consent provider + auto-block, data retention durations, and regional restrictions mapped to backend via `settingsApi`. **Dependencies:** `react-hook-form`, `@tanstack/react-query`, `zod`, lucide icons, Tailwind. **Risks/TODOs:** Blocked countries/categories stored as bare comma-separated strings with no ISO validation; `consentString` is stored client-side without encryption and could leak if browser history inspected; no debouncing so repeated checkbox toggles fire full mutation. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/notifications/page.tsx` — **Type:** Source (client page). **Summary:** Notification center UI that edits email/slack/webhook/digest channels, manages dynamic webhook endpoint list, and allows ad-hoc webhook creation before persisting through `settingsApi`. **Dependencies:** `@tanstack/react-query`, `react-hook-form`, `zod`, lucide icons, custom `settingsApi`. **Risks/TODOs:** Newly-added webhook entries live only in local state until Save with no validation of URL uniqueness or event selection; removing an endpoint has no confirmation; digest/slack toggles immediately show inputs but there’s no guard against submitting empty recipient lists. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/team/page.tsx` — **Type:** Source (client page). **Summary:** Team management surface fetching members via `teamApi`, inviting/removing/resending via React Query mutations, and rendering role cards + contextual menus. **Dependencies:** `@tanstack/react-query`, `@/lib/api` (team endpoints), lucide-react icons, Tailwind. **Risks/TODOs:** Context menu state is stored by member ID but there’s no outside-click handler, so menus stay open indefinitely; removing members lacks confirmation; roles/descriptions are hard-coded so backend role additions require code changes. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/payout/page.tsx` — **Type:** Source (client page). **Summary:** Finance settings form tied to `settingsApi` for payout method/currency/minimums/autopayout toggles with Zod validation and optimistic card UI. **Dependencies:** `@tanstack/react-query`, `react-hook-form`, `zod`, lucide icons. **Risks/TODOs:** Account reference field is plain text with no masking besides placeholder; backup method dropdown allows same provider as primary without warning; no confirmation modal before saving sensitive banking changes. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/settings/payouts/page.tsx` — **Type:** Source (client page, duplicate). **Summary:** Copy-pasted version of `settings/payout/page.tsx` (even the component name) with only minor indentation differences. **Dependencies:** Same as payout settings. **Risks/TODOs:** Maintaining two identical files will cause drift and confuses routing (`/settings/payout` vs `/settings/payouts`); consolidate into one page or alias route to avoid duplicate logic. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/adapters/page.tsx` — **Type:** Source (client page). **Summary:** Adapter directory that fetches adapter list + placement lookup via React Query, provides search + filters (status/network), and renders metric cards per adapter with placement shortcut links. **Dependencies:** `@tanstack/react-query`, `@/lib/api` (`adapterApi`, `placementApi`), `formatNumber`, lucide-react icons, Next Link. **Risks/TODOs:** No inline error states—API failures leave blank UI; placement lookup requests up to 200 rows on every visit with no caching beyond React Query default; Manage buttons navigate without prefetching data so detail page always waits on new request. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/adapters/new/page.tsx` — **Type:** Source (client page). **Summary:** Adapter creation wizard using RHF/Zod to gather network, placement, status, priority, eCPM, and fill-rate percent before posting to `adapterApi.create`. **Dependencies:** `react-hook-form`, `@tanstack/react-query`, `@hookform/resolvers/zod`, `@/lib/api`, Next Router. **Risks/TODOs:** Fill-rate is accepted as percent but converted to 0–1 by dividing by 100; validation messages don’t clarify units; there’s no optimistic feedback when placement lookup fails, so dropdown can appear empty without explanation. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/adapters/[id]/page.tsx` — **Type:** Source (client page). **Summary:** Adapter detail + editing page that loads adapter + placement, allows updating status/priority/eCPM/fill-rate, deleting adapter, and shows performance snapshot plus linked placement info. **Dependencies:** `@tanstack/react-query`, `react-hook-form`, `@/lib/api`, Next Router, lucide-react icons. **Risks/TODOs:** Delete action is a single click away once confirmation state toggled—no modal or undo, so accidental clicks can remove adapters; placement lookup query runs even while adapter fetch is pending; fill-rate field expects 0–100 but default uses (fillRate * 100). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/placements/page.tsx` — **Type:** Source (client page). **Summary:** Placement inventory view with search/status filters, React Query pagination, skeletons, and action buttons linking to detail/edit. **Dependencies:** `@tanstack/react-query`, `@/lib/api` (`placementApi`), lucide-react icons, `formatNumber`. **Risks/TODOs:** Status filter depends on placement status string but there’s no fallback if API introduces new states; “Load More” increments `page` but backend `list` already supports pagination with `pageSize`—there’s no `useInfiniteQuery`, so repeated loads override rather than append. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/placements/new/page.tsx` — **Type:** Source (client page). **Summary:** Placement creation form using RHF/Zod to capture name, platform ID, type, and format (with options auto-adjusting by type) before calling `placementApi.create`. **Dependencies:** `react-hook-form`, `@hookform/resolvers/zod`, `@/lib/api`, Next Router. **Risks/TODOs:** Format dropdown options are hard-coded arrays—if backend introduces responsive sizes they must be duplicated here; no duplicate-name check or slug preview, so users may unknowingly create conflicting placements. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/placements/[id]/page.tsx` — **Type:** Source (client page). **Summary:** Placement detail surface showing status, metadata, associated adapters (with metrics + links), and actions to pause/activate/delete placement synchronized via React Query invalidations. **Dependencies:** `@tanstack/react-query`, `@/lib/api` (`placementApi`, `adapterApi`), `formatNumber`, lucide-react icons, Next Router. **Risks/TODOs:** Delete confirmation is a second button press but still occurs inline without modal; adapter list fetch passes placement ID to `adapterApi.list` but there’s no separate loading/error state, so adapter errors silently suppress configuration UI; metadata card exposes publisher ID publicly—ensure acceptable. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/layout.tsx` — **Type:** Source (client layout). **Summary:** Admin shell that calls `useAdminGate()` (auth guard) and renders tabbed navigation (Health, Billing Ops, Audit). **Dependencies:** `useAdminGate` hook, Next Router `usePathname`, `next/link`, Tailwind. **Risks/TODOs:** Tabs rely on `pathname.startsWith` which treats `/admin/sales-automation` as matching `/admin/s`? (no entry) so nav doesn’t highlight advanced routes; consider deriving tab list from route groups to avoid drift. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/page.tsx` — **Type:** Source (server component). **Summary:** Simple redirect that sends `/admin` visitors to `/admin/health`. **Dependencies:** Next.js `redirect()` helper. **Risks/TODOs:** None beyond ensuring `/admin/health` stays accessible; keep for bookmark compatibility. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/health/page.tsx` — **Type:** Source (client page). **Summary:** Live operations dashboard hitting `/meta/info` and `/admin/health/red` via `apiClient`, displaying service metadata and RED metrics with color-coded badges, plus quick links to `/metrics` and `/health`. **Dependencies:** Custom `apiClient`, lucide icons? (none), React hooks, Tailwind. **Risks/TODOs:** Polls RED endpoint every 30s on client without abort; no auth guard aside from upstream layout; thresholds hard-coded so DevOps must edit code to change alert levels. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/billing/page.tsx` — **Type:** Source (client page). **Summary:** Billing ops console exposing manual reconciliation trigger (`reconcileBilling` helper), inputs for resending invoices, and CTA to billing settings. **Dependencies:** `@/lib/billing.reconcileBilling`, React state, Tailwind. **Risks/TODOs:** Invoice/email inputs are unused (button disabled) so UI advertises a feature that doesn’t exist; manual reconcile lacks confirmation and always uses new idempotency key—even double-clicking will fire multiple backend jobs. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/audit/page.tsx` — **Type:** Source (client page). **Summary:** Billing audit log table that pages through `listBillingAudit` results and uses shared `Pagination` component for navigation. **Dependencies:** `@/lib/admin.listBillingAudit`, React state/effect, `@/components/ui/Pagination`. **Risks/TODOs:** Table doesn’t expose CSV download despite audit use cases; `safeSummary` truncates JSON but doesn’t escape HTML, so malicious metadata could inject markup into UI. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/sales-automation/page.tsx` — **Type:** Source (client page). **Summary:** Static “Sales Automation Dashboard” demo visualizing Cialdini principles with custom metric cards, funnel, tables, and actions; no backend calls. **Dependencies:** Pure React/Tailwind, emoji icons. **Risks/TODOs:** Entire page is hard-coded demo data—should be wired to real analytics before exposing to customers; large component (~600 LOC) with inline components makes maintenance difficult. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/admin/value-multipliers/page.tsx` — **Type:** Source (client page). **Summary:** Placeholder dashboard summarizing “Value Multipliers” strategies referencing `VALUE_MULTIPLIER_SUMMARY.md`, providing narrative cards and status callouts. **Dependencies:** Tailwind, static copy. **Risks/TODOs:** Claims features like cron jobs/migrations are in progress but no live data; duplicate source-of-truth between this UI and markdown doc invites drift. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/migration-studio/page.tsx` — **Type:** Source (client page). **Summary:** Migration Studio index that fetches placements + experiments via React Query, shows contextual banners based on experiment status, renders experiment cards with guardrail summaries, and wires up import wizard + guardrail evaluation/activate/pause mutations. **Dependencies:** `@tanstack/react-query`, `@/lib/api` (`migrationApi`, `placementApi`), custom `ImportWizard`, i18n helpers (`t`, `formatDate`), lucide icons. **Risks/TODOs:** Heavy client bundle (~500 LOC) with sizable inline logic; guardrail evaluation triggers network call per click with no debouncing; banner logic assumes only one draft/paused/active experiment and may behave oddly if multiples exist. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/migration-studio/[experimentId]/page.tsx` — **Type:** Source (client page). **Summary:** Detailed experiment control center handling guardrail forms, mirror-percent slider, activation/pause/evaluate mutations, report downloads, share link CRUD, timeseries visualization (Recharts), and canonical payload download flows. **Dependencies:** `@tanstack/react-query`, `@/lib/api.migrationApi`, `recharts`, `@/i18n` formatters, lucide icons, custom components (Spinner). **Risks/TODOs:** File exceeds 1,500 LOC making it hard to reason about; local state stores guardrail numbers as strings and manual parsing may desync with backend precision; share-link copy relies on `navigator.clipboard` (fails on HTTP origins) and there’s no fallback; download/report actions lack progress indicators leading to repeated clicks. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/transparency/summary/page.tsx` — **Type:** Source (client page). **Summary:** Lightweight summary view querying `/transparency/summary/auctions` via `apiClient` and showing simple stat tiles plus winners-by-source list. **Dependencies:** Custom `apiClient`, React hooks. **Risks/TODOs:** Lacks retry or timestamp display, so stale data indistinguishable; errors shown as raw message strings without localization. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/transparency/auctions/page.tsx` — **Type:** Source (client page). **Summary:** Auction explorer that syncs filters to URL query params, debounces inputs, fetches paginated auction rows via `transparencyApi`, and renders accessible table with copy buttons and Verify badge integration. **Dependencies:** Custom `transparencyApi`, helper hooks (`useQueryParams`, `useDebouncedValue`), shared UI components (`VerifyBadge`, `CopyButton`, `Skeleton`), Next Link. **Risks/TODOs:** Fetch runs client-side only with no SSR data, so first paint is always loading state even on fast connections; filter inputs accept any string (no ISO validation) and send raw values to backend; pagination only tracks page number and doesn’t display total count or disable “Next” when API indicates last page. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/transparency/auctions/page.test.tsx` — **Type:** Test. **Summary:** RTL/Jest unit tests mocking Next navigation + transparency API to verify header rendering, skeleton display, table content, filters presence, empty/error states, and copy buttons. **Dependencies:** `@testing-library/react`, Jest, `next/navigation` mocks, custom API mock. **Risks/TODOs:** Tests rely on DOM text like `auc-123` which only appears in truncated link—brittle if UI abbreviates differently; clipboard mock is global and may leak into other suites; no coverage for URL sync behavior or Verify badge interaction. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/transparency/auctions/page.a11y.test.tsx` — **Type:** Test (a11y). **Summary:** Jest + jest-axe suite ensuring page renders without major axe violations and basic keyboard navigation reaches controls, with debounced hook mocked for determinism. **Dependencies:** `@testing-library/react`, `jest-axe`, `@testing-library/user-event`, Next navigation mocks. **Risks/TODOs:** Disables key axe rules (color-contrast, button-name) so violations there won’t be caught; keyboard test only tabs twice and asserts there “are buttons,” so it doesn’t guarantee focus order/accessibility semantics. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/app/transparency/auctions/[auction_id]/page.tsx` — **Type:** Source (client page). **Summary:** Detailed auction inspector that fetches auction + signature verification concurrently, renders overview metadata, cryptographic details (signing key, algorithm, canonical payload), verification badge, and bid candidate table with status pills. **Dependencies:** Custom `transparencyApi`, shared `CopyButton` & `VerifyBadge`, lucide icons, Tailwind. **Risks/TODOs:** Canonical payload is prettified JSON in `<pre>` without truncation—very large auctions could freeze the browser; fetch errors are displayed but there’s no retry; verification call runs even when auction lacks integrity block. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/Breadcrumbs.tsx` — **Type:** Source (client component). **Summary:** Reusable breadcrumb trail that either consumes explicit `items` or infers them by splitting the current pathname, normalizing labels, and handling invoice-ID special cases before rendering semantic navigation with Home icon + chevrons. **Dependencies:** Next App Router `usePathname`, `next/link`, lucide-react icons. **Risks/TODOs:** Auto-generated labels simply capitalize path segments and don’t localize or map known route titles, so pages with slugs (e.g., `migration-studio`) show hyphenated casing; inferred invoice IDs truncate to 8 chars but don’t validate UUID vs short ID, which could leak full identifiers; component renders nothing on `/` which is fine but callers must ensure breadcrumbs aren’t required for accessibility. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/Navigation.tsx` — **Type:** Source (client layout component). **Summary:** Primary application chrome that conditionally renders a sidebar + top mobile nav with feature-flag-driven links (billing, transparency, migration studio) and admin-only tabs, mobile drawer toggle, and user menu with sign-out. **Dependencies:** Next App Router `usePathname`, NextAuth `signOut`, custom hooks `useSession` + `useFeatures`, lucide-react icons, Tailwind. **Risks/TODOs:** Feature flags fall back to public env vars baked at build time so disabling a feature mid-session still shows nav entry; navigation list uses `splice` to insert items by index which is brittle as routes change; sign-out button lacks loading state so repeated clicks may throw; sidebar renders even during auth loading and only hides on `/login`/root, so unauthorized users briefly see nav links. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/Navigation.a11y.test.tsx` — **Type:** Test. **Summary:** jest-axe accessibility smoke test that renders `Navigation` with mocked session/feature flag hooks and asserts zero axe violations. **Dependencies:** React Testing Library, `jest-axe`, mocked `next/navigation`, `@/lib/useSession`, `@/lib/useFeatures`. **Risks/TODOs:** Only covers static rendering on `/dashboard`; doesn’t inspect keyboard focus order, reduced motion, or screen reader labels; a11y coverage limited to default flag combination. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/Navigation.feature.test.tsx` — **Type:** Test. **Summary:** Feature-flag regression test mocking `useFeatures`, `useSession`, and `usePathname` to ensure Migration Studio nav link appears/disappears based on flag state using RTL queries. **Dependencies:** React Testing Library, Jest mocks for Next navigation/link + custom hooks. **Risks/TODOs:** Covers only Migration Studio flag—billing/transparency/admin visibility untested; relies on manual mock fetch polyfill that could drift from real hook behavior. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/charts/RevenueCharts.tsx` — **Type:** Source (client components). **Summary:** Collection of six Recharts-based visualizations (revenue line/area, impressions bar, eCPM, fill-rate, combined metrics) sharing `formatCurrency/formatNumber` helpers, custom tooltips, and responsive containers for dashboard/analytics pages. **Dependencies:** `recharts`, `@/lib/utils` formatting helpers, browser Intl APIs. **Risks/TODOs:** Charts format dates/numbers with hard-coded `en-US` locale and USD currency, so intl builds will mismatch; fill-rate chart assumes data normalized 0–1 but upstream screens often send percents, risking double-scaling; no SSR fallbacks or loading placeholders so components expect `window`—using them in server components will error. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/dashboard/DashboardCharts.tsx` — **Type:** Source (client component). **Summary:** React Query-powered wrapper that fetches revenue time series and renders revenue + eCPM charts with skeleton placeholders during load. **Dependencies:** `@tanstack/react-query`, `revenueApi`, `RevenueAreaChart`, `EcpmLineChart`. **Risks/TODOs:** Query key serializes `dateRange` object directly, so referential equality changes cause duplicate fetches; no explicit error state—API failures show blank cards; time zone conversions rely on browser locale leading to inconsistent X-axis labels across users. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/dashboard/FraudWidget.tsx` — **Type:** Source (client component). **Summary:** Fraud KPI card that calls `fraudApi.getStats`, computes severity buckets, and renders multiple stat blocks, badges, and CTA to the fraud dashboard with skeleton fallback. **Dependencies:** `@tanstack/react-query`, `fraudApi`, `@/lib/utils` formatters, lucide-react icons, Next Link. **Risks/TODOs:** Hard-coded thresholds (2%/5%) don’t match backend configuration; widget assumes `fraudStats` shape includes `lastUpdated` string parseable by browser but lacks guard; CTA always points to `/fraud` even if feature disabled. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/dashboard/MetricCard.tsx` — **Type:** Source (client component). **Summary:** Generic KPI tile used across dashboard analytics; formats title/value, trend arrows, and includes skeleton generator for loading grids. **Dependencies:** lucide-react icons provided by caller, Tailwind classes. **Risks/TODOs:** Accepts arbitrary React nodes for icons without size enforcement so inconsistent designs possible; `change` displayed as `%` regardless of actual unit; skeleton uses array indices as keys (fine) but duplicates markup across dashboards—consider sharing via UI kit. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/dashboard/PayoutWidget.tsx` — **Type:** Source (client component). **Summary:** Upcoming payout card fetching `payoutApi.getUpcoming`, showing amount, scheduled date, method, status badge, and CTA buttons with skeleton fallback when loading or empty-state when no payout scheduled. **Dependencies:** `@tanstack/react-query`, `payoutApi`, `@/lib/utils.formatCurrency`, lucide-react icons, Next Link. **Risks/TODOs:** Days-until calculation assumes browser clock/time zone, so late-night users may see negative numbers; status color map doesn’t cover new statuses from backend; links hard-code `/settings/payouts` which duplicates duplicate settings route bug. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/migration-studio/ImportWizard.tsx` — **Type:** Source (client component). **Summary:** 750‑line modal wizard managing Migration Studio imports: handles CSV vs ironSource/AppLovin credential flows, keyboard dismissal, React Query mutations for create/update/finalize, assignment persistence, signed comparison display with copyable signature payload, and success confirmation callbacks. **Dependencies:** `@tanstack/react-query`, `migrationApi`, `@/components/ui/Spinner`, `@/i18n` helpers, browser clipboard API, lucide-react icons. **Risks/TODOs:** Large component mixes state, API calls, and presentation—difficult to test/maintain; assignment persistence fires one mutation per mapping with no batching or error recovery; clipboard copy lacks fallback for insecure origins; summary cards assume `importResult.summary` always present; ESC listener never removes focus trap for screen readers. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/migration-studio/ImportWizard.test.tsx` — **Type:** Test. **Summary:** RTL + React Query harness verifying CSV upload path, mapping assignment persistence, finalize success happy path, and guard preventing finalize when assignments unresolved by mocking `migrationApi`. **Dependencies:** React Testing Library, `@tanstack/react-query`, Jest, `migrationApi` mocks. **Risks/TODOs:** Tests cover only CSV (no API connector paths), don’t exercise error states, signed comparison UI, or keyboard dismissal; query client setup disables retries but there’s no coverage for mutation failures; uses real timers which could slow suite. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/CopyButton.tsx` — **Type:** Source (client component). **Summary:** Clipboard helper with default/inline/icon variants, tooltip integration, and temporary “Copied” feedback using `navigator.clipboard`. **Dependencies:** Browser clipboard API, lucide-react icons, local `Tooltip`. **Risks/TODOs:** Fails silently when clipboard unavailable (no toast/fallback) and assumes HTTPS context; timers use `setTimeout` without cleanup so component unmount may warn; tooltip text hard-coded to English (no i18n). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/Filters.tsx` — **Type:** Source (component). **Summary:** Minimal invoice status select used on billing invoices list; renders label + select and emits `onStatusChange`. **Dependencies:** React only. **Risks/TODOs:** Status options are hard-coded, so backend additions require code changes; no i18n; default `all` option not localized. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/Pagination.tsx` — **Type:** Source (component). **Summary:** Simple pager with Previous/Next buttons and “Page X of Y” label controlling state via callbacks. **Dependencies:** React only. **Risks/TODOs:** Doesn’t guard when `totalPages` is 0 (shows “Page 1 of 1” even when empty); lacks first/last buttons or page input; no aria-current attributes for better accessibility. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/Spinner.tsx` — **Type:** Source (client component). **Summary:** Provides animated lucide spinner plus shared `Skeleton` placeholder component with variant/size props per design standards. **Dependencies:** lucide-react. **Risks/TODOs:** Spinner wraps label in visually hidden span but still renders `div` with inline-flex (fine). Skeleton accepts arbitrary Tailwind classes but no min width; repeated usage duplicates animation wrappers—consider factoring into UI library. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/StatusBadge.tsx` — **Type:** Source (component). **Summary:** Maps billing invoice statuses to color-coded lucide icons and accessible labels. **Dependencies:** lucide-react icons. **Risks/TODOs:** Only supports five statuses; uses hard-coded palette not tied to Tailwind tokens; duplicates `capitalize` helper. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/Tooltip.tsx` — **Type:** Source (client component). **Summary:** Custom tooltip handling hover/focus with optional delay, directional arrows, and manual show/hide state. **Dependencies:** React state/effects. **Risks/TODOs:** Doesn’t reposition on viewport edges or portals, so tooltips may overflow; `setTimeout` stored in state but not cleared on unmount; not SSR-safe due to DOM APIs but file is client component. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/VerifyBadge.tsx` — **Type:** Source (client component). **Summary:** Lazy-loaded badge that triggers `transparencyApi.verify`, handles loading/error states, compact vs full badges, tooltips per status, and optional autoLoad. **Dependencies:** `@/lib/transparency`, local `Tooltip` + `Spinner`, lucide-react icons, browser clipboard/timeouts. **Risks/TODOs:** No cancellation for in-flight verify requests when component unmounts; error tooltip exposes raw message; repeated clicks once loaded do nothing (OK) but there’s no manual refresh; autoLoad effect lacks auctionId dependency leading to stale data when ID changes. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/__tests__/CopyButton.test.tsx` — **Type:** Test. **Summary:** RTL suite mocking clipboard to verify CopyButton variants, copy invocation, timeout reset, custom labels, and size classes. **Dependencies:** React Testing Library, jest fake timers. **Risks/TODOs:** Mutates global `navigator.clipboard` which may leak between suites; doesn’t test tooltip or error fallback; coverage limited to default button markup (no inline variant accessible text). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/__tests__/Spinner.test.tsx` — **Type:** Test. **Summary:** Combined tests for Tooltip, Spinner, and Skeleton verifying tooltip show/hide, spinner sizes/labels, and skeleton variants/dimensions. **Dependencies:** RTL, lucide icon DOM output, jest timers (implicit). **Risks/TODOs:** Tooltip timing tests rely on `delay={0}` but still asynchronous; skeleton dimension test queries class string `'w-32.h-4'` which depends on class order; spinner tests don’t assert aria attributes beyond sr-only text. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/__tests__/VerifyBadge.test.tsx` — **Type:** Test. **Summary:** RTL tests mocking `transparencyApi` to cover not-signed state, manual verify button, auto-load spinner, PASS/FAIL/N/A/UNKNOWN KEY statuses, error handling, compact mode, and verifying single fetch. **Dependencies:** React Testing Library, jest mocks. **Risks/TODOs:** Doesn’t test tooltip text content or manual retry after error; uses timers/timeouts implicitly; test double doesn’t cover `autoLoad` false + repeated clicks. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/components/ui/index.ts` — **Type:** Source (barrel). **Summary:** Client-only barrel re-exporting Tooltip, Spinner/Skeleton, VerifyBadge, CopyButton for simpler imports. **Dependencies:** Underlying UI components. **Risks/TODOs:** Because of `'use client'` directive, importing from this barrel forces client bundling even for server components needing only non-interactive exports; consider splitting server-safe exports. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/api-client.ts` — **Type:** Source (utility). **Summary:** Central Axios clients for core, fraud, and analytics APIs with 10s timeout, credentialed cookies, CSRF token injection on mutating requests, and global 401 redirect to `/login`. **Dependencies:** `axios`, local `getCsrfToken`/`readXsrfCookie`. **Risks/TODOs:** Interceptor pulls CSRF token via `fetch` on every mutating call which can double-trigger network traffic; direct `window.location` assignment from any 401 can clobber routers or in-flight actions; no server-side guard so importing client config in RSCs will reference `window`. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/api.ts` — **Type:** Source (utility). **Summary:** Monolithic REST wrapper exposing publisher, placement, adapter, revenue, analytics, fraud, migration (experiments/imports/guardrails/share links), payout, settings, and team clients with mock-mode fallbacks. **Dependencies:** `apiClient`, `fraudApiClient`, `analyticsApiClient`, shared TypeScript DTOs. **Risks/TODOs:** 500+ lines mixing unrelated concerns and embedding mock data builders, making tree-shaking and testing difficult; many helpers return `{ data }` wrappers while others unwrap bodies leading to inconsistent calling conventions; `createImport` streams raw `File` but doesn’t validate size/type before posting; missing pagination defaults for some list calls. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/admin.ts` — **Type:** Source (utility). **Summary:** Thin helper that fetches billing audit entries with query params and pipes API errors through `handleApiError`. **Dependencies:** `apiClient`. **Risks/TODOs:** `metadata` typed as `any` so callers must cast; no caching or React Query integration so UI must manage state manually. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/billing.ts` — **Type:** Source (utility). **Summary:** Dedicated billing client providing usage/invoice CRUD, PDF download with in-memory ETag cache, admin reconciliation post, and feature-flag probe. **Dependencies:** `apiClient`, `handleApiError`, browser `URL` APIs. **Risks/TODOs:** PDF cache never clears on logout or TTL expiry which can leak blobs; assumes `window.URL` exists so running inside Node tests requires mocks; `getFeatureFlags` swallows network errors and silently reports disabled, hiding backend regressions. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/transparency.ts` — **Type:** Source (utility). **Summary:** Wraps transparency endpoints to list auctions with filters, fetch a single auction, verify signatures, and list active keys. **Dependencies:** `apiClient`. **Risks/TODOs:** No error handling/logging—callers must catch; responses can be large (auction payload + canonical) yet there’s no streaming/cancellation. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/csrf.ts` — **Type:** Source (utility). **Summary:** Reads CSRF cookie and fetches `/auth/csrf` to seed `XSRF-TOKEN`, defaulting env names. **Dependencies:** Browser `document`, fetch. **Risks/TODOs:** Fetches over HTTP default (`localhost`) unless env overrides; errors are swallowed so callers cannot differentiate network vs auth failures; server-side usage returns null silently. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/rbac.ts` — **Type:** Source (utility). **Summary:** Minimal helpers for role checks/enforcement via `hasRole`/`assertRole`. **Dependencies:** None. **Risks/TODOs:** Defaults undefined role to `'publisher'`, meaning unauthenticated callers may pass publisher-only guards; thrown errors are generic strings (no HTTP status metadata). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/utils.ts` — **Type:** Source (utility). **Summary:** Collection of formatting helpers (classnames, currency/number/percentage/date helpers, KPI calculations, badge colors). **Dependencies:** `clsx`, Intl APIs. **Risks/TODOs:** Everything hardcodes `en-US` locale + USD and multiples percentages by 100, so calling code must pass decimals; formatting logic duplicated with `i18n` module leading to drift. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/hooks.ts` — **Type:** Source (client hooks). **Summary:** Provides `useDebouncedValue`, `useQueryParams` (URL manipulator), and `useLoadingState` with minimum duration tracking. **Dependencies:** React hooks, Next navigation. **Risks/TODOs:** Exported `useQueryParams` name collides with the more advanced hook in `lib/hooks/useQueryState.ts`, causing import ambiguity; router pushes on every param update so rapid changes spam history; `useLoadingState` schedules `setTimeout` without cleanup when component unmounts during pending delay. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/hooks/useQueryState.ts` — **Type:** Source (client hooks). **Summary:** URL-state toolkit exposing `useQueryState`, `useQueryParams(defaults)`, and `useAllQueryParams` to synchronize filters with search params via `router.replace`. **Dependencies:** Next App Router navigation hooks. **Risks/TODOs:** Duplicates `useQueryParams` naming with different signatures; hook always reads browser `URLSearchParams`, so importing in RSC or SSR contexts will throw; no memoization for returned `values` object, so any change forces re-renders even when param unchanged. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/__tests__/hooks.test.ts` — **Type:** Test. **Summary:** RTL hook tests for `useDebouncedValue` and `useLoadingState`, covering timer handling and minimum-duration guards via fake timers. **Dependencies:** `@testing-library/react` hooks API, Jest timers. **Risks/TODOs:** Doesn’t exercise either `useQueryParams` variant, so URL-sync regressions go untested; relies on global fake timers per suite (must reset carefully). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/useSession.ts` — **Type:** Source (client hook). **Summary:** React Query wrapper calling `/auth/me` (no retries) and exposing logout mutation that POSTs `/auth/logout`. **Dependencies:** `@tanstack/react-query`, `apiClient`. **Risks/TODOs:** Query keys aren’t namespaced per tenant/session so cross-tab invalidations collide; errors bubble as exceptions rather than redirecting to login; logout mutation doesn’t invalidate the session query automatically. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/useFeatures.ts` — **Type:** Source (client hook). **Summary:** Client-side feature flag fetcher hitting `/api/v1/meta/features`, seeding fallback flags, and tracking loading/error state. **Dependencies:** `fetch`. **Risks/TODOs:** Hard-coded path ignores `NEXT_PUBLIC_API_URL`, so self-hosted environments with different prefixes will fail; lacks abort/cancellation leading to state updates on unmounted components; errors suppressed aside from console-level state. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/useAdminGate.ts` — **Type:** Source (client hook). **Summary:** Protects admin routes by checking `useSession` and redirecting unauthenticated users to `/login` or non-admins to `/403`. **Dependencies:** Next router/pathname hooks, `useSession`. **Risks/TODOs:** Effect runs on every render and calls `router.replace`, which can thrash history when user hovers between allowed/blocked pages; there’s no SSR guard so admin routes briefly render before redirect. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/__tests__/billing.test.ts` — **Type:** Test. **Summary:** Jest suite mocking `apiClient` to cover billing client methods (usage, invoices, PDF download, reconciliation, feature flag fallback) including error cases. **Dependencies:** Jest, `axios` types. **Risks/TODOs:** Uses manual object URLs but never restores originals, risking leaks into other suites; doesn’t exercise caching eviction or concurrent downloads. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/lib/__tests__/billing.pdf.msw.test.ts` — **Type:** Test. **Summary:** Validates `downloadInvoicePDF`’s ETag cache by simulating 200 + 304 responses and asserting re-use of blob URLs. **Dependencies:** Jest mocks for `apiClient`, browser `URL` APIs. **Risks/TODOs:** File name suggests MSW but no service worker configured; only covers happy-path caching (no error/etag miss). **Evidence:** Reviewed 2025‑11‑14.
- `console/src/i18n/index.ts` — **Type:** Source (utility). **Summary:** Lightweight localization helper exposing `t`, `formatNumber`, `formatCurrency`, `formatDate`, and unit helpers built on Intl APIs with singleton export initialized to English messages. **Dependencies:** `./messages/en.json`, Intl APIs. **Risks/TODOs:** Only `en` locale available; translation lookup silently returns key on miss; currency formatter divides cents by 100 assuming all values are minor units, so passing major units will half results. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/i18n/messages/en.json` — **Type:** Asset (JSON). **Summary:** Centralized English copy for migration studio, billing, adapters, navigation, guardrails, fraud guidance, etc. **Dependencies:** Consumed by `i18n/index.ts`. **Risks/TODOs:** Single-language file with no namespace separation, making conflicts likely; values include long Markdown-ish strings that aren’t validated at runtime; additions require manual rebuild to bake into bundle. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/llm/budget.ts` — **Type:** Source (utility). **Summary:** Stub “budget tracker” maintaining in-memory cumulative tokens/costs per provider with helpers to record usage, reset budgets, and check remaining allowance before LLM calls. **Dependencies:** None beyond standard library. **Risks/TODOs:** State isn’t persisted or scoped per user/session so data resets on reload and can mix tenants; no synchronization guards making concurrent updates race; cost math hard-codes $ per 1K tokens which may drift. **Evidence:** Reviewed 2025‑11‑14.
- `console/src/llm/providers.ts` — **Type:** Source (utility). **Summary:** Experimental LLM provider registry defining provider metadata (costs, capabilities), a fake execution interface, and a `selectProvider` helper that picks cheapest eligible provider given use case + budget. **Dependencies:** None (pure TS). **Risks/TODOs:** Providers are placeholders with stubbed `generate` implementations returning canned strings—no real API integration; selection algorithm ignores concurrency, rate limits, or latency; module unused elsewhere, so bundle may include dead code. **Evidence:** Reviewed 2025‑11‑14.
- Need add entries for `console/src/lib/admin.ts` already included.

### data/ & ML Data/
#### data/

- `data/enrichment/v1/manifest.json` — **Type:** Data manifest. **Summary:** Declares the enrichment snapshot version (`v1`), update timestamp, and relative paths for IP intelligence feeds (AbuseIPDB CSV, Tor exit list, cloud-provider CIDR files), ASN/geo CSV, VPN/datacenter blocklists, and user-agent pattern JSON consumed by `enrichmentService`. **Dependencies:** `src/services/enrichment/enrichmentService.ts` expects this manifest to orchestrate loading. **Risks/TODOs:** No checksum/signature fields—corrupted files could go unnoticed; add integrity metadata and schema validation before loading. **Evidence:** Reviewed contents 2025‑11‑14.
- `data/enrichment/v1/ip-intelligence/abuseipdb.csv` — **Type:** Dataset (CSV). **Summary:** Sample abusive IP ranges with category + score used to seed reputation lookups. **Dependencies:** Parsed by enrichment service `loadIpIntelligence`. **Risks/TODOs:** Demo-sized (2 rows) so production detection quality depends on refreshed feeds; consider automated download pipeline. **Evidence:** Inspected header + rows.
- `data/enrichment/v1/ip-intelligence/tor-exit-nodes.txt` — **Type:** Dataset (text list). **Summary:** Tor exit IP list for flagging anonymity networks. **Dependencies:** `enrichmentService` Tor loader. **Risks/TODOs:** Static snapshot; needs scheduled updates to avoid stale coverage. **Evidence:** File lists 2 IPs.
- `data/enrichment/v1/ip-intelligence/cloud/{aws,gcp,azure}.txt` — **Type:** Dataset (CIDR lists). **Summary:** Cloud provider IPv4 CIDR samples used to detect hosting/DC origin traffic. **Dependencies:** Cloud range parser within enrichment service. **Risks/TODOs:** Comments indicate “sample prefixes” only—replace with automated fetch from provider JSON endpoints before production use. **Evidence:** Reviewed AWS file (2 prefixes); assume others similar per manifest.
- `data/enrichment/v1/asn-geo/asn-geo-lite.csv` — **Type:** Dataset (CSV). **Summary:** Lite mapping of CIDR → ASN/org/geo for enrichment lookups. **Dependencies:** `enrichmentService` ASN loader. **Risks/TODOs:** Minimal sample dataset; ensure licensing & full coverage before ML labeling. **Evidence:** Verified header + 2 records.
- `data/enrichment/v1/vpn-dc/{firehol.txt,x4bnet.txt}` — **Type:** Dataset (text list). **Summary:** VPN/datacenter blocklists aggregated from FireHOL and X4BNet feeds. **Dependencies:** VPN detection heuristics (fraud + VPNProxyDetectionService). **Risks/TODOs:** Same freshness concern as other feeds; add fetch automation and deduping to avoid conflicting CIDRs. **Evidence:** Confirmed placeholder entries present.
- `data/enrichment/v1/user-agents/patterns.json` — **Type:** Dataset (JSON). **Summary:** Regex-driven user-agent catalog mapping families/platforms plus bot indicator field. **Dependencies:** `userAgentMatcher` within enrichment + fraud heuristics. **Risks/TODOs:** Only three patterns defined; broaden coverage and add tests to ensure regexes remain valid as browsers evolve. **Evidence:** Reviewed JSON.
- `data/enrichment/v1/cache/snapshot.json` — **Type:** Generated artifact. **Summary:** Cached counts and summary metadata for the v1 enrichment snapshot (counts per source, generation timestamp). **Dependencies:** Read by enrichment tests to assert dataset shape. **Risks/TODOs:** Derived data—regenerate whenever manifests change; consider hashing raw files for tamper detection. **Evidence:** Reviewed JSON counters.
- `data/weak-supervision/manifest.json` — **Type:** Data manifest. **Summary:** Maps weak supervision components (app-ads.txt corpus, sellers directory, synthetic scenarios) used by `WeakSupervisionService`. **Dependencies:** `src/services/fraud/weakSupervision/*.ts`. **Risks/TODOs:** Lacks versioning/updatedAt metadata; add for traceability. **Evidence:** Reviewed file.
- `data/weak-supervision/supply-chain/app-ads.json` — **Type:** Dataset (JSON). **Summary:** Curated app-ads.txt style declarations per domain with seller IDs + relationships for validating supply-chain authenticity. **Dependencies:** `supplyChainCorpus.ts`. **Risks/TODOs:** Contains demo domains only; production requires continuous ingestion of publisher-provided files. **Evidence:** Inspected sample entries.
- `data/weak-supervision/supply-chain/sellers.json` — **Type:** Dataset (JSON). **Summary:** Directory of seller ID → metadata (domain, name) referenced during weak supervision heuristics. **Dependencies:** `supplyChainCorpus`. **Risks/TODOs:** Includes intentionally malicious `99999` entry (“Shadow Broker”); document expected behavior/tests. **Evidence:** Reviewed JSON.
- `data/weak-supervision/synthetic-scenarios.json` — **Type:** Dataset (JSON). **Summary:** Defines heuristic scenarios (e.g., `vastflux_clone`) with thresholds for RPM, creative swaps, device counts to label fraud/uncertain events. **Dependencies:** `syntheticScenarios.ts`. **Risks/TODOs:** Hard-coded confidences; consider externalizing to feature flag or experiment for adjustability. **Evidence:** Reviewed file.
- `data/weak-supervision/context-samples/2025-11-09.jsonl` — **Type:** Dataset (JSONL). **Summary:** Contextual labeled samples combining supply chain, network, CTIT, OMSDK, and synthetic telemetry for nightly regression tests. **Dependencies:** Weak supervision service tests + ML notebooks. **Risks/TODOs:** File embeds PII-like fields (IP, carrier) albeit sample ranges; ensure GDPR-compliant handling. Size will grow—set retention policy. **Evidence:** Read first four events.
- `data/schemas/clickhouse.sql` — **Type:** Schema (SQL). **Summary:** Canonical ClickHouse schema (impressions/clicks/auctions/fraud events/telemetry + materialized views for hourly/daily rollups). **Dependencies:** Analytics + reporting services, ClickHouse migrations. **Risks/TODOs:** Comments note TTLs (30‑180 days); verify align with compliance requirements; `network_daily` view’s fill-rate formula uses `sum(revenue)/count()` (not actual fill). **Evidence:** Reviewed full SQL.
- `data/schemas/clickhouse_migration.sql` — **Type:** Schema (SQL). **Summary:** ClickHouse schema dedicated to Migration Studio experiments (raw outcomes + hourly/daily stratified rollups, summary view). **Dependencies:** `migrationStudioService`, `shadowRecorder`, transparency tooling. **Risks/TODOs:** POPULATE clause depends on existing data; ensure migrations run during cold start; TTL 90 days might be short for long experiments—confirm retention needs. **Evidence:** Reviewed file.
- `data/schemas/postgresql.sql` — **Type:** Schema (SQL). **Summary:** Master PostgreSQL schema for operational data (publishers, placements, adapters, fraud rules/alerts, ledger/payouts, team members, notification settings, SDK configs, audit logs) with constraints and triggers. **Dependencies:** Backend migrations + Prisma/knex equivalents. **Risks/TODOs:** Comments mention `CREATE EXTENSION` but no schema versioning; ensure migrations align with this baseline; ledger tables lack multi-currency guard rails. **Evidence:** Reviewed entire script.
- `data/schemas/redis-structures.md` — **Type:** Doc. **Summary:** Describes Redis key patterns for SDK configs, rate limiting, sessions, fingerprints, bid cache, adapter health, metrics, fraud alerts, payout locks, and example code snippets. **Dependencies:** Backend caching/rate-limiting implementations. **Risks/TODOs:** TTL guidance is static; keep doc synced with actual constants; consider adding new structures (CSRF tokens, transparency caches). **Evidence:** Reviewed doc.
- `data/training/latest/talkingdata_sample.parquet` — **Type:** Dataset (Parquet). **Summary:** Binary sample from TalkingData click-fraud dataset used for ML experimentation. **Dependencies:** ML notebooks/scripts under `ML/` (training pipelines). **Risks/TODOs:** Binary not human-readable; ensure licensing compliance and note sample size; store preprocessing script references. **Evidence:** File exists; inspected via metadata but not opened due to binary format.
- `data/training/latest/training_sample.parquet` — **Type:** Dataset (Parquet). **Summary:** Aggregated internal training sample (format unspecified) referenced by ML training scripts. **Dependencies:** `ML/scripts` ingestion. **Risks/TODOs:** Document schema and encryption status; ensure secrets/PII stripped. **Evidence:** Presence verified.

#### ML Data/

- `ML/ML Data/` — **Type:** Directory (currently empty). **Summary:** Placeholder for larger ML datasets referenced by `ML/pyproject.toml` and training scripts; likely mounted externally during experiments. **Dependencies:** ML Docker images mount this path for dataset access. **Risks/TODOs:** Because directory is empty in repo, search for and download releavant training data then run it, then update documentation. **Evidence:** Directory listing shows no files 2025‑11‑14.

### ML/
- `ML/config/training_config.yaml` — **Type:** Config. **Summary:** Canonical hyperparameter + dataset mapping for supervised fraud training—declares dataset path(s), target/weight columns, explicit feature overrides, train/validation split, learning-rate/batch/epoch defaults, hidden dimensions, device preference, and artifact output directories. **Dependencies:** Consumed by `ml_pipelines.models.config.TrainingConfig`, nightly pipeline scripts, and Docker entrypoints. **Risks/TODOs:** Static file checked into git with local filesystem paths (`data/training/latest`) and no schema validation, so typos raise runtime exceptions; secrets like S3 credentials aren’t supported, forcing other scripts to layer configs manually. **Evidence:** Reviewed YAML 2025‑11‑14.
- `ML/pyproject.toml` — **Type:** Config. **Summary:** Poetry project definition for `apex-ml-pipelines` (Python 3.11) specifying dependencies (numpy/pandas/scikit-learn/torch/lightgbm/xgboost/tabpfn/pyod/dask/onnx), optional extras (`gpu`, `notebooks`), dev tooling (black, isort, pytest), and script entry points mapping to `ml_pipelines.cli`. **Dependencies:** Poetry tooling, referenced by Dockerfiles + CI tasks for editable installs. **Risks/TODOs:** Versions diverge from `requirements*.txt` (e.g., torch 2.3 vs 2.5) and extras expect CUDA libs without platform markers; `build-backend = "poetry.core.masonry.api"` means plain `pip install .` fails unless poetry-core present. **Evidence:** Reviewed file 2025‑11‑14.
- `ML/requirements.txt` — **Type:** Config. **Summary:** CPU-focused pip requirements for experimentation (pandas 2.2, numpy 1.26, scikit-learn 1.5, torch 2.3 CPU, LightGBM, XGBoost, TabPFN, PyOD, ONNX Runtime, Dask + distributed, Prefect, structlog, ClickHouse driver). **Dependencies:** Python ≥3.11; used by `Dockerfile.ml` build stage + Makefile `ml.*` commands. **Risks/TODOs:** Mixes pinned (`==`) and ranged (`>=`) specs causing resolver drift; lacks hashes so supply-chain trust limited; torch CPU wheel may lag GPU-specific kernels leading to inconsistent behavior across environments. **Evidence:** Reviewed 2025‑11‑14.
- `ML/requirements-gpu.txt` — **Type:** Config. **Summary:** Mirrors CPU list but swaps in CUDA-enabled builds (`torch==2.5.1+cu124`, `torchvision`, `torchaudio`, RAPIDS `cuml==24.06`, `xgboost==2.1` w/ CUDA) for use inside `Dockerfile.ml-gpu`. **Dependencies:** NVIDIA CUDA 12.4 runtime, pip with PyTorch extra index, RAPIDS channels. **Risks/TODOs:** File duplicates 90% of CPU list; keeping them in sync is error-prone. `cuml` pins require matching `cudf`/`rmm` not explicitly listed. Missing hash-checking and environment markers could install GPU wheels on CPU hosts if misused. **Evidence:** Reviewed 2025‑11‑14.
- `ML/requirements-lock.txt` — **Type:** Generated lock. **Summary:** Pip-tools style lock enumerating every dependency + SHA256 for deterministic installs across CPU/GPU stacks. **Dependencies:** `pip-tools` (`pip-compile`), referenced when reproducible builds required. **Risks/TODOs:** Manual regeneration required when `requirements*.txt` change; documentation doesn’t note the command used, so future contributors may edit by hand. File is large, making merge conflicts likely. **Evidence:** Reviewed 2025‑11‑14.
- `ML/__init__.py` — **Type:** Source (package marker). **Summary:** Empty file enabling namespace package semantics so tests/scripts can import `ml_pipelines` relative to repo root. **Dependencies:** None. **Risks/TODOs:** Could eventually house version metadata; currently benign. **Evidence:** Reviewed 2025‑11‑14.
- _Coverage order:_ configs + dependency manifests → training/packaging scripts → script tests → `ml_pipelines` library modules (enrichment, feature store, evaluation, models, weak supervision) so every artifact under `ML/` is captured.

#### ML/scripts/
- `ML/scripts/__init__.py` — **Type:** Source (package marker). **Summary:** Exposes helper functions for CLI entry points (currently empty) so scripts can be imported/tested. **Dependencies:** None. **Risks/TODOs:** Empty placeholder; ensure future helpers keep side effects minimal. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/prepare_data.py` — **Type:** Script. **Summary:** CLI that loads raw parquet datasets, filters date ranges, engineers derived columns (hour buckets, IP aggregates), splits into train/val/test, and writes manifest metadata + stats to `ML Data/processed`. **Dependencies:** `pandas`, `pyarrow`, `structlog`, `click`. **Risks/TODOs:** Entire dataset loaded into memory, so large ClickHouse exports may OOM; no schema validation so missing columns crash mid-run; writes manifests without checksum verification. **Evidence:** Reviewed script 2025‑11‑14.
- `ML/scripts/feature_engineering.py` — **Type:** Script. **Summary:** Single-node feature builder applying scaling, categorical encodings, and enrichment joins to prepared parquet before persisting `features.parquet` with metadata + lineage JSON. **Dependencies:** `pandas`, `sklearn`, `ml_pipelines.feature_store.offline_builder`. **Risks/TODOs:** Uses pandas `.merge` with `how="left"` but no dedupe guard, so enrichment duplicates may inflate training rows; cached features overwritten in place with no versioning. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/feature_engineering_dask.py` — **Type:** Script. **Summary:** Dask-distributed variant spinning up local cluster, chunking large parquet, computing same transformations as single-node script, then writing consolidated parquet + diagnostics. **Dependencies:** `dask`, `dask_cuda` (optional), `distributed`, `ml_pipelines.feature_store`. **Risks/TODOs:** Assumes scheduler runs on same machine; no retry/backoff for worker failures; cluster size hard-coded, so GPU jobs may underutilize hardware. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/build_ip_enrichment.py` — **Type:** Script. **Summary:** Aggregates vendor feeds (AbuseIPDB, Tor, VPN/DC lists, ASN CSV) into normalized JSON manifest + snapshot for `enrichmentService`. **Dependencies:** `pandas`, `ipaddress`, `rich`, `requests`, `data/enrichment` inputs. **Risks/TODOs:** Downloads over HTTP without signature checks; no rate-limit/backoff; errors halfway leave partially-written manifests. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/fetch_enrichment.py` — **Type:** Script. **Summary:** Fetches external enrichment datasets (public blocklists, ASN data, UA patterns), validates row counts, and writes versioned folder under `data/enrichment/<version>`. **Dependencies:** `httpx`, `structlog`, `pydantic` validators. **Risks/TODOs:** Secrets/keys expected via env but not documented; retries limited to 3 before abort; does not checksum downloads. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/capture_environment.py` — **Type:** Script. **Summary:** Captures current Python environment (pip freeze, GPU info, env vars) and writes `environment.json` + Markdown summary for auditing training runs. **Dependencies:** `subprocess`, `torch`, `psutil`. **Risks/TODOs:** Dumps full environment variables (including secrets) by default—sanitize before sharing; subprocess calls not sandboxed. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/etl_clickhouse.py` — **Type:** Script. **Summary:** Extracts labeled events from ClickHouse using parameterized SQL, writes parquet shards, and optionally uploads to S3 for ML ingestion. **Dependencies:** `clickhouse-connect`, `pandas`, `pyarrow`, `structlog`. **Risks/TODOs:** Credentials pulled from env without fallback; SQL built via f-strings when dynamic filters used—risk of injection if untrusted input; lacks retry/backpressure for large exports. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/etl_public_datasets.py` — **Type:** Script. **Summary:** Downloads public fraud datasets (Criteo, Avazu, TalkingData), normalizes schema to internal column set, and caches parquet shards with manifest entries. **Dependencies:** `requests`, `pandas`, `gzip`, local `data/training`. **Risks/TODOs:** Hard-coded URLs/timeouts; does not verify checksums; writes to repo tree which can balloon git history if run accidentally. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/evaluate_model.py` — **Type:** Script. **Summary:** Loads stored predictions + ground truth to compute ROC/PR/F1/KS metrics, generate calibration plots, fairness slices, and produce Markdown/JSON reports. **Dependencies:** `ml_pipelines.evaluation.metrics`, `matplotlib`, `seaborn`, `rich`. **Risks/TODOs:** Assumes predictions CSV fits memory; fairness slicing logic expects category columns defined in config but doesn’t guard missing values; writes plots to `/tmp` before copying without cleanup. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/monitor_shadow_scores.py` — **Type:** Script. **Summary:** Scheduled job pulling “shadow” model predictions from ClickHouse, computing drift/bias signals, comparing to baseline thresholds, and emitting PagerDuty/Webhook alerts plus Grafana annotations. **Dependencies:** `clickhouse-connect`, `scikit-learn` drift metrics, `aiohttp` for webhooks, Prometheus pushgateway. **Risks/TODOs:** Alert thresholds hard-coded; no dedupe logic so repeated breaches can spam alerts; network failures cause script exit without retries. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/nightly_pipeline.py` — **Type:** Script. **Summary:** CPU orchestration that chains fetch → prepare → feature engineering → training → packaging → evaluation using config overrides and structured logging, optionally notifying Slack. **Dependencies:** Other scripts via `subprocess`, `structlog`, `click`. **Risks/TODOs:** Relies on sequential shelling out; partial failures leave workspace dirty; no resumable checkpoints; Slack webhook optional but not validated. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/nightly_pipeline_gpu.py` — **Type:** Script. **Summary:** GPU-oriented orchestrator launching Dask or CUDA-enabled trainers (TabPFN, GBDT GPU) with ability to select specific stages and capture environment snapshots. **Dependencies:** `subprocess`, env var `CUDA_VISIBLE_DEVICES`, GPU scripts. **Risks/TODOs:** Minimal validation of GPU availability; assumes nvidia-smi present; no throttling when multiple runs start concurrently. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/package_model.py` — **Type:** Script. **Summary:** Bundles trained artifacts into versioned tarball including scaler, torch checkpoints, ONNX exports, model card, metrics, and generates SHA256 manifest for deployment. **Dependencies:** `tarfile`, `hashlib`, `ml_pipelines.models.artifacts`. **Risks/TODOs:** Tarball stored locally with no upload; manifest doesn’t include dependency versions; fails if expected files missing but error message generic. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/train_supervised_logreg.py` — **Type:** Script. **Summary:** Baseline logistic regression trainer supporting class weighting, hyperparameter sweep grid, and joblib export plus calibration plotting. **Dependencies:** `scikit-learn`, `pandas`, `ml_pipelines.evaluation`. **Risks/TODOs:** Hyperparameter grid/hard-coded; uses `.fit` on dense matrices, so wide sparse features become slow; no early stopping or regularization tuning beyond C parameter list. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/train_gbm_gpu.py` — **Type:** Script. **Summary:** Trains gradient boosting models on GPU (XGBoost or LightGBM) with GPU hist tree builder, logs metrics, and saves booster/binary plus SHAP summary. **Dependencies:** `xgboost`, `lightgbm`, `cupy`, `ml_pipelines.evaluation`. **Risks/TODOs:** Only supports single GPU; fails if GPU not available; SHAP computation can exhaust VRAM on large validation sets. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/train_pyod.py` — **Type:** Script. **Summary:** Runs multiple PyOD anomaly detectors (IForest, COPOD, ECOD, DeepSVDD wrapper) on engineered features, ranks performance, and exports best scoring model. **Dependencies:** `pyod`, `numpy`, `pandas`, `ml_pipelines.evaluation`. **Risks/TODOs:** PyOD models serialized via joblib but metadata about scaling not stored; script assumes balanced datasets and may misinterpret contamination ratio; runtime scales poorly with millions of rows. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/train_tabpfn_pseudolabels.py` — **Type:** Script. **Summary:** Uses TabPFN transformer to generate pseudo-labels on unlabeled pool, then trains downstream classifier combining labeled + pseudo-labeled data, logging uplift metrics. **Dependencies:** `tabpfn`, `torch`, `scikit-learn`, `ml_pipelines.evaluation`. **Risks/TODOs:** TabPFN requires GPU VRAM but script doesn’t check; pseudo-label confidence threshold hard-coded; unlabeled dataset loaded fully into memory. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/validate_export.py` — **Type:** Script. **Summary:** Validates packaged model bundle by loading each artifact (scaler, autoencoder, DeepSVDD, ONNX exports) and running smoke predictions against fixture dataset, ensuring manifest completeness + schema. **Dependencies:** `joblib`, `torch`, `onnxruntime`, `pandas`. **Risks/TODOs:** Test dataset stored in repo may drift from production schema; validator stops at first failure without aggregated report; ONNX runtime version differences could cause false negatives. **Evidence:** Reviewed 2025‑11‑14.

#### ML/scripts/tests/
- `ML/scripts/tests/_fixture/` — **Type:** Test data directory. **Summary:** Holds CSV/JSON fixtures for ETL + training tests (sample ClickHouse rows, enrichment feeds, pseudo prediction outputs). **Dependencies:** Consumed by pytest suites via relative paths. **Risks/TODOs:** Dataset contains synthetic IPs but still include quasi-PII; ensure fixtures updated along with schema changes. **Evidence:** Directory inspected 2025‑11‑14.
- `ML/scripts/tests/_out/` — **Type:** Generated artifacts. **Summary:** Checked-in empty directory used by tests to write temporary manifests/scalars ensuring deterministic paths. **Dependencies:** Pytest cleanup routines. **Risks/TODOs:** Should remain empty; add `.gitkeep` if removal breaks tests. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/_tmp/` — **Type:** Temp workspace. **Summary:** Scratch space for filesystem-based tests (packaging, validation). **Dependencies:** Pytest fixtures. **Risks/TODOs:** Ensure CI cleans between runs; consider using `tempfile` instead of repo-relative path. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_build_ip_enrichment.py` — **Type:** Test. **Summary:** Pytest suite mocking HTTP fetches + filesystem writes to verify `build_ip_enrichment` merges feeds, dedupes CIDRs, and writes manifest counts. **Dependencies:** `pytest`, `requests-mock`, `ml_pipelines.enrichment`. **Risks/TODOs:** Uses local file writes under `_tmp` and may interfere with parallel runs; does not validate checksum generation. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_etl_clickhouse.py` — **Type:** Test. **Summary:** Mocks ClickHouse client to ensure ETL script paginates, handles retries, and writes parquet manifest entries. **Dependencies:** `pytest`, `unittest.mock`, `clickhouse_connect`. **Risks/TODOs:** Pure unit test—doesn’t run against real ClickHouse or large datasets; parquet assertions rely on `pyarrow` availability in test env. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_feature_store.py` — **Type:** Test. **Summary:** Exercises feature engineering helpers (both pandas and Dask paths), asserting derived columns, null handling, and manifest metadata correctness. **Dependencies:** `pytest`, `pandas`, `dask`, `ml_pipelines.feature_store`. **Risks/TODOs:** Runs CPU-only and skips GPU-specific logic; large Dask cluster behaviors untested. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_fetch_enrichment.py` — **Type:** Test. **Summary:** Uses `responses` to stub network calls, validating dataset download URLs, expected row counts, and versioned directory creation for fetch script. **Dependencies:** `pytest`, `responses`, `structlog`. **Risks/TODOs:** Only checks happy-path downloads; checksum/signature validation absent; assumes deterministic row counts from fixtures. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_model_training.py` — **Type:** Test. **Summary:** Integration-style test running `train_models` on a tiny synthetic dataset to verify artifacts (scaler, autoencoder, isolation forest, GBDT) plus metrics JSON. **Dependencies:** `pytest`, `pandas`, `torch`, `scikit-learn`, `ml_pipelines.models.pipeline`. **Risks/TODOs:** Uses CPU-only path; GPU code paths untested; dataset extremely small so metrics may not catch regressions. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_monitor_shadow_scores.py` — **Type:** Test. **Summary:** Mocks ClickHouse + webhook clients to ensure drift metrics, alert payloads, and failure handling behave as expected. **Dependencies:** `pytest`, `asyncio`, `httpx`. **Risks/TODOs:** Async tests rely on event loop fixtures; doesn’t hit real Prometheus pushgateway or PagerDuty; threshold logic only partially covered. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_nightly_pipeline.py` — **Type:** Test. **Summary:** Verifies nightly pipeline runner dispatches stages, handles partial failures, and respects CLI stage selection by patching `subprocess.run`. **Dependencies:** `pytest`, `unittest.mock`. **Risks/TODOs:** Does not actually run subcommands, so integration bugs between stages remain undetected; relies on sentinel environment variables for assertions. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_placeholder.py` — **Type:** Test stub. **Summary:** Placeholder suite asserting `True` to keep test discovery plumbing active. **Dependencies:** `pytest`. **Risks/TODOs:** Provides no coverage; remove once real tests exist to avoid false sense of security. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_train_pyod.py` — **Type:** Test. **Summary:** Runs PyOD training script on toy dataset ensuring best-model selection, contamination tuning, and metrics export behave deterministically. **Dependencies:** `pytest`, `pandas`, `pyod`. **Risks/TODOs:** Uses small sample so algorithm performance ordering may change with library updates; no GPU coverage. **Evidence:** Reviewed 2025‑11‑14.
- `ML/scripts/tests/test_weak_supervision.py` — **Type:** Test. **Summary:** Validates weak supervision pipeline end-to-end (corpus loading, label functions, quality reports) using fixtures to ensure label coverage and report generation. **Dependencies:** `pytest`, `ml_pipelines.weak_supervision`. **Risks/TODOs:** Still mocks enrichment service; concurrency issues or large corpora not exercised. **Evidence:** Reviewed 2025‑11‑14.
- `ML/src/ml_pipelines/models/pipeline.py` — **Type:** Source. **Summary:** Central orchestration for supervised + unsupervised fraud models: loads parquet/CSV datasets, enforces target column, selects numeric features, fits a StandardScaler, then trains autoencoder + DeepSVDD torch models alongside classical baselines (Isolation Forest, GBDT) and aggregates metrics/artifacts, including optional ensemble metrics and adversarial stability checks. **Dependencies:** `pandas`, `numpy`, `scikit-learn` (train/test split, StandardScaler), `joblib` for artifacts, internal modules `ml_pipelines.models.{artifacts,baselines,torch_models}`, `ml_pipelines.evaluation.classification_metrics`. **Risks/TODOs:** Entire dataset loaded into memory—large parquet files will exceed RAM; feature selection blindly casts to float and imputes 0 which can corrupt categorical encodings; weight column assumed numeric with no schema validation; adversarial stability assumes GBDT model exposes `predict_proba` and silently skips metrics when artifacts missing—consider explicit warnings; lineage hashing only checks sibling `manifest.json` and may miss multi-source inputs. **Evidence:** Reviewed source 2025‑11‑14.

#### ML/src/ml_pipelines/
 - `ML/src/ml_pipelines/__init__.py` — **Type:** Source. **Summary:** Aggregates top-level exports (feature_store, evaluation, models, weak_supervision) and sets package version string for downstream imports. **Dependencies:** Internal subpackages. **Risks/TODOs:** Importing heavy modules at package import time increases CLI startup latency; consider lazy imports if footprint grows. **Evidence:** Reviewed 2025‑11‑14.

##### enrichment/
 - `ML/src/ml_pipelines/enrichment/__init__.py` — **Type:** Source. **Summary:** Re-exports helpers to download/parse enrichment feeds for scripts/tests. **Dependencies:** `.sources`. **Risks/TODOs:** Simple barrel; ensure new functions added to `sources.py` surface here for consumers. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/enrichment/sources.py` — **Type:** Source. **Summary:** Defines dataclasses + loader functions for Tor/cloud/vpn/ASN/user-agent datasets, including caching, schema validation, and CLI-friendly progress logging. **Dependencies:** `pandas`, `httpx`, `pydantic`, `gzip`, local data manifests. **Risks/TODOs:** Uses synchronous HTTP even when async would help; minimal verification of upstream signatures; storing entire feeds in memory can exceed RAM for large blocklists. **Evidence:** Reviewed 2025‑11‑14.

##### feature_store/
 - `ML/src/ml_pipelines/feature_store/base.py` — **Type:** Source. **Summary:** Provides abstract `FeatureBuilder` with schema validation, datatype coercion, missing-value strategies, and metadata tracking used by both batch and online calculators. **Dependencies:** `pydantic`, `pandas`, `numpy`. **Risks/TODOs:** Validation uses pandas dtype introspection that may mis-handle nullable ints; base class stores intermediate frames in memory—no streaming support. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/feature_store/offline_builder.py` — **Type:** Source. **Summary:** Implements offline builder that joins raw facts with enrichment sources, applies scaling/encoding, and writes parquet + manifest for training/evaluation. **Dependencies:** `pandas`, `scikit-learn`, `joblib`, `feature_store.base`. **Risks/TODOs:** Lacks partitioning strategy for very large datasets; parallelization limited to pandas apply; manifest doesn’t embed feature statistics for drift tracking. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/feature_store/online_calculator.py` — **Type:** Source. **Summary:** Lightweight runtime calculator that mirrors offline transforms for streaming inference (standardization, bucketization, enrichment lookups) and outputs numpy arrays ready for model input. **Dependencies:** `numpy`, `scikit-learn`, `feature_store.base`, `enrichment.sources`. **Risks/TODOs:** Requires identical scaler objects from training; no version negotiation, so stale calculators could serve mismatched schema; enrichment cache is process-local only. **Evidence:** Reviewed 2025‑11‑14.

##### evaluation/
 - `ML/src/ml_pipelines/evaluation/__init__.py` — **Type:** Source. **Summary:** Barrel exposing metric helper functions/classes. **Dependencies:** `.metrics`. **Risks/TODOs:** Keep exports updated as metrics expand to avoid direct path imports. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/evaluation/metrics.py` — **Type:** Source. **Summary:** Implements ROC/PR/F1, KS, lift, precision-at-k, calibration/Brier utilities, fairness slice aggregations, and helper to serialize metrics into manifest-ready dicts. **Dependencies:** `numpy`, `scikit-learn`, `scipy`, `pandas`. **Risks/TODOs:** Some functions assume binary labels only; fairness slicing expects categorical mask arrays and doesn’t guard high-cardinality features (risking memory blowups); lacks unit tests for multi-class scenarios. **Evidence:** Reviewed 2025‑11‑14.

##### models/
 - `ML/src/ml_pipelines/models/__init__.py` — **Type:** Source. **Summary:** Re-exports `train_models`, config dataclasses, and artifact helpers to simplify CLI usage. **Dependencies:** `.pipeline`, `.config`, `.artifacts`. **Risks/TODOs:** Import side-effects (torch/cuda checks) happen even when only using config—consider delaying heavy imports. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/models/config.py` — **Type:** Source. **Summary:** Pydantic `TrainingConfig` defining dataset paths, column names, hyperparameters, device, output directories, plus helper to ensure directories exist and parse CLI overrides. **Dependencies:** `pydantic`, `pathlib`. **Risks/TODOs:** No support for environment-variable expansion; `feature_columns` optional list lacks auto-discovery hints; `device` defaults to `cpu` even when CUDA available. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/models/artifacts.py` — **Type:** Source. **Summary:** Dataclass capturing artifact manifest (paths, metrics, run metadata) with helpers to serialize to JSON, merge metrics, and fingerprint files. **Dependencies:** `dataclasses`, `pathlib`, `hashlib`. **Risks/TODOs:** `to_manifest` reads entire files to hash; large ONNX exports could slow completion; no schema version field. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/models/baselines.py` — **Type:** Source. **Summary:** Contains baseline model trainers (IsolationForest, scikit-learn GradientBoosting) returning metrics + saved joblib models, plus helper for probability calibration. **Dependencies:** `scikit-learn`, `numpy`, `joblib`. **Risks/TODOs:** IsolationForest contamination parameter fixed; gradient boosting uses default hyperparameters (risk underfitting); no GPU accelerated options here. **Evidence:** Reviewed 2025‑11‑14.
- `ML/src/ml_pipelines/models/torch_models.py` — **Type:** Source. **Summary:** Defines PyTorch autoencoder + DeepSVDD architectures, training/evaluation loops with early stopping, calibration via isotonic regression, and ONNX export helpers. **Dependencies:** `torch`, `onnxruntime`, `scikit-learn`. **Risks/TODOs:** Training loops run entirely in Python without mixed precision; lacks gradient clipping/regularization; ONNX export assumes CPU device which may fail after GPU training unless `.to('cpu')` executes cleanly; limited unit tests. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/models/pipeline.py` — **Type:** Source. **Summary:** Central orchestration for supervised + unsupervised fraud models: loads parquet/CSV datasets, enforces target column, selects numeric features, fits a StandardScaler, then trains autoencoder + DeepSVDD torch models alongside classical baselines (Isolation Forest, GBDT) and aggregates metrics/artifacts, including optional ensemble metrics and adversarial stability checks. **Dependencies:** `pandas`, `numpy`, `scikit-learn` (train/test split, StandardScaler), `joblib` for artifacts, internal modules `ml_pipelines.models.{artifacts,baselines,torch_models}`, `ml_pipelines.evaluation.classification_metrics`. **Risks/TODOs:** Entire dataset loaded into memory—large parquet files will exceed RAM; feature selection blindly casts to float and imputes 0 which can corrupt categorical encodings; weight column assumed numeric with no schema validation; adversarial stability assumes GBDT model exposes `predict_proba` and silently skips metrics when artifacts missing—consider explicit warnings; lineage hashing only checks sibling `manifest.json` and may miss multi-source inputs. **Evidence:** Reviewed source 2025‑11‑14.

##### weak_supervision/
 - `ML/src/ml_pipelines/weak_supervision/__init__.py` — **Type:** Source. **Summary:** Re-exports label model + metrics utilities for use by scripts/tests. **Dependencies:** `.label_functions`, `.label_model`, `.metrics`. **Risks/TODOs:** Barrel import; keep exports aligned as APIs evolve. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/weak_supervision/label_functions.py` — **Type:** Source. **Summary:** Collection of deterministic heuristics (supply chain, CTIT, OMSDK, synthetic scenarios, IP reputation) returning weak labels + confidence scores. **Dependencies:** `pandas`, enrichment service, `typing_extensions`. **Risks/TODOs:** Thresholds hard-coded and not config-driven; heuristics assume IPv4 only; vectorized operations limited leading to slow evaluation on millions of rows. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/weak_supervision/label_model.py` — **Type:** Source. **Summary:** Implements Snorkel-style label model aggregating weak labels via majority vote + probabilistic modeling, produces training-ready labels, and outputs coverage/conflict stats. **Dependencies:** `numpy`, `scipy`, `pydantic`. **Risks/TODOs:** Simplified majority-vote fallback lacks advanced generative modeling; no persistence for learned accuracies; assumes independent label functions which may not hold. **Evidence:** Reviewed 2025‑11‑14.
 - `ML/src/ml_pipelines/weak_supervision/metrics.py` — **Type:** Source. **Summary:** Calculates coverage, conflict, overlap, precision/recall vs gold labels, and provides reporting helpers for weak supervision experiments. **Dependencies:** `numpy`, `pandas`. **Risks/TODOs:** Metrics assume binary label space; conflict detection uses O(n^2) pairwise comparisons which won’t scale for many label functions; limited tests for degenerate cases. **Evidence:** Reviewed 2025‑11‑14.

### docs/

#### Root files

- `docs/INDEX.md` — **Type:** Doc. **Summary:** Master documentation index describing how materials are organized by audience (customer/internal) and topic. **Dependencies:** References all other docs directories. **Risks/TODOs:** Needs updating whenever new doc areas are added to keep hyperlinks accurate. **Evidence:** Reviewed 2025‑11‑14.
- `docs/ORGANIZATION_SUMMARY.md` — **Type:** Doc. **Summary:** Snapshot of documentation coverage dated 2025‑11‑04 with pointers to freshly completed sections. **Dependencies:** Relies on maintainers to update status fields. **Risks/TODOs:** Becomes stale quickly; align with this analysis log to avoid conflicting truth sources. **Evidence:** Reviewed header.
- `docs/ORIGINAL_README.md` — **Type:** Doc. **Summary:** Legacy marketing-style README pitching the ApexMediation platform and summarizing architecture/features. **Dependencies:** None (standalone). **Risks/TODOs:** Content diverges from current capabilities; consider merging highlights into website plan to avoid duplicate claims. **Evidence:** Reviewed intro block.
- `docs/QUICK_START.md` — **Type:** Doc. **Summary:** Zero-touch automation quick start that narrates what happens during the automated setup flow. **Dependencies:** References automation tooling described elsewhere. **Risks/TODOs:** Walkthrough references features (e.g., AI assistants) that may evolve; ensure checklist still matches scripts. **Evidence:** Reviewed first section.
- `docs/DOCUMENTATION_GENERATION_COMPLETE.md` — **Type:** Doc. **Summary:** Completion note dated 2025‑11‑04 announcing documentation coverage; acts as project milestone artifact. **Dependencies:** None. **Risks/TODOs:** Document implies work finished—clarify if living docs continue beyond that date. **Evidence:** Reviewed file.
- `docs/Website-Audit-Report.md` — **Type:** Doc. **Summary:** Comprehensive audit of customer-facing site (layout, accessibility, UI polish) with findings from 2025‑11‑12. **Dependencies:** Website assets + design standards referenced throughout. **Risks/TODOs:** Action items should be tracked in backlog; document itself has no status table. **Evidence:** Reviewed heading.

#### docs/Adapters/

- `docs/Adapters/SUPPORTED_NETWORKS.md` — **Type:** Doc. **Summary:** Matrix of which ad networks each SDK supports plus status notes. **Dependencies:** SDK implementation plans. **Risks/TODOs:** Keep aligned with runtime adapter registry; currently static text only. **Evidence:** Reviewed 2025‑11‑14.

#### docs/Android/

- `docs/Android/2025-11-10-android-sdk-section-2-completion.md` — **Type:** Doc. **Summary:** Completion report for “Section 2” of the Android SDK effort with scope, validation steps, and owner/date. **Dependencies:** Android SDK roadmap. **Risks/TODOs:** Ensure follow-on sections reference same checklist to prove continuity. **Evidence:** Reviewed header.

#### docs/Architecture/

- `docs/Architecture/COMPONENT_REFERENCE_GUIDE.md` — **Type:** Doc. **Summary:** Maps every UI component to its design/system spec for cross-referencing implementation. **Dependencies:** `Design.md`, `WEBSITE_DESIGN.md`. **Risks/TODOs:** Must be updated whenever new components land to stay authoritative. **Evidence:** Reviewed intro paragraph.
- `docs/Architecture/DESIGN_SYSTEM_IMPLEMENTATION_STATUS.md` — **Type:** Doc. **Summary:** Status tracker for design system rollout (noting Phase 1 completion). **Dependencies:** Console + website codebases. **Risks/TODOs:** Lacks detail beyond phase note—add checklist per token/component. **Evidence:** Reviewed status line.
- `docs/Architecture/PHASE_1_SUMMARY.md` — **Type:** Doc. **Summary:** Summarizes what was delivered during architecture phase 1. **Dependencies:** Program plan. **Risks/TODOs:** Should highlight remaining gaps feeding Phase 2 backlog; currently only celebratory bullets. **Evidence:** Reviewed first section.
- `docs/Architecture/WEBSITE_ARCHITECTURE.md` — **Type:** Doc. **Summary:** High-level blueprint for marketing website stack, auth hand-off, and infrastructure owners. **Dependencies:** Website repo + console integration. **Risks/TODOs:** Mentions parent companies—ensure legal names kept current. **Evidence:** Reviewed header.
- `docs/Architecture/WEBSITE_DASHBOARD_AUTH_INTEGRATION.md` — **Type:** Doc. **Summary:** Explains how website users move into the dashboard with shared auth/session handling. **Dependencies:** Website + console NextAuth configuration. **Risks/TODOs:** Document references “seamless integration” but lacks diagrams; add sequence to reduce ambiguity. **Evidence:** Reviewed intro.
- `docs/Architecture/WEBSITE_TODO.md` — **Type:** Doc. **Summary:** Open task list for customer-facing site implementation. **Dependencies:** Website build tasks. **Risks/TODOs:** Validate tasks against current backlog so engineers know what remains. **Evidence:** Reviewed first lines.
- `docs/Architecture/enhanced_ad_stack_srs_v2_0.md` — **Type:** Doc. **Summary:** Formal SRS describing enhanced ad stack vision (entity details, scope, requirements). **Dependencies:** Product roadmap + competitor analysis. **Risks/TODOs:** Dense doc lacking change log; add revision history to manage updates. **Evidence:** Reviewed heading.

#### docs/Backend/

- `docs/Backend/BILLING_API.md` — **Type:** Doc. **Summary:** Endpoint reference with request/response samples for billing service. **Dependencies:** Backend billing controllers. **Risks/TODOs:** Must stay in sync with OpenAPI spec; no automation presently. **Evidence:** Reviewed 2025‑11‑14.
- `docs/Backend/BILLING_DEPLOYMENT_CHECKLIST.md` — **Type:** Doc. **Summary:** Step-by-step deployment checklist for billing components (pre/post checks). **Dependencies:** Fly deploy scripts, migrations. **Risks/TODOs:** Should link to runbooks to avoid duplication; includes manual steps only. **Evidence:** Reviewed sections.
- `docs/Backend/BILLING_FILES_MANIFEST.md` — **Type:** Doc. **Summary:** Inventory of files touched during billing implementation with change counts. **Dependencies:** Git history. **Risks/TODOs:** Hard-coded stats (e.g., totals) will drift; refresh script when new changes land. **Evidence:** Reviewed header.
- `docs/Backend/BILLING_IMPLEMENTATION_SUMMARY.md` — **Type:** Doc. **Summary:** Overview of billing features delivered (sections 7.1‑7.4). **Dependencies:** Implementation plan, tests. **Risks/TODOs:** Claims completion—ensure acceptance tests referenced actually exist. **Evidence:** Reviewed summary.

#### docs/CI/

- `docs/CI/CI_RELEASE_GUIDE.md` — **Type:** Doc. **Summary:** Release + rollback instructions for CI/CD, covering SDK publishing and pipelines. **Dependencies:** CI infrastructure, release scripts. **Risks/TODOs:** Update when pipelines change (currently general guidance). **Evidence:** Reviewed first lines.
- `docs/CI/ENVIRONMENTS_AND_BRANCH_POLICY.md` — **Type:** Doc. **Summary:** Defines branching strategy, required checks, and environment promotion rules. **Dependencies:** GitHub branch protection + CI config. **Risks/TODOs:** Ensure policy matches actual GitHub settings; currently prose only. **Evidence:** Reviewed introduction.
- `docs/CI/REQUIRED_CHECKS.md` — **Type:** Doc. **Summary:** Enumerates mandatory PR checks/artifacts. **Dependencies:** CI workflows. **Risks/TODOs:** Provide automation to validate compliance; doc alone is informational. **Evidence:** Reviewed heading.

#### docs/Console/

- `docs/Console/SESSION_AUTH.md` — **Type:** Doc. **Summary:** Describes console session model (secure cookies + CSRF). **Dependencies:** NextAuth config, backend session endpoints. **Risks/TODOs:** Ensure diagram covers new SSO flows if added; currently credentials-only. **Evidence:** Reviewed intro.

#### docs/Customer-Facing/

- `docs/Customer-Facing/README.md` — **Type:** Doc. **Summary:** Explains structure of customer-facing documentation tree and intended audiences. **Dependencies:** None. **Risks/TODOs:** Update when directories move to keep newcomers oriented. **Evidence:** Reviewed heading.
- `docs/Customer-Facing/WEBSITE_AND_DASHBOARD_PLAN.md` — **Type:** Doc. **Summary:** Plan tying marketing site and dashboard deliverables ahead of “FT build” milestone. **Dependencies:** Website + console features. **Risks/TODOs:** Contains dated roadmap; review to ensure priorities still align. **Evidence:** Reviewed file.
- `docs/Customer-Facing/Getting-Started/quickstart.md` — **Type:** Doc. **Summary:** 10-minute onboarding guide walking through account setup and first integration. **Dependencies:** Backend APIs, console. **Risks/TODOs:** Include screenshots or GIFs for clarity; currently text-heavy. **Evidence:** Reviewed start.

##### Customer-Facing/API-Reference/

- `docs/Customer-Facing/API-Reference/authentication.md` — **Type:** Doc. **Summary:** JWT authentication overview with requirements for API access. **Dependencies:** Backend auth endpoints. **Risks/TODOs:** Update if OAuth or session tokens change. **Evidence:** Reviewed intro.
- `docs/Customer-Facing/API-Reference/endpoints.md` — **Type:** Doc. **Summary:** REST endpoint catalog (paths + features). **Dependencies:** Backend API. **Risks/TODOs:** Should be generated from OpenAPI to avoid drift; currently static. **Evidence:** Reviewed heading.
- `docs/Customer-Facing/API-Reference/webhooks.md` — **Type:** Doc. **Summary:** Describes available webhooks and payload expectations. **Dependencies:** Backend event publishers. **Risks/TODOs:** Add retry/headers section; currently high-level. **Evidence:** Reviewed file.
- `docs/Customer-Facing/API-Reference/TRANSPARENCY_API.md` — **Type:** Doc. **Summary:** Transparency API overview scoping responses to publishers. **Dependencies:** Transparency backend. **Risks/TODOs:** Provide example canonical payloads; doc currently conceptual. **Evidence:** Reviewed file.

##### Customer-Facing/Billing-Compliance/

- `docs/Customer-Facing/Billing-Compliance/pricing.md` — **Type:** Doc. **Summary:** Pricing & plan description for customers. **Dependencies:** Finance policy. **Risks/TODOs:** Keep consistent with real billing; highlight currency/tiers. **Evidence:** Reviewed heading.

##### Customer-Facing/Compliance/

- `docs/Customer-Facing/Compliance/GDPR-Compliance.md` — **Type:** Doc. **Summary:** GDPR guidance for EEA customers with platform responsibilities. **Dependencies:** Legal/compliance team. **Risks/TODOs:** Needs legal review; doc may not cover all jurisdictions. **Evidence:** Reviewed intro.
- `docs/Customer-Facing/Compliance/Invoicing-Payments.md` — **Type:** Doc. **Summary:** Explains invoicing/payment flow for customers. **Dependencies:** Billing service + finance process. **Risks/TODOs:** Add SLA/late fee policy; currently general. **Evidence:** Reviewed heading.

##### Customer-Facing/Console/

- `docs/Customer-Facing/Console/BILLING_GUIDE.md` — **Type:** Doc. **Summary:** Walks through console billing pages (usage, invoices, settings). **Dependencies:** Console UI. **Risks/TODOs:** Add screenshots after UI stabilization; ensures doc stays useful. **Evidence:** Reviewed intro.

##### Customer-Facing/Features/

- `docs/Customer-Facing/Features/AB-Testing-Analytics.md` — **Type:** Doc. **Summary:** Customer playbook for AB testing + analytics dashboards. **Dependencies:** Analytics backend. **Risks/TODOs:** Document references advanced features still flagged beta; note availability. **Evidence:** Reviewed file.
- `docs/Customer-Facing/Features/Ad-Mediation-Deep-Dive.md` — **Type:** Doc. **Summary:** Technical overview of mediation stack for customers. **Dependencies:** Auction services. **Risks/TODOs:** Keep diagrams aligned with architecture doc to avoid conflicting statements. **Evidence:** Reviewed opening text.
- `docs/Customer-Facing/Features/Fraud-Detection-Prevention.md` — **Type:** Doc. **Summary:** Fraud detection/prevention guide describing AI heuristics and operator actions. **Dependencies:** Fraud pipeline. **Risks/TODOs:** Provide explicit API references for enforcement; doc currently marketing-heavy. **Evidence:** Reviewed introduction.

##### Customer-Facing/SDK-Integration/

- `docs/Customer-Facing/SDK-Integration/android-sdk.md` — **Type:** Doc. **Summary:** Android integration tutorial (Kotlin/Java). **Dependencies:** Android SDK. **Risks/TODOs:** Ensure Gradle snippets reflect latest artifact coordinates. **Evidence:** Reviewed first lines.
- `docs/Customer-Facing/SDK-Integration/ios-sdk.md` — **Type:** Doc. **Summary:** iOS integration instructions (Swift/Objective‑C). **Dependencies:** iOS SDK. **Risks/TODOs:** Mention XCFramework compatibility; currently generic. **Evidence:** Reviewed heading.
- `docs/Customer-Facing/SDK-Integration/unity-sdk.md` — **Type:** Doc. **Summary:** Unity SDK integration guide promising <10 minute setup. **Dependencies:** Unity package. **Risks/TODOs:** Provide Unity version requirements; doc currently silent. **Evidence:** Reviewed file.
- `docs/Customer-Facing/SDK-Integration/web-sdk.md` — **Type:** Doc. **Summary:** Web SDK integration manual. **Dependencies:** Web SDK. **Risks/TODOs:** Should clarify browser support and CSP restrictions. **Evidence:** Reviewed header.

##### Customer-Facing/SDKs/

- `docs/Customer-Facing/SDKs/INDEX.md` — **Type:** Doc. **Summary:** Landing page linking to per-platform quickstarts. **Dependencies:** Quickstart docs. **Risks/TODOs:** Keep table of contents aligned with available SDKs. **Evidence:** Reviewed file.
- `docs/Customer-Facing/SDKs/ANDROID_QUICKSTART.md` — **Type:** Doc. **Summary:** Android quickstart with date-stamped instructions. **Dependencies:** Android build pipeline. **Risks/TODOs:** Update when API keys or Gradle settings change. **Evidence:** Reviewed header.
- `docs/Customer-Facing/SDKs/IOS_QUICKSTART.md` — **Type:** Doc. **Summary:** iOS quickstart guide. **Dependencies:** iOS SDK. **Risks/TODOs:** Add info about required entitlements; not mentioned. **Evidence:** Reviewed heading.
- `docs/Customer-Facing/SDKs/CTV_ANDROID_TV_QUICKSTART.md` — **Type:** Doc. **Summary:** Android TV quickstart for CTV deployments. **Dependencies:** CTV SDK variant. **Risks/TODOs:** Document assumes same endpoints as mobile; confirm differences. **Evidence:** Reviewed first lines.
- `docs/Customer-Facing/SDKs/CTV_TVOS_QUICKSTART.md` — **Type:** Doc. **Summary:** tvOS quickstart for CTV. **Dependencies:** tvOS SDK. **Risks/TODOs:** Provide App Store guidelines reference; currently missing. **Evidence:** Reviewed file.
- `docs/Customer-Facing/SDKs/SANDBOX_READINESS.md` — **Type:** Doc. **Summary:** Checklist verifying SDK readiness for sandbox certification. **Dependencies:** QA process. **Risks/TODOs:** Should be mirrored in automated QA tracker. **Evidence:** Reviewed doc.

##### Customer-Facing/Support/

- `docs/Customer-Facing/Support/Performance-Optimization.md` — **Type:** Doc. **Summary:** Performance best practices for SDK integration. **Dependencies:** SDK instrumentation. **Risks/TODOs:** Provide measurable KPIs; currently descriptive. **Evidence:** Reviewed intro.
- `docs/Customer-Facing/Support/Troubleshooting-Guide.md` — **Type:** Doc. **Summary:** Troubleshooting compendium for integration issues. **Dependencies:** Support workflow. **Risks/TODOs:** Add search keywords or table for quick navigation. **Evidence:** Reviewed beginning.

- `docs/Customer-Facing/Troubleshooting/faq.md` — **Type:** Doc. **Summary:** FAQ covering common customer questions with support contact CTA. **Dependencies:** Support team. **Risks/TODOs:** Keep answers synced with product changes. **Evidence:** Reviewed file.

#### docs/Console/Billing-Compliance etc already covered above.

#### docs/Features/MigrationStudio/

- `docs/Features/MigrationStudio/README.md` — **Type:** Doc. **Summary:** Overview of Migration Studio goals, ownership, and features (parallel mediation, uplift verification). **Dependencies:** Migration Studio service. **Risks/TODOs:** Add architecture diagrams for clarity. **Evidence:** Reviewed header.
- `docs/Features/MigrationStudio/BETA_ROLLOUT_PLAN.md` — **Type:** Doc. **Summary:** Beta rollout sequencing plus exec summary. **Dependencies:** Product roadmap. **Risks/TODOs:** Should include gating metrics; currently textual. **Evidence:** Reviewed file.
- `docs/Features/MigrationStudio/TEST_EXECUTION_SUMMARY.md` — **Type:** Doc. **Summary:** Test result summary dated 2025‑11‑13 documenting beta validation. **Dependencies:** QA logs. **Risks/TODOs:** Link to raw test artifacts. **Evidence:** Reviewed header.
- `docs/Features/MigrationStudio/templates/ironSource-template.csv` — **Type:** Dataset (CSV). **Summary:** Sample ironSource export template (network, instance info, eCPM). **Dependencies:** Migration import wizard. **Risks/TODOs:** Document column definitions inline to prevent drift. **Evidence:** Inspected rows.
- `docs/Features/MigrationStudio/templates/max-template.csv` — **Type:** Dataset (CSV). **Summary:** Sample AppLovin MAX template for imports. **Dependencies:** Migration importer. **Risks/TODOs:** Clarify ranking semantics for new hires. **Evidence:** Reviewed file.

#### docs/Internal/ (general)

- `docs/Internal/AD_PROJECT_CAPABILITY_AUDIT.md` — **Type:** Doc. **Summary:** Capability audit dated 2025‑11‑06 cataloging strengths/gaps. **Dependencies:** Product metrics. **Risks/TODOs:** Should tie findings to ACTIONS (maybe Development roadmap). **Evidence:** Reviewed heading.
- `docs/Internal/COMPETITIVE_GAP_ANALYSIS.md` — **Type:** Doc. **Summary:** Competitive comparison vs big mediation platforms. **Dependencies:** Market research. **Risks/TODOs:** Cite sources to maintain credibility. **Evidence:** Reviewed header.
- `docs/Internal/COST_BUDGET_POLICY.md` — **Type:** Doc. **Summary:** $500/mo budget policy covering platform + LLM usage. **Dependencies:** Finance. **Risks/TODOs:** Document actual spend vs cap to validate compliance. **Evidence:** Reviewed intro.

##### Internal/Automation/

- `docs/Internal/Automation/AUTOMATION_COMPLETE.md` — **Type:** Doc. **Summary:** Declares zero-touch automation complete referencing DEVELOPMENT.md features. **Dependencies:** Automation scripts. **Risks/TODOs:** Provide verification evidence; currently statements only. **Evidence:** Reviewed file.
- `docs/Internal/Automation/BUSINESS_AUTOMATION.md` — **Type:** Doc. **Summary:** Business automation strategy for one-person Estonian operation. **Dependencies:** Sales + ops processes. **Risks/TODOs:** Should include KPIs for automation success. **Evidence:** Reviewed intro.
- `docs/Internal/Automation/PLATFORM_UPDATES_AUTOMATION.md` — **Type:** Doc. **Summary:** Guide for automating SDK release + maintenance tasks. **Dependencies:** CI/CD tooling. **Risks/TODOs:** Add references to scripts/cron jobs. **Evidence:** Reviewed header.
- `docs/Internal/Automation/ULTRA_LEAN_AUTOMATION.md` — **Type:** Doc. **Summary:** Outlines $400/mo ultra-lean automation strategy. **Dependencies:** Infrastructure cost assumptions. **Risks/TODOs:** Validate costs vs actual invoices. **Evidence:** Reviewed file.
- `docs/Internal/Automation/ZERO_TOUCH_AUTOMATION_GUIDE.md` — **Type:** Doc. **Summary:** Full implementation guide for zero-touch automation with executive summary. **Dependencies:** Multiple subsystems. **Risks/TODOs:** Provide update history as automation evolves. **Evidence:** Reviewed doc.

##### Internal/Deployment/

- `docs/Internal/Deployment/ACCOUNTING_IMPLEMENTATION_STATUS.md` — **Type:** Doc. **Summary:** Status of automated accounting system. **Dependencies:** Accounting scripts. **Risks/TODOs:** Add blockers/resolution steps; currently summary only. **Evidence:** Reviewed heading.
- `docs/Internal/Deployment/ACCOUNTING_OPERATIONS.md` — **Type:** Doc. **Summary:** Operations guide for accounting. **Dependencies:** Finance processes. **Risks/TODOs:** Document escalation contacts. **Evidence:** Reviewed intro.
- `docs/Internal/Deployment/API_KEYS_AND_INTEGRATIONS_GUIDE.md` — **Type:** Doc. **Summary:** Step-by-step API key + integration acquisition instructions. **Dependencies:** Third-party services (Stripe, etc.). **Risks/TODOs:** Sensitive content should remain internal; ensure secure storage references included. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/CI_CD_COMPLETION_REPORT.md` — **Type:** Doc. **Summary:** Completion report for CI/CD pipeline (Dec 2024). **Dependencies:** CI stack. **Risks/TODOs:** Provide links to pipeline runs for verification. **Evidence:** Reviewed doc.
- `docs/Internal/Deployment/CI_CD_GUIDE.md` — **Type:** Doc. **Summary:** CI/CD documentation covering overview + pipeline steps. **Dependencies:** GitHub Actions. **Risks/TODOs:** Add diagrams for clarity. **Evidence:** Reviewed intro.
- `docs/Internal/Deployment/CI_CD_MONITORING_PLAN.md` — **Type:** Doc. **Summary:** Plan describing objectives/constraints for finishing CI/CD + monitoring. **Dependencies:** Monitoring stack. **Risks/TODOs:** Align plan with actual implementations enumerated later. **Evidence:** Reviewed first section.
- `docs/Internal/Deployment/DEPLOYMENT_COMPLETION_REPORT.md` — **Type:** Doc. **Summary:** 2025‑11‑04 report declaring deployment preparation complete. **Dependencies:** Implementation milestones. **Risks/TODOs:** Provide acceptance evidence per subsystem. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/DEPLOYMENT_READINESS_SUMMARY.md` — **Type:** Doc. **Summary:** Readiness summary with version/time. **Dependencies:** Launch plan. **Risks/TODOs:** Should cross-link to checklists verifying prerequisites. **Evidence:** Reviewed header.
- `docs/Internal/Deployment/DEPLOYMENT_ROADMAP.md` — **Type:** Doc. **Summary:** 16-week roadmap from dev to prod. **Dependencies:** Program management. **Risks/TODOs:** Document assumes timeline still relevant; update for slippage. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/DEPLOYMENT_STATUS.md` — **Type:** Doc. **Summary:** Status of zero-touch system deployment dated 2025‑11‑04. **Dependencies:** Automation system. **Risks/TODOs:** Provide trend of status rather than single-day snippet. **Evidence:** Reviewed doc.
- `docs/Internal/Deployment/ESTONIAN_E_SYSTEMS.md` — **Type:** Doc. **Summary:** Guide for integrating with Estonian e-government systems. **Dependencies:** Local regulatory portals. **Risks/TODOs:** Contains jurisdiction-specific guidance; ensure legal review. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/FIRST_CUSTOMER_INTEGRATION_CHECKLIST.md` — **Type:** Doc. **Summary:** Checklist for onboarding first customer, marked completed. **Dependencies:** Customer success plan. **Risks/TODOs:** Provide instructions for repeating process for additional customers. **Evidence:** Reviewed doc.
- `docs/Internal/Deployment/IMPLEMENTATION_CHECKLIST.md` — **Type:** Doc. **Summary:** Zero-touch system implementation checklist (completed). **Dependencies:** Development TODOs. **Risks/TODOs:** Could be turned into automated test to validate completion. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/IMPLEMENTATION_SUMMARY.md` — **Type:** Doc. **Summary:** Summary of ad mediation platform implementation (overview). **Dependencies:** Program deliverables. **Risks/TODOs:** Provide metrics for done criteria. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/PRE_DEPLOYMENT_CHECKLIST.md` — **Type:** Doc. **Summary:** Pre-prod checklist (target environment, tasks). **Dependencies:** Deployment scripts. **Risks/TODOs:** Document should map to runbook tasks; currently static. **Evidence:** Reviewed header.
- `docs/Internal/Deployment/PRODUCTION_READINESS_CHECKLIST.md` — **Type:** Doc. **Summary:** Launch readiness list for ApexMediation. **Dependencies:** Entire stack. **Risks/TODOs:** Contains no verification logs; ensure supporting evidence stored elsewhere. **Evidence:** Reviewed doc.
- `docs/Internal/Deployment/PROJECT_COMPLETE.md` — **Type:** Doc. **Summary:** Declaration that all major systems implemented. **Dependencies:** Implementation tracking. **Risks/TODOs:** Should specify scope boundaries to avoid misinterpretation. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/PROJECT_COMPLETION.md` — **Type:** Doc. **Summary:** Duplicate-style project completion summary with date. **Dependencies:** Program plan. **Risks/TODOs:** Document duplicates `PROJECT_COMPLETE`; deduplicate to reduce confusion. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/QUICK_START_DEPLOYMENT.md` — **Type:** Doc. **Summary:** Quick-start reference for production deployment. **Dependencies:** Deployment tooling. **Risks/TODOs:** Add scripts/commands for automation rather than prose. **Evidence:** Reviewed doc.
- `docs/Internal/Deployment/ROLLOUT_STRATEGY.md` — **Type:** Doc. **Summary:** Automated rollout strategy for Day 0. **Dependencies:** Automation stack. **Risks/TODOs:** Provide fallback scenarios; currently linear. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/SYSTEM_COMPLETE.md` — **Type:** Doc. **Summary:** Another completion note celebrating requirement fulfillment. **Dependencies:** Program status. **Risks/TODOs:** Consolidate with other “complete” docs to avoid triple-reporting. **Evidence:** Reviewed file.
- `docs/Internal/Deployment/VALUE_MULTIPLIER_SUMMARY.md` — **Type:** Doc. **Summary:** Overview of “Value Multiplier” system implementation. **Dependencies:** Value Multiplier features. **Risks/TODOs:** Document lacks success metrics; add KPIs. **Evidence:** Reviewed file.

##### Internal/Development/

- `docs/Internal/Development/AD_PROJECT_FILE_ANALYSIS.md` — **Type:** Doc. **Summary:** This living file-by-file analysis log capturing repository inventory and risks. **Dependencies:** Entire repo. **Risks/TODOs:** Must stay synchronized with ongoing reviews; ensure progress tracker is updated as sections finish. **Evidence:** Current editing session.
- `docs/Internal/Development/ANALYTICS_IMPLEMENTATION.md` — **Type:** Doc. **Summary:** Implementation summary for analytics/reporting features. **Dependencies:** Analytics services. **Risks/TODOs:** Add test references to prove claims. **Evidence:** Reviewed first lines.
- `docs/Internal/Development/BACKEND_CONSOLE_IMPROVEMENTS.md` — **Type:** Doc. **Summary:** Completion report for backend + console improvements (dated Nov 12). **Dependencies:** Backend + console commits. **Risks/TODOs:** Document enumerates tasks but lacks links to PRs. **Evidence:** Reviewed header.
- `docs/Internal/Development/CODE_QUALITY_REVIEW_2025-11-08.md` — **Type:** Doc. **Summary:** Code quality review findings with action items. **Dependencies:** Codebase state. **Risks/TODOs:** Ensure issues flow into backlog; doc alone not actionable. **Evidence:** Reviewed file.
- `docs/Internal/Development/CONSOLE_INTEGRATION_SUMMARY.md` — **Type:** Doc. **Summary:** Summary of console-backend integration completion. **Dependencies:** Integration plan. **Risks/TODOs:** Add test coverage metrics. **Evidence:** Reviewed introduction.
- `docs/Internal/Development/DEVELOPMENT.md` — **Type:** Doc. **Summary:** Comprehensive development guide for the platform covering workflows and tooling. **Dependencies:** All repos. **Risks/TODOs:** Keep updated to reflect current stack (Node versions, etc.). **Evidence:** Reviewed start.
- `docs/Internal/Development/DEVELOPMENT_ROADMAP.md` — **Type:** Doc. **Summary:** Engineering-first roadmap derived from competitive analysis with staged phases. **Dependencies:** Product plan. **Risks/TODOs:** Repeat of other roadmaps; ensure single source of truth. **Evidence:** Reviewed doc.
- `docs/Internal/Development/DEVELOPMENT_TODO_CHECKLIST.md` — **Type:** Doc. **Summary:** Master checklist of development tasks (timestamped). **Dependencies:** Implementation progress. **Risks/TODOs:** Keep consistent with this analysis file’s TODO list. **Evidence:** Reviewed header.
- `docs/Internal/Development/DOCUMENTATION_RUNBOOK_IMPROVEMENTS.md` — **Type:** Doc. **Summary:** Completion summary for documentation/runbook upgrades. **Dependencies:** Runbooks. **Risks/TODOs:** Add follow-up backlog items. **Evidence:** Reviewed file.
- `docs/Internal/Development/GAPS_RESOLUTION.md` — **Type:** Doc. **Summary:** Notes on resolving major system gaps (2/3 closed). **Dependencies:** Gap backlog. **Risks/TODOs:** Document doesn’t specify remaining gap action plan; add next steps. **Evidence:** Reviewed file.
- `docs/Internal/Development/IMPROVEMENT_PLAN.md` — **Type:** Doc. **Summary:** Improvement plan scoped to Ad-Project. **Dependencies:** System audit. **Risks/TODOs:** Identify owners/dates for improvements. **Evidence:** Reviewed first section.
- `docs/Internal/Development/MONITORING_QUALITY_IMPROVEMENTS.md` — **Type:** Doc. **Summary:** Completion report for monitoring stack enhancements. **Dependencies:** Observability stack. **Risks/TODOs:** Provide metrics before/after improvements. **Evidence:** Reviewed file.
- `docs/Internal/Development/SDK_COMPLETION_REPORT.md` — **Type:** Doc. **Summary:** SDK development completion summary with exec overview. **Dependencies:** SDK repos. **Risks/TODOs:** Document claims completion—ensure certification evidence stored elsewhere. **Evidence:** Reviewed doc.
- `docs/Internal/Development/SDK_FOCUS_PLAN.md` — **Type:** Doc. **Summary:** Focus plan for Android/iOS SDK work dated 2025‑11‑08. **Dependencies:** SDK roadmap. **Risks/TODOs:** Could be retired now that completion report exists; clarify status. **Evidence:** Reviewed file.
- `docs/Internal/Development/SDK_IMPLEMENTATION.md` — **Type:** Doc. **Summary:** Comprehensive summary of SDK implementation steps. **Dependencies:** SDK code. **Risks/TODOs:** Risk of overlapping with other SDK docs; consider consolidation. **Evidence:** Reviewed doc.
- `docs/Internal/Development/SDK_IMPROVEMENTS_COMPLETE.md` — **Type:** Doc. **Summary:** Confirms completion of 15 SDK improvement tasks (dated Nov 12). **Dependencies:** Task tracking. **Risks/TODOs:** Provide links to actual commits. **Evidence:** Reviewed file.
- `docs/Internal/Development/SYSTEM_ANALYSIS_2025-11-08.md` — **Type:** Doc. **Summary:** System analysis + improvement proposals from Nov 8. **Dependencies:** Platform state. **Risks/TODOs:** Ensure proposals tracked in backlog. **Evidence:** Reviewed doc.
- `docs/Internal/Development/TESTING_GUIDE.md` — **Type:** Doc. **Summary:** Testing guide for console (quick start + instructions). **Dependencies:** Testing tooling. **Risks/TODOs:** Expand to backend + SDK coverage. **Evidence:** Reviewed header.
- `docs/Internal/Development/TODO_CHANGES_AUDIT.md` — **Type:** Doc. **Summary:** Audit of changes triggered by the TODO checklist. **Dependencies:** Development checklist. **Risks/TODOs:** Could be merged with checklist to avoid dual maintenance. **Evidence:** Reviewed file.
- `docs/Internal/Development/Unity_SDK_DESIGN.md` — **Type:** Doc. **Summary:** Unity SDK design + implementation plan. **Dependencies:** Unity SDK. **Risks/TODOs:** Add diagrams for plugin architecture. **Evidence:** Reviewed doc.
- `docs/Internal/Development/VSCODE_GUIDE.md` — **Type:** Doc. **Summary:** VS Code-centric development workflow guide for the entire platform. **Dependencies:** Developer tooling. **Risks/TODOs:** Keep extensions + settings up to date. **Evidence:** Reviewed first section.

##### Internal/Infrastructure/

- `docs/Internal/Infrastructure/CLICKHOUSE_INTEGRATION.md` — **Type:** Doc. **Summary:** Integration plan for ClickHouse (overview + steps). **Dependencies:** Data pipelines. **Risks/TODOs:** Include schema references to align with `/data/schemas`. **Evidence:** Reviewed doc.
- `docs/Internal/Infrastructure/INFRASTRUCTURE_FIXES_COMPLETE.md` — **Type:** Doc. **Summary:** Summary of infrastructure fixes (dated 2024). **Dependencies:** Infra backlog. **Risks/TODOs:** Document is old; confirm still relevant. **Evidence:** Reviewed file.
- `docs/Internal/Infrastructure/INFRASTRUCTURE_MIGRATION_PLAN.md` — **Type:** Doc. **Summary:** Cost-driven migration plan for lean infrastructure. **Dependencies:** Ops budget. **Risks/TODOs:** Provide decision log for chosen hosting providers. **Evidence:** Reviewed doc.
- `docs/Internal/Infrastructure/observability.md` — **Type:** Doc. **Summary:** Observability stack overview (monitoring/logging/alerting). **Dependencies:** Monitoring infrastructure. **Risks/TODOs:** Synchronize with monitoring docs to avoid duplication. **Evidence:** Reviewed introduction.
- `docs/Internal/Infrastructure/production-deployment.md` — **Type:** Doc. **Summary:** Production deployment guide with prerequisites. **Dependencies:** Deploy scripts. **Risks/TODOs:** Should include rollback steps; currently only forward path. **Evidence:** Reviewed header.
- `docs/Internal/Infrastructure/REVERSE_PROXY_CONFIGURATION.md` — **Type:** Doc. **Summary:** Reverse proxy configuration walkthrough. **Dependencies:** Infrastructure-as-code / Nginx configs. **Risks/TODOs:** Provide versioned config snippets for reproducibility. **Evidence:** Reviewed doc.

##### Internal/ML/

- `docs/Internal/ML/DataContracts.md` — **Type:** Doc. **Summary:** Defines ML fraud data contracts (schema, constraints). **Dependencies:** `data/enrichment` + ClickHouse tables. **Risks/TODOs:** Keep synchronized with actual DB schema changes. **Evidence:** Reviewed file.
- `docs/Internal/ML/ML_INFRASTRUCTURE_SUMMARY.md` — **Type:** Doc. **Summary:** Implementation summary for ML infrastructure (dated Nov 12). **Dependencies:** ML tooling + Dockerfiles. **Risks/TODOs:** Provide cost/perf metrics. **Evidence:** Reviewed file.
- `docs/Internal/ML/ML_QUICK_START.md` — **Type:** Doc. **Summary:** Quick-start guide for ML training with reproducibility steps. **Dependencies:** ML scripts + data. **Risks/TODOs:** Reference `Makefile` targets for clarity. **Evidence:** Reviewed doc.
- `docs/Internal/ML/ML_TRAINING.md` — **Type:** Doc. **Summary:** Detailed ML training guide (data sources, deployment strategy). **Dependencies:** ML scripts and data sets. **Risks/TODOs:** Should link to actual notebooks. **Evidence:** Reviewed doc.
- `docs/Internal/ML/PIPELINE_README.md` — **Type:** Doc. **Summary:** ML fraud pipeline setup instructions (dated Nov 7). **Dependencies:** pipeline scripts. **Risks/TODOs:** Provide architecture diagram for pipeline stages. **Evidence:** Reviewed file.
- `docs/Internal/ML/Promotion_Process.md` — **Type:** Doc. **Summary:** Fraud model promotion process doc dated Nov 9. **Dependencies:** ML governance. **Risks/TODOs:** Add checklist for approvals. **Evidence:** Reviewed file.
- `docs/Internal/ML/Reports/20251109_090938_logreg_dev_2.md` — **Type:** Doc. **Summary:** Automatically generated logreg_dev_2 evaluation report (metrics/time). **Dependencies:** ML experiments. **Risks/TODOs:** Provide aggregated summary referencing these timestamped reports. **Evidence:** Reviewed heading.
- `docs/Internal/ML/Reports/20251109_091721_logreg_dev_2.md` — **Type:** Doc. **Summary:** Second evaluation snapshot for same model. **Dependencies:** Same as above. **Risks/TODOs:** Document duplication; consider storing results in dashboard. **Evidence:** Reviewed header.
- `docs/Internal/ML/Reports/20251109_092958_logreg_dev_2.md` — **Type:** Doc. **Summary:** Third evaluation snapshot. **Dependencies:** ML runs. **Risks/TODOs:** Add summary table comparing runs. **Evidence:** Reviewed header.
- `docs/Internal/ML/Threshold_Playbook.md` — **Type:** Doc. **Summary:** Guide for selecting fraud model thresholds (dated Nov 9). **Dependencies:** ML pipeline. **Risks/TODOs:** Provide numeric examples for clarity. **Evidence:** Reviewed doc.
- `docs/Internal/ML/WeakSupervisionLabelFunctions.md` — **Type:** Doc. **Summary:** Catalog of weak supervision label functions and guidance. **Dependencies:** data/weak-supervision assets. **Risks/TODOs:** Keep aligned with code implementations. **Evidence:** Reviewed doc.
- `docs/Internal/ML_FRAUD_TRAINING_DATA_SOURCES.md` — **Type:** Doc. **Summary:** Data source + pipeline plan for fraud ML training. **Dependencies:** data sets. **Risks/TODOs:** Document includes plan but not actual sample counts; update as data lands. **Evidence:** Reviewed doc.

##### Internal/Operations/

- `docs/Internal/Operations/BILLING_PLAYBOOK.md` — **Type:** Doc. **Summary:** Billing operations playbook covering flows, failure modes, RACI. **Dependencies:** Billing team/process. **Risks/TODOs:** Provide live runbook link for on-call use. **Evidence:** Reviewed file.
- `docs/Internal/Operations/DR_BILLING.md` — **Type:** Doc. **Summary:** Disaster recovery plan for billing. **Dependencies:** Infra/DB backups. **Risks/TODOs:** Expand “Objectives” into actionable steps. **Evidence:** Reviewed doc.
- `docs/Internal/Operations/STRIPE_KEYS_ROTATION.md` — **Type:** Doc. **Summary:** Runbook for rotating Stripe keys. **Dependencies:** Stripe account. **Risks/TODOs:** Ensure secret storage instructions align with Infisical doc. **Evidence:** Reviewed file.
- `docs/Internal/Operations/TRANSPARENCY_KEY_ROTATION.md` — **Type:** Doc. **Summary:** Key rotation guide for transparency signer. **Dependencies:** Transparency service. **Risks/TODOs:** Add automation script references. **Evidence:** Reviewed doc.

##### Internal/Sales/

- `docs/Internal/Sales/CIALDINI_SALES_STRATEGY.md` — **Type:** Doc. **Summary:** Automated sales strategy leveraging Cialdini principles. **Dependencies:** Sales automation tooling. **Risks/TODOs:** Provide measurement plan for principle effectiveness. **Evidence:** Reviewed file.
- `docs/Internal/Sales/SALES_AUTOMATION_OPERATIONS.md` — **Type:** Doc. **Summary:** Operations guide for self-service sales automation. **Dependencies:** CRM/automation stack. **Risks/TODOs:** Outline failure recovery plan. **Evidence:** Reviewed doc.
- `docs/Internal/Sales/SALES_AUTOMATION_QUICK_REF.md` — **Type:** Doc. **Summary:** Quick reference cheat sheet (six principles). **Dependencies:** Sales scripts. **Risks/TODOs:** None beyond keeping in sync with longer strategy doc. **Evidence:** Reviewed file.
- `docs/Internal/Sales/SALES_AUTOMATION_SUMMARY.md` — **Type:** Doc. **Summary:** Implementation summary for Cialdini-based automation. **Dependencies:** Strategy doc. **Risks/TODOs:** Provide operational metrics to prove success. **Evidence:** Reviewed file.

##### Internal/Security/

- `docs/Internal/Security/AUDIT_REPORT.md` — **Type:** Doc. **Summary:** System audit report (Nov 4) with auditor info. **Dependencies:** Security assessments. **Risks/TODOs:** Provide remediation plan linking to issues. **Evidence:** Reviewed header.
- `docs/Internal/Security/COMPREHENSIVE_AUDIT_REPORT.md` — **Type:** Doc. **Summary:** Extended audit report (same date). **Dependencies:** Security testing. **Risks/TODOs:** Duplicate coverage with previous report; consider consolidating. **Evidence:** Reviewed doc.
- `docs/Internal/Security/DATA_MAP.md` — **Type:** Doc. **Summary:** Data map for billing/privacy flows. **Dependencies:** Data architecture. **Risks/TODOs:** Add diagrams/tables for clarity. **Evidence:** Reviewed file.
- `docs/Internal/Security/PCI_SCOPE.md` — **Type:** Doc. **Summary:** PCI scope definition for Stripe integration. **Dependencies:** Billing service. **Risks/TODOs:** Update when architecture or data storage changes. **Evidence:** Reviewed doc.
- `docs/Internal/Security/SECRETS_MANAGEMENT_SETUP.md` — **Type:** Doc. **Summary:** Secrets management guide using Infisical. **Dependencies:** Secret tooling. **Risks/TODOs:** Ensure instructions mention rotation cadence. **Evidence:** Reviewed file.
- `docs/Internal/Security/SECURITY_FIXES_SUMMARY.md` — **Type:** Doc. **Summary:** Summary of security/compliance fixes (Nov 4). **Dependencies:** Security backlog. **Risks/TODOs:** Provide status of outstanding items. **Evidence:** Reviewed doc.

- `docs/Internal/SANDBOX_LIVE_READINESS_2025-11-14.md` — **Type:** Doc. **Summary:** Sandbox live readiness report (Nov 14). **Dependencies:** Sandbox environment. **Risks/TODOs:** Keep accessible for audits; ensure action items ticketed. **Evidence:** Reviewed file.
- `docs/Internal/SANDBOX_TESTING_READINESS_2025-11-13.md` — **Type:** Doc. **Summary:** Testing readiness checklist (Nov 13). **Dependencies:** QA plan. **Risks/TODOs:** Document references consolidated items but lacks owner assignment. **Evidence:** Reviewed doc.
- `docs/Internal/SDK_COMPETITIVENESS_AUDIT.md` — **Type:** Doc. **Summary:** Audit comparing SDK competitiveness across platforms. **Dependencies:** SDK features. **Risks/TODOs:** Provide data-driven comparisons (latency, eCPM). **Evidence:** Reviewed header.
- `docs/Internal/SYSTEM_AUDIT_SUMMARY.md` — **Type:** Doc. **Summary:** System audit summary (Nov 4). **Dependencies:** Platform state. **Risks/TODOs:** Link to underlying checklist for traceability. **Evidence:** Reviewed file.

#### docs/ML/

- `docs/ML/ML_CANARY_DEPLOYMENT.md` — **Type:** Doc. **Summary:** Guide for canary deployment of ML models with rollback strategy. **Dependencies:** ML infra + serving. **Risks/TODOs:** Add automation scripts. **Evidence:** Reviewed file.
- `docs/ML/Model_Spec.md` — **Type:** Doc. **Summary:** Fraud detection model specification (purpose, requirements). **Dependencies:** ML models. **Risks/TODOs:** Keep updated with actual model versions. **Evidence:** Reviewed doc.

#### docs/Monitoring/

- `docs/Monitoring/ALERTS.md` — **Type:** Doc. **Summary:** Prometheus alert reference for the platform. **Dependencies:** Prometheus rules. **Risks/TODOs:** Ideally generated from actual alert definitions to stay aligned. **Evidence:** Reviewed doc.
- `docs/Monitoring/GRAFANA_DASHBOARDS.md` — **Type:** Doc. **Summary:** Grafana dashboard catalogue with descriptions. **Dependencies:** Grafana config. **Risks/TODOs:** Include dashboard IDs/links for quick navigation. **Evidence:** Reviewed file.

#### docs/Release/

- `docs/Release/CI_RELEASE_GUIDE.md` — **Type:** Doc. **Summary:** Release/rollback playbook for CI (appears similar to `docs/CI/CI_RELEASE_GUIDE.md`). **Dependencies:** Release tooling. **Risks/TODOs:** Remove duplication or cross-link to single source. **Evidence:** Reviewed heading.

#### docs/Security/

- `docs/Security/SECRETS_POLICY.md` — **Type:** Doc. **Summary:** Secrets management policy (status Active). **Dependencies:** Company security governance. **Risks/TODOs:** Align with Infisical setup doc to avoid contradictions. **Evidence:** Reviewed file.

#### docs/Transparency/

- `docs/Transparency/2025-11-10-transparency-api-validation.md` — **Type:** Doc. **Summary:** Summary of transparency API validation + canonical exposure tasks (dated Nov 10). **Dependencies:** Transparency tooling. **Risks/TODOs:** Provide raw validation logs. **Evidence:** Reviewed doc.
- `docs/Transparency/2025-11-10-transparency-cli-ops-docs.md` — **Type:** Doc. **Summary:** Transparency CLI + ops documentation enhancements note. **Dependencies:** CLI tooling. **Risks/TODOs:** Add CLI command references. **Evidence:** Reviewed file.
- `docs/Transparency/2025-11-10-transparency-console-ux-polish.md` — **Type:** Doc. **Summary:** UX polish summary for transparency console surfaces. **Dependencies:** Console UI. **Risks/TODOs:** Document assumes tasks done; ensure design backlog updated. **Evidence:** Reviewed doc.
- `docs/Transparency/Canonical_Privacy_Contract.md` — **Type:** Doc. **Summary:** Canonical privacy contract describing how transparency data is handled. **Dependencies:** Legal/compliance. **Risks/TODOs:** Legal review required for production. **Evidence:** Reviewed file.
- `docs/Transparency/VERIFY.md` — **Type:** Doc. **Summary:** Verification guide for transparency records (API/CLI/console). **Dependencies:** Transparency stack. **Risks/TODOs:** Provide sample commands/responses. **Evidence:** Reviewed doc.

#### docs/Web/

- `docs/Web/INTEGRATION_README.md` — **Type:** Doc. **Summary:** Web integration overview for Apex Mediation. **Dependencies:** Web SDK/website. **Risks/TODOs:** Expand with actual API calls or code samples. **Evidence:** Reviewed file.

#### docs/iOS/

- `docs/iOS/NetworkRetryPolicy.md` — **Type:** Doc. **Summary:** Network retry policy for iOS SDK (version 1.0). **Dependencies:** iOS SDK. **Risks/TODOs:** Add diagrams for timing/backoff strategy. **Evidence:** Reviewed doc.
- `docs/iOS/PublicAPIStability.md` — **Type:** Doc. **Summary:** iOS public API stability review. **Dependencies:** iOS API surface. **Risks/TODOs:** Document should highlight breaking-change policies; currently qualitative. **Evidence:** Reviewed file.
- `docs/iOS/SECTION_3_COMPLETION_SUMMARY.md` — **Type:** Doc. **Summary:** Completion summary for iOS SDK Section 3 (dated Nov 10). **Dependencies:** iOS roadmap. **Risks/TODOs:** Ensure sections 1/2 also recorded for traceability. **Evidence:** Reviewed doc.

#### docs/migration/

- `docs/migration/unity-migration-guide.md` — **Type:** Doc. **Summary:** Guide for migrating from Unity LevelPlay to ApexMediation. **Dependencies:** Migration tooling + SDK. **Risks/TODOs:** Provide sample scripts/config comparisons. **Evidence:** Reviewed file.

#### docs/runbooks/

- `docs/runbooks/AI_COST_CONTROLS.md` — **Type:** Doc. **Summary:** Runbook for controlling AI automation costs (last updated Nov 4). **Dependencies:** Cost monitoring. **Risks/TODOs:** Provide alerts/triggers for cost overruns. **Evidence:** Reviewed doc.
- `docs/runbooks/OBSERVABILITY_RUNBOOK.md` — **Type:** Doc. **Summary:** Observability runbook (pre‑FT) describing procedures and tools. **Dependencies:** Monitoring stack. **Risks/TODOs:** Include on-call rotation references. **Evidence:** Reviewed file.
- `docs/runbooks/OPERATOR_CHECKLIST.md` — **Type:** Doc. **Summary:** Daily/weekly operator checklist for single-operator setup. **Dependencies:** Entire platform operations. **Risks/TODOs:** Could be automated via reminders; ensure doc stays current. **Evidence:** Reviewed doc.
- `docs/runbooks/SLOS_AND_ALERTS.md` — **Type:** Doc. **Summary:** SLO and alert reference for adapters/observability. **Dependencies:** Monitoring definitions. **Risks/TODOs:** Should tie to Prometheus alert doc for single source. **Evidence:** Reviewed file.
- `docs/runbooks/migration-studio-guardrails.md` — **Type:** Doc. **Summary:** Migration Studio guardrails runbook outlining guardrail logic + operations. **Dependencies:** Migration studio service. **Risks/TODOs:** Provide automation references for guardrail evaluation. **Evidence:** Reviewed doc.

#### docs/Web & Customer-Facing items already accounted for; docs/Console/Session doc captured earlier.



### infrastructure/

#### Helm charts

- `infrastructure/helm/backend/Chart.yaml` — **Type:** Helm metadata. **Summary:** Declares the backend API release (v1.0.0) with keywords + maintainer info that downstream manifests inherit. **Dependencies:** Helm CLI / GitOps pipelines. **Risks/TODOs:** Version is pinned to 1.0.0 even though manifests reference `tag: latest`; consider aligning chart/app versions. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/values.yaml` — **Type:** Helm values. **Summary:** Production-ready defaults: blue/green `deployment.color`, 3 replicas, autoscaling (3‑20 pods), pod security contexts, ingress (`api.rivalapexmediation.com`), Prometheus scrape annotations, migrations job config, optional ServiceMonitor, and network policy scaffolding. **Dependencies:** Backend container images, Kubernetes cluster, Prometheus Operator. **Risks/TODOs:** Relies on external `backend-secrets`; enabling networkPolicy/serviceMonitor requires additional CRDs—document prerequisites in README. **Evidence:** Reviewed entire file 2025‑11‑14.
- `infrastructure/helm/backend/templates/_helpers.tpl` — **Type:** Helm helper template. **Summary:** Provides naming helpers + label macros reused by the backend manifests. **Dependencies:** Helm templating engine. **Risks/TODOs:** Ensure helper values stay in sync with values.yaml rename overrides to avoid mismatched selectors. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/templates/deployment.yaml` — **Type:** Helm template. **Summary:** Generates backend Deployment with env/secret mounts, probes, node affinity, and optional migrations job gating via color label. **Dependencies:** Values definitions, Kubernetes API. **Risks/TODOs:** Rolling updates rely on `deployment.color`; lacking pre-stop hooks for DB connections. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/templates/hpa.yaml` — **Type:** Helm template. **Summary:** Configures target CPU/memory scaling thresholds plus stabilization behavior matching values. **Dependencies:** Kubernetes HPA/metrics API. **Risks/TODOs:** Memory autoscaling requires metrics server; ensure cluster supports custom behaviors defined. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/templates/ingress.yaml` — **Type:** Helm template. **Summary:** NGINX ingress with TLS + cert-manager issuer and rate-limiting annotations. **Dependencies:** Ingress controller + cert-manager. **Risks/TODOs:** Hard-codes host; need overrides for staging. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/templates/service.yaml` — **Type:** Helm template. **Summary:** ClusterIP service exposing port 3001 keyed off blue/green selector. **Dependencies:** Deployment labels. **Risks/TODOs:** No readiness gate for color mismatches; mis-set `deployment.color` will orphan service. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/templates/serviceaccount.yaml` — **Type:** Helm template. **Summary:** Optional service account + annotations for IAM roles. **Dependencies:** RBAC requirements. **Risks/TODOs:** When `serviceAccount.create=false`, templates still reference SA name; verify conditional logic. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/backend/templates/servicemonitor.yaml` — **Type:** Helm template. **Summary:** Creates Prometheus Operator ServiceMonitor when enabled to scrape `/metrics`. **Dependencies:** kube-prometheus-stack CRDs. **Risks/TODOs:** Disabled by default; instrumentation relies on manual flip. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/Chart.yaml` — **Type:** Helm metadata. **Summary:** Mirrors backend chart but scoped to Next.js console. **Dependencies:** Helm release. **Risks/TODOs:** Same version drift concerns as backend; consider appVersion automation. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/values.yaml` — **Type:** Helm values. **Summary:** 2 replicas with autoscaling to 10, HTTPS ingress on `console.rivalapexmediation.com`, feature flag env wiring, PodDisruptionBudget + network policy toggles. **Dependencies:** Console container + TLS secrets. **Risks/TODOs:** `NEXT_PUBLIC_API_URL` placeholder commented—document actual secret requirements; no ServiceMonitor so console metrics scraping left manual. **Evidence:** Reviewed full file 2025‑11‑14.
- `infrastructure/helm/console/templates/_helpers.tpl` — **Type:** Helm helper template mirroring backend helper macros. **Dependencies:** Helm templating. **Risks/TODOs:** Duplicates backend helper logic; consider shared library chart. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/templates/deployment.yaml` — **Type:** Helm template. **Summary:** Builds console Deployment with probes, envFrom secret, blue/green selectors. **Dependencies:** Kubernetes API. **Risks/TODOs:** Does not manage Next.js environment variable configmaps; relies solely on secrets. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/templates/hpa.yaml` — **Type:** Helm template. **Summary:** Standard CPU/memory HPA (2‑10 pods). **Dependencies:** Metrics server. **Risks/TODOs:** No per-env overrides for CPU targets; may under-scale with SSR spikes. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/templates/ingress.yaml` — **Type:** Helm template. **Summary:** TLS ingress for console host with forced SSL redirect annotations. **Dependencies:** NGINX ingress & cert-manager. **Risks/TODOs:** Single host/secret; multi-region deployments need duplication. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/templates/service.yaml` — **Type:** Helm template. **Summary:** ClusterIP service on port 3000 driving ingress. **Dependencies:** Deployment selectors. **Risks/TODOs:** Same color selector risk as backend. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/console/templates/serviceaccount.yaml` — **Type:** Helm template. **Summary:** Optional service account. **Dependencies:** RBAC. **Risks/TODOs:** No podAnnotations ensuring tokens mounted read-only. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/fraud-inference/Chart.yaml` — **Type:** Helm metadata. **Summary:** Chart descriptor for ONNX fraud inference microservice. **Dependencies:** Helm release. **Risks/TODOs:** Repository name is placeholder `fraud-inference`; align with actual image path. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/fraud-inference/values.yaml` — **Type:** Helm values. **Summary:** High-resource pods (4Gi/2cpu) with Prometheus scraping, custom HPA metrics (p95 latency + QPS), model PVC mounts, ServiceMonitor enabled by default, and pod anti-affinity. **Dependencies:** Prometheus custom metrics API, PVC for model artifacts. **Risks/TODOs:** Autoscaling references custom metric names that must exist; ensure adapter exports them or HPA creation will fail. **Evidence:** Reviewed entire file 2025‑11‑14.
- `infrastructure/helm/fraud-inference/templates/_helpers.tpl` — **Type:** Helm helper template. **Summary:** Standard naming helpers for fraud inference resources. **Dependencies:** Helm. **Risks/TODOs:** Keep labels consistent with ServiceMonitor selectors. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/fraud-inference/templates/deployment.yaml` — **Type:** Helm template. **Summary:** Stateful-ish Deployment mounting PVC/configured env, health probes hitting `/health/live` + `/health/ready`, and optional volume mounts for models. **Dependencies:** Kubernetes API + PVC definitions. **Risks/TODOs:** Container port named `http` yet service exposes 80; ensure targetPort matches. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/fraud-inference/templates/hpa.yaml` — **Type:** Helm template. **Summary:** Creates HPA referencing the custom Pod metrics defined in values. **Dependencies:** Custom metrics adapter. **Risks/TODOs:** Without adapter the HPA will remain pending; document requirement. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/helm/fraud-inference/templates/service.yaml` — **Type:** Helm template. **Summary:** ClusterIP service exposing port 8080 internally (mapped to 80). **Dependencies:** Deployment labels. **Risks/TODOs:** Ingress disabled by default so service only usable inside cluster; note for consumers. **Evidence:** Reviewed 2025‑11‑14.

#### Terraform modules

- `infrastructure/terraform/modules/ai-cost-controls/main.tf` — **Type:** Terraform module. **Summary:** Codifies AI spend governance: creates secrets/configmaps for budgets + feature flags, NetworkPolicy restricting OpenAI egress, CronJob for daily Slack alerts, and exposes outputs for downstream deployments. **Dependencies:** Terraform ≥1.5, Kubernetes provider, cluster namespace, Slack/Twilio creds. **Risks/TODOs:** Hard-coded `curl` CronJob depends on Slack webhook; add retry/backoff + auth guard; consider parameterizing CIDR allowlists beyond `0.0.0.0/0`. **Evidence:** Reviewed 2025‑11‑14.
- `infrastructure/terraform/modules/ai-cost-controls/README.md` — **Type:** Doc. **Summary:** Extensive usage guide covering staged rollouts, expected spend table, backup/rollback procedures, and monitoring integrations referencing Prometheus alerts. **Dependencies:** Module code + monitoring stack. **Risks/TODOs:** References `infrastructure/runbooks/AI_COST_CONTROLS.md` which lives outside module; keep cross-links valid when directories move. **Evidence:** Reviewed 2025‑11‑14.


### monitoring/

#### Stack overview

- `monitoring/README.md` — **Type:** Doc. **Summary:** Architecture + quick start for Prometheus, Grafana, Loki, Promtail, Alertmanager with dashboard import + troubleshooting steps. **Dependencies:** Docker Compose, kube-prometheus stack. **Risks/TODOs:** Quick start credentials (admin/admin) should be rotated; ensure README references `.env` secrets file. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/docker-compose.yml` — **Type:** Compose file. **Summary:** Spins up Prometheus, Loki, Promtail, Grafana, Alertmanager, node-exporter, cAdvisor with persisted volumes and provisioned configs. **Dependencies:** Docker, `.env` for Grafana creds. **Risks/TODOs:** Grafana service sets `GF_SERVER_ROOT_URL` to production domain even for local dev; may break login on localhost. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/deploy-monitoring.sh` — **Type:** Bash script. **Summary:** Helper CLI for starting/stopping stack, health checks, backups, alert tests, `.env` bootstrap. **Dependencies:** docker-compose, curl, environment secrets. **Risks/TODOs:** Script auto-creates `.env` with placeholders but exits immediately—document rerun expectations; `backup` subcommand streams tar without gzip validation. **Evidence:** Reviewed 2025‑11‑14.

#### Prometheus, alerting, and logging configs

- `monitoring/alertmanager.yml` — **Type:** Alertmanager config. **Summary:** Routes alerts by severity to founder email/SMS, includes inhibition rules, optional Slack/Discord receivers, and SMTP configuration via Resend. **Dependencies:** Alertmanager container, SMTP creds, Twilio/Slack secrets. **Risks/TODOs:** Secrets embedded as `${VAR}` require env substitution; ensure deployment injects them securely. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/alerts.yml` — **Type:** Prometheus rules. **Summary:** >10 alert groups covering backend, payments, DB, cache, system resources, business KPIs, SDK health, RTB, ClickHouse, queues, and AI cost controls with runbook links. **Dependencies:** Prometheus metrics naming conventions, Grafana dashboards referenced in annotations. **Risks/TODOs:** Some expressions (e.g., `pg_pool_size`) assume exporters emitting specific metrics; validate actual exporters or rules will stay pending. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/prometheus.yml` — **Type:** Prometheus config. **Summary:** Sets scrape/evaluation intervals, wires Alertmanager, loads alerts/recording rules, and defines scrape jobs for backend, console, Postgres exporter, ClickHouse, Redis, node-exporter, cadvisor. **Dependencies:** Target endpoints reachable over public hostnames. **Risks/TODOs:** Scrape targets hard-code Fly.io hostnames; for local compose these hostnames will fail—consider relabeling per environment. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/recording-rules.yml` — **Type:** Prometheus recording rules. **Summary:** Precomputes RED metrics, RTB aggregates, analytics lag, DB/queue KPIs, system resource percentages, and business metrics for dashboards. **Dependencies:** Same metrics as alerts. **Risks/TODOs:** Some expressions subtract rates without guards (could go negative); add `clamp_min`. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/promtail-config.yml` — **Type:** Promtail config. **Summary:** Ships backend/console/system logs, performs JSON parsing + label extraction, and pushes to Loki. **Dependencies:** Host log file paths; Loki endpoint. **Risks/TODOs:** Hard-coded `/var/log/backend/*.log` requires container bind mounts; ensure path exists. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/loki-config.yml` — **Type:** Loki config. **Summary:** Single-binary filesystem-backed Loki with 30-day retention, compactor, query scheduler, and Alertmanager integration. **Dependencies:** Loki container, storage volume. **Risks/TODOs:** `auth_enabled: false`—lock down before exposing publicly; ingestion limits set but not enforced per-tenant. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana-datasources.yml` — **Type:** Grafana provisioning. **Summary:** Registers Prometheus (default), Loki, PostgreSQL, and ClickHouse datasources with TLS requirements and derived fields for trace IDs. **Dependencies:** Grafana container, secrets from `.env`. **Risks/TODOs:** `DATABASE_URL`/`CLICKHOUSE_URL` envs must be present or Grafana boot fails; consider marking Postgres optional. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana-dashboards.yml` — **Type:** Grafana provisioning. **Summary:** Auto-loads dashboards from `/var/lib/grafana/dashboards` with folder mirroring. **Dependencies:** Grafana provisioning sidecar. **Risks/TODOs:** `allowUiUpdates: true` may cause drift between exported JSON and runtime edits; establish export workflow. **Evidence:** Reviewed 2025‑11‑14.

#### Grafana dashboards

- `monitoring/grafana/api_red_dashboard.json` — **Type:** Dashboard JSON. **Summary:** API RED overview with request rate, error rate, and p95 latency panels refreshing every 30s. **Dependencies:** Prometheus metrics `http_request_duration_seconds_*`. **Risks/TODOs:** Lacks templating for service selection; duplicates `red-metrics-by-route`. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana/dashboards/red-metrics-by-route.json` — **Type:** Dashboard JSON. **Summary:** Route-level RED dashboard with request/error rates and latency quantiles plus percentile thresholds. **Dependencies:** Same Prometheus metrics. **Risks/TODOs:** Panel thresholds hard-coded; ensure align with SLOs. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana/db-queue.json` — **Type:** Dashboard JSON. **Summary:** Combines DB latency stats and queue depth/backlog panels using recording rules. **Dependencies:** `db_query_duration_seconds_*`, `queue_*` metrics. **Risks/TODOs:** No templating by queue name; large installs may clutter legends. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana/migration-studio.json` — **Type:** Dashboard JSON. **Summary:** Detailed Migration Studio board with annotations for guardrail pauses, kill switches, experiment metrics, and signup/victory KPIs. **Dependencies:** Custom Prometheus metrics (`migration_guardrail_pauses_total`, etc.). **Risks/TODOs:** 800+ line dashboard requires consistent metric naming; consider exporting to folder-specific ConfigMap for clarity. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana/rtb-overview.json` — **Type:** Dashboard JSON. **Summary:** RTB health view showing auction latency percentiles, total wins, no-fill stats, adapter breakdown tables. **Dependencies:** `auction_latency_seconds`, `rtb_*` metrics. **Risks/TODOs:** Doesn’t expose adapter dropdown; each adapter always graphed. **Evidence:** Reviewed 2025‑11‑14.
- `monitoring/grafana/tracking-ingest.json` — **Type:** Dashboard JSON. **Summary:** Analytics pipeline status (enqueued/written/failed counts, success %, lag charts, per-event breakdown). **Dependencies:** `analytics_events_*` metrics. **Risks/TODOs:** Hard thresholds might not fit production volumes; allow env-specific overrides. **Evidence:** Reviewed 2025‑11‑14.


### logs/

- `logs/combined.log` — **Type:** Log file (JSON lines). **Summary:** Aggregated backend logs from Nov 10 showing DB/Redis init, auction traffic, TransparencyWriter failures, breaker open/close events, graceful shutdowns. **Dependencies:** Backend logging pipeline; consumed by Promtail. **Risks/TODOs:** Log file is checked into repo with real timestamps/errors—scrub sensitive data and rotate to avoid bloat; confirm no secrets present. **Evidence:** Reviewed first 80 lines 2025‑11‑14.
- `logs/error.log` — **Type:** Log file (JSON lines). **Summary:** Error-only stream mirroring combined log issues (queue initialization failures, bid landscape logging errors, transparency disabled). **Dependencies:** Backend error logger, monitoring ingestion. **Risks/TODOs:** Contains stack traces referencing local paths; ensure sanitized before sharing externally. **Evidence:** Reviewed 2025‑11‑14.

### models/

#### Root files

- `models/README.md` — **Type:** Doc. **Summary:** Outlines the internal model registry structure, metadata schema, release flow, and deployment/monitoring guidance for all ML assets. **Dependencies:** References ML training docs (`docs/Internal/ML/ML_TRAINING.md`) and the inference service repo. **Risks/TODOs:** Claims fraud model latest version is `1.0.0`, while the `latest` symlink actually points to `logreg_dev_2`; align the doc with real inventory to avoid confusion. **Evidence:** Reviewed 2025‑11‑14.

#### `models/fraud/`

- `models/fraud/latest` — **Type:** Symlink. **Summary:** Convenience pointer that currently resolves to `models/fraud/logreg_dev_2`, allowing automation to consume the newest promoted bundle. **Dependencies:** Release scripts that dereference `latest` before packaging. **Risks/TODOs:** Nothing enforces atomic updates; document the promotion checklist to prevent dangling symlinks. **Evidence:** Verified via `ls -l` 2025‑11‑14.

##### Versioned releases

- `models/fraud/1.0.0/metadata.json` — **Type:** Metadata (JSON). **Summary:** Production launch metadata for the ONNX-exported scikit-learn classifier (`fraud_detection` v1.0.0) with feature list, training sample counts, latency benchmarks, quantization info, and artifact references. **Dependencies:** Inference service uses this to understand feature schema and deployment SLOs. **Risks/TODOs:** Metadata references supporting artifacts (`model.onnx`, notebooks) that are not committed alongside the JSON—either add them or clarify storage location. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/logreg_dev_2/model_manifest.json` — **Type:** Metadata. **Summary:** Packaging manifest for experimental `logreg_dev_2`, listing every artifact plus SHA256 + byte size to support reproducible deployments. **Dependencies:** Release validator + `validate_export.py` rely on these digests. **Risks/TODOs:** Manifest lacks a signature or signer identity; consider adding to detect tampering. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/logreg_dev_2/train_meta.json` — **Type:** Metadata. **Summary:** Captures training provenance (feature path, folds, ROC/PR metrics per calibration method, chosen threshold 0.021) for the `logreg_dev_2` logistic regression. **Dependencies:** Monitoring dashboards and promotion playbook reference the stored threshold and calibration choice. **Risks/TODOs:** `features_path` uses Windows-style backslashes; normalize to POSIX so Linux tooling doesn’t misinterpret. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/logreg_dev_2/feature_manifest.json` — **Type:** Metadata. **Summary:** Enumerates 50+ engineered features (rolling stats, entropy/burstiness, CTIT buckets, OMSDK metrics) plus parity tags describing whether historical windows are required. **Dependencies:** Feature store + online calculator must stay in sync with this manifest. **Risks/TODOs:** Manifest duplicates the copy under `workdir/features`; document single source of truth to avoid divergence. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/logreg_dev_2/evaluation_metrics.json` — **Type:** Metrics artifact. **Summary:** Full evaluation dump (ROC/PR AUC, exhaustive precision-recall arrays, score histogram) for `logreg_dev_2`, used to populate ML reports. **Dependencies:** Docs in `docs/Internal/ML/Reports` reference these raw metrics. **Risks/TODOs:** File is 4 MB JSON and duplicated under `workdir/model`; consider storing large curves in parquet to keep repo lean. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/logreg_dev_2/logreg_calibrated.pkl` — **Type:** Model artifact (binary). **Summary:** Joblib-serialized logistic regression with post-training calibration ready for server-side inference. **Dependencies:** Fraud inference service loads this alongside `trained_fraud_model.json`. **Risks/TODOs:** Binary is unversioned beyond folder path; embed model hash in metadata to detect corruption. **Evidence:** File present 2025‑11‑14.
- `models/fraud/logreg_dev_2/trained_fraud_model.json` — **Type:** Model weights (JSON). **Summary:** Human-readable export of coefficients, bias, threshold, feature ordering, and calibration summaries so SDKs or auditors can re-run the classifier without python binaries. **Dependencies:** Transparency tooling may surface these weights for audits. **Risks/TODOs:** File exceeds 4 MB and includes redundant precision-recall curve data; consider splitting large arrays. **Evidence:** Reviewed 2025‑11‑14.

##### Monitoring snapshots

- `models/fraud/monitoring/shadow_baseline.json` — **Type:** Monitoring baseline. **Summary:** Stores the reference histogram for fraud shadow scores (20 bins, 400 samples) against which PSI/JSD drift is measured. **Dependencies:** Shadow monitor scripts compare live data to this baseline. **Risks/TODOs:** No checksum or timestamp metadata—add to ensure analysts know when to refresh. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/monitoring/shadow_monitor_20251109_*.json` — **Type:** Monitoring reports. **Summary:** Three timestamped JSON reports capturing drift stats (PSI, JSD, weekly summaries) for successive evaluation windows. **Dependencies:** ML reports referenced in `docs/Internal/ML/Reports` cite these snapshots. **Risks/TODOs:** Growing set of timestamped files will clutter the repo; plan rotation or move to object storage. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/monitoring/shadow_monitor_latest.json` — **Type:** Monitoring report. **Summary:** Auto-updated drift summary (alerting when PSI>2, 29 current records) powering Ops dashboards via Git consumption. **Dependencies:** Monitoring scripts and value-multiplier dashboards. **Risks/TODOs:** Alert flag is true but no linked incident/runbook—ensure on-call guidance references this file. **Evidence:** Reviewed 2025‑11‑14.

##### Training workdir

- `models/fraud/workdir/.last_dataset_fingerprint` — **Type:** Generated checksum. **Summary:** Records SHA256 of the last dataset ingested (0b3bc7f…), letting pipelines skip redundant preprocessing. **Dependencies:** ML Makefile tasks read this before re-running ETL. **Risks/TODOs:** Single-file state can become stale if multiple datasets exist; consider storing manifest per dataset/version. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/workdir/features/feature_manifest.json` — **Type:** Metadata. **Summary:** Duplicate of the feature manifest shipped with `logreg_dev_2`, kept next to `features.parquet` for reproducibility. **Dependencies:** Feature engineering scripts reference this for schema validation. **Risks/TODOs:** Ensure edits happen in one place (preferably source under version control) to avoid skew. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/workdir/features/features.parquet` — **Type:** Dataset (parquet). **Summary:** Engineered feature matrix (≈50k rows) feeding the logistic regression training run. **Dependencies:** Training + evaluation scripts load this file directly. **Risks/TODOs:** Large binary stored in git; consider Git LFS or artifact storage to prevent repo bloat. **Evidence:** File listed 2025‑11‑14.
- `models/fraud/workdir/model/logreg_calibrated.pkl` — **Type:** Model artifact (binary). **Summary:** Working copy of calibrated model prior to promotion; mirrors released artifact for local validation. **Dependencies:** `validate_export.py` ensures this matches the promoted version. **Risks/TODOs:** Redundant binary duplicates top-level release; prune old workdir versions after promotion. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/workdir/model/trained_fraud_model.json` — **Type:** Model weights. **Summary:** Local snapshot of coefficient table used for interpretability notebooks before being copied into release folder. **Dependencies:** Notebook pipelines. **Risks/TODOs:** Without diffing against shipped version, drift may go unnoticed; add checksum comparison to CI. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/workdir/model/train_meta.json` — **Type:** Metadata. **Summary:** Mirrors release `train_meta.json`, ensuring workdir state includes provenance for reruns. **Dependencies:** Training rerun scripts. **Risks/TODOs:** Keep single source to avoid conflicting thresholds. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/workdir/model/evaluation_metrics.json` — **Type:** Metrics artifact. **Summary:** Duplicate large evaluation export for local analysis prior to packaging. **Dependencies:** Jupyter notebooks referencing the workdir path. **Risks/TODOs:** Consider storing only aggregated metrics locally to cut checkout size. **Evidence:** Reviewed 2025‑11‑14.
- `models/fraud/workdir/shadow/shadow_scores.parquet` — **Type:** Dataset. **Summary:** Latest batch of shadow inference scores (parquet) used to compute the monitoring JSON reports. **Dependencies:** `monitor_shadow_scores.py`. **Risks/TODOs:** File likely contains sensitive fraud telemetry—encrypt or relocate outside git. **Evidence:** File listed 2025‑11‑14.

### packages/ & Packages/

#### `packages/web-sdk/`

- `packages/web-sdk/README.md` — **Type:** Doc. **Summary:** Public API overview for the browser SDK (init, setConsent, requestAd, on) plus build artifacts (ESM/UMD/types) and parity list of supported ad networks. **Dependencies:** Points developers to `docs/Adapters/SUPPORTED_NETWORKS.md` for adapter parity and to npm scripts for lint/build/test. **Risks/TODOs:** Explicitly mentions AbortController timeouts but doesn’t surface how to override per request—consider documenting. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/CHANGELOG.md` — **Type:** Doc. **Summary:** Keep-a-changelog file tracking `0.1.0` launch + unreleased roadmap (consent parity, Typedoc upload, Jest/MSW tests). **Dependencies:** Aligns with npm package version. **Risks/TODOs:** Only two sections so far; ensure every publish bumps entry. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/package.json` — **Type:** Config. **Summary:** npm package metadata/export map, Rollup + TypeScript build/lint/test/docs scripts, `zod` runtime dependency, dev tooling (jest, msw, rollup, typedoc). **Dependencies:** Node ≥18, ts-jest ESM preset, Rollup 4. **Risks/TODOs:** `npm run build` chains `tsc` (declarations) + rollup but lacks size checks; consider bundler analyze. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/.eslintrc.json` — **Type:** Config. **Summary:** TypeScript ESLint config w/ parser project refs, import/promise/jsdoc plugins, Prettier finalizer, disables `no-explicit-any` + unresolved import errors. **Dependencies:** `@typescript-eslint/*`, ESLint 8. **Risks/TODOs:** Parser references `tsconfig.json`; ensure IDE uses same path. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/rollup.config.mjs` — **Type:** Build config. **Summary:** Produces ESM + UMD bundles from `src/index.ts` via node-resolve/commonjs/ts plugins with sourcemaps. **Dependencies:** Rollup 4, TypeScript config. **Risks/TODOs:** No minification or filesize guard; add terser if shipping to browsers. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/tsconfig.json` — **Type:** Config. **Summary:** ES2019 target, strict mode, bundler module resolution, DOM libs, noEmit for dev/test, includes `src`, `tests`, `setupTests.ts`. **Dependencies:** TypeScript 5.5, Jest types. **Risks/TODOs:** Because `noEmit` true, build relies on `tsconfig.build.json`; ensure IDE recognizes both. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/tsconfig.build.json` — **Type:** Config. **Summary:** Extends base tsconfig, enables declaration emit to `dist/src`, excludes tests. **Dependencies:** TSC. **Risks/TODOs:** Emits declarations only; Rollup handles JS—document so contributors don’t expect JS output here. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/jest.config.cjs` — **Type:** Test config. **Summary:** ts-jest ESM preset, Node env, collects coverage from `src/**`, uses `setupTests.ts`. **Dependencies:** Jest 29, ts-jest. **Risks/TODOs:** Serial test execution; fine for now but consider jsdom env when DOM APIs needed. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/setupTests.ts` — **Type:** Test util. **Summary:** Intended to boot/shutdown MSW server before/after Jest suites. **Dependencies:** `tests/msw/server`. **Risks/TODOs:** File references `server` without importing it, so hooks throw at runtime—add `import { server } from './tests/msw/server';` (path relative) to prevent ReferenceError. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/index.ts` — **Type:** Source. **Summary:** Maintains SDK singleton state, wires `init`, `setConsent`, `requestAd`, and `on` API, emits lifecycle events, re-exports error helpers/types and supported adapters. **Dependencies:** `events`, `errors`, `auctionClient`, `schemas`, `zod`. **Risks/TODOs:** No guard preventing re-init with different endpoints mid-flight; consider warnings. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/auctionClient.ts` — **Type:** Source. **Summary:** Performs fetch POST to `{endpoint}/auction`, attaches consent/meta, enforces AbortController timeout, validates JSON via `zod` schema, surfaces typed errors. **Dependencies:** `fetch`, AbortController, `Errors`, `AdResponseSchema`. **Risks/TODOs:** Recovers from fetch parsing issues but doesn’t retry/backoff; consider limited retries for transient 5xx. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/errors.ts` — **Type:** Source. **Summary:** Defines `SdkError` class with standardized codes and helper constructors (initRequired, timeout, network, etc.). **Dependencies:** None external. **Risks/TODOs:** `Errors.unknown` takes optional `cause` but not surfaced anywhere; log hooking might help debugging. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/events.ts` — **Type:** Source. **Summary:** Minimal emitter storing handlers per `SdkEvent`, returning unsubscribe closures, swallowing listener errors. **Dependencies:** Type definitions. **Risks/TODOs:** No wildcard/all-events support; fine but document. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/schemas.ts` — **Type:** Source. **Summary:** `zod` schemas for consent+ad request/response payloads plus typed exports. **Dependencies:** `zod`. **Risks/TODOs:** Auction request schema currently unused (server builds request manually)—could reuse for validation before fetch to avoid drift. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/adapters.ts` — **Type:** Source. **Summary:** Static list of 15 supported adapters + helper `getSupportedAdapters`. **Dependencies:** None. **Risks/TODOs:** Keep list in sync with mobile SDK lists; consider centralizing to shared JSON. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/src/types.ts` — **Type:** Source. **Summary:** Exported TypeScript types for consent, init options, ad request/response, event names, used throughout API. **Dependencies:** None. **Risks/TODOs:** Doesn’t expose creative tracking map shape beyond Record<string,string>; adequate for now. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/tests/web-sdk.test.ts` — **Type:** Test. **Summary:** Jest suite using MSW to assert init guard, consent propagation, successful ad flow, and timeout handling. **Dependencies:** `msw`, `server`, SDK exports. **Risks/TODOs:** Doesn’t cover error taxonomy like BAD_RESPONSE or validation failures—add coverage. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/tests/msw/handlers.ts` — **Type:** Test helper. **Summary:** MSW `http.post` handler capturing request bodies + returning mock fill, plus `timeoutHandler` simulating slow server. **Dependencies:** `msw`. **Risks/TODOs:** `state.lastAuctionBody` typed as `any`; could tighten to `Partial<AuctionRequestSchemaType>`. **Evidence:** Reviewed 2025‑11‑14.
- `packages/web-sdk/tests/msw/server.ts` — **Type:** Test helper. **Summary:** Wraps MSW handlers via `setupServer` for Jest. **Dependencies:** `msw/node`. **Risks/TODOs:** Ensure `setupTests.ts` imports this module to register hooks (see note above). **Evidence:** Reviewed 2025‑11‑14.

#### `Packages/com.rivalapexmediation.sdk/`

- `Packages/com.rivalapexmediation.sdk/README.md` — **Type:** Doc. **Summary:** Unity SDK feature overview (ad formats, platforms, consent), install instructions (UPM/git or manual), quick-start sample code, support links. **Dependencies:** References `Documentation~/` guides. **Risks/TODOs:** Quick start uses ScriptableObject creation at runtime—document asset creation workflow for production. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/CHANGELOG.md` — **Type:** Doc. **Summary:** Keep-a-changelog capturing v1.0.0 release scope (ad formats, platform bridges, consent, tooling, tests) plus roadmap. **Dependencies:** Align with package tags `sdk-unity-vX.Y.Z`. **Risks/TODOs:** Known limitations list still claims TCF parsing unimplemented, but runtime includes parser—update to avoid confusion. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/RELEASING.md` — **Type:** Doc. **Summary:** SemVer + tagging instructions, CI automation description, manual tarball creation, pre-tag checklist. **Dependencies:** `.github/workflows/unity-ci.yml`. **Risks/TODOs:** Checklist omits verification of Samples~/ scenes; add to prevent regressions. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/package.json` — **Type:** Config (Unity). **Summary:** Unity package manifest (name/version/display, Unity 2020.3 min, keywords, author, sample definitions). **Dependencies:** Unity Package Manager. **Risks/TODOs:** `dependencies` empty even though package uses UnityEngine.UI types; acceptable but ensure base modules installed. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/.gitignore` — **Type:** Config. **Summary:** Ignores Unity build artifacts/logs within package. **Dependencies:** Git. **Risks/TODOs:** None. **Evidence:** Listed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Documentation~/IL2CPP-TCF-GUIDE.md` — **Type:** Doc. **Summary:** 500+ line guide covering IL2CPP stripping, `link.xml`, build validators, consent parser usage/tests, performance metrics, troubleshooting. **Dependencies:** `Runtime/link.xml`, `TCFParser`. **Risks/TODOs:** Section states TCF parser planned for 1.1.0 even though implemented—align doc vs reality. **Evidence:** Reviewed first 300+ lines 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/ApexMediation.asmdef` — **Type:** Config. **Summary:** Assembly definition restricting runtime code to Android/iOS/tvOS, auto-referenced. **Dependencies:** Unity asmdef system. **Risks/TODOs:** Excludes WebGL/Standalone even though README claims support; consider additional asmdefs or platform inclusion to avoid compile stripping. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/link.xml` — **Type:** Config. **Summary:** Protects all core SDK types, consent models, platform bridges, telemetry, Unity UI components, and .NET helpers from IL2CPP stripping. **Dependencies:** Unity IL2CPP pipeline. **Risks/TODOs:** Comments mention preserving JSON DTOs but `AdResponse` fields renamed (snake_case) – verify attribute names to avoid mismatch. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Core/ApexMediation.cs` — **Type:** Source. **Summary:** Static façade exposing initialization, consent getters, test/debug toggles, `GetDebugInfo`. **Dependencies:** `MediationSDK`, `ConsentManager`, Unity `Application/SystemInfo`. **Risks/TODOs:** `SetDebugLogging` toggles global logger without persisting preference; consider saving to config asset. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Core/MediationSDK.cs` — **Type:** Source. **Summary:** Singleton `MonoBehaviour` orchestrating lifecycle: validates `SDKConfig`, instantiates platform bridge, consent manager, auction client, optional `PerformanceBudgetMonitor`, fetches remote config, handles pause/quit hooks. **Dependencies:** `SDKConfig`, `ConsentManager`, `AuctionClient`, `RemoteConfigClient`, Unity coroutines. **Risks/TODOs:** Initialization coroutine fetches remote config every boot with no caching/backoff; consider background refresh scheduling. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Core/PerformanceBudgetMonitor.cs` — **Type:** Source. **Summary:** Optional `MonoBehaviour` sampling GC allocations (ProfilerRecorder on Unity 2020.2+) and enforcing request/idle budgets, logging warnings on regressions. **Dependencies:** `SDKConfig`, Unity Profiler APIs. **Risks/TODOs:** Falls back to manual samples only when tests call `EvaluateIdleSample`; consider hooking into editor profiling for earlier detection. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Core/RemoteConfigClient.cs` — **Type:** Source. **Summary:** Coroutine client fetching remote config JSON with timeout/auth, stores version, merges minimal data. **Dependencies:** `UnityWebRequest`, `SDKConfig`. **Risks/TODOs:** Merge currently no-op (only version); update before shipping OTA toggles to avoid confusion. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Config/SDKConfig.cs` — **Type:** Source. **Summary:** ScriptableObject storing auth, endpoints, retry/timeouts, ad TTLs, banner refresh, rate limits, privacy defaults, performance budgets; includes `Validate()` sanitizing ranges. **Dependencies:** Unity inspector attributes. **Risks/TODOs:** `ConfigEndpoint` unused after introduction of `RemoteConfigUrl/ApiBaseUrl`; mark obsolete or wire up. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Consent/ConsentManager.cs` — **Type:** Source. **Summary:** Manages GDPR/CCPA/COPPA flags via `PlayerPrefs`, integrates `TCFParser` for purpose/vendor consent, redacts logs, exposes helper predicates. **Dependencies:** `PlayerPrefs`, `TCFParser`. **Risks/TODOs:** `PlayerPrefs.SetString` stores empty string when consent string null; reading back returns empty instead of null—harmless but document. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Network/AuctionClient.cs` — **Type:** Source. **Summary:** UnityWebRequest-based auction client building device info payloads, applying consent, handling retries/backoff, logging, and applying WebGL-specific CORS headers. **Dependencies:** `UnityWebRequest`, `ConsentManager`, `IPlatformBridge`, `PerformanceBudgetMonitor`. **Risks/TODOs:** Recursive retry (`yield return RequestWithRetry`) can stack coroutines; refactor to loop to avoid deep recursion for MaxRetries=3. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Adapters/AdapterRegistry.cs` — **Type:** Source. **Summary:** Lists 15 adapter stubs and exposes helper getters returning `BaseStubAdapter` instances keyed by network. **Dependencies:** Internal `BaseStubAdapter`. **Risks/TODOs:** Only stub implementations exist—document integration steps for concrete adapters to avoid false expectations. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/AdTypes/ApexInterstitial.cs` — **Type:** Source. **Summary:** Static API to load/show interstitials via AuctionClient, storing per-placement instances with TTL enforcement and coroutine-driven mock display. **Dependencies:** `MediationSDK`, `AuctionClient`, `AdResponse`. **Risks/TODOs:** Creative rendering still TODO mock—callout in README but ensure production builds gate features. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Platform/IPlatformBridge.cs` — **Type:** Source. **Summary:** Defines interface for device IDs, advertising IDs, LAT flag, UA, URL opening, dialogs, connection type, and platform name with implementations per platform. **Dependencies:** Platform-specific bridges. **Risks/TODOs:** README claims WebGL/Standalone support, but asmdef excludes them; ensure `StandalonePlatformBridge` compiled on those targets. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Runtime/Telemetry/Logger.cs` — **Type:** Source. **Summary:** Centralized logger toggling debug verbosity and redacting PII via regex, wrapping Unity `Debug`. **Dependencies:** UnityEngine. **Risks/TODOs:** Regex replacements run each call—monitor perf in verbose mode. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Editor/IntegrationValidator.cs` — **Type:** Source. **Summary:** Editor window running checks for SDKConfig, asmdefs, platform manifests, package integrity, presenting pass/warn/error statuses with fixes. **Dependencies:** UnityEditor, AssetDatabase, IO. **Risks/TODOs:** iOS/Android checks compiled under platform defines; when editing on opposite platform they no-op—document to avoid false sense of security. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Editor/IL2CPPBuildValidator.cs` — **Type:** Source. **Summary:** Pre/post build processors verifying link.xml presence, stripping settings, critical types, and DLL size budget; exposes menu items for manual validation and size reports. **Dependencies:** UnityEditor.Build pipeline. **Risks/TODOs:** Size validation looks for filenames containing “RivalApex” which may change after IL2CPP merges; add GUID-based checks for stability. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Editor/SDKConfigInspector.cs` — **Type:** Source. **Summary:** Custom inspector for SDKConfig with validation, quick actions, warnings for test mode, foldout for advanced network/ad behavior settings. **Dependencies:** UnityEditor GUI, IntegrationValidator. **Risks/TODOs:** Inspector doesn’t surface new performance budget fields; add serialized props to maintain parity. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Tests/TEST_SUITE_SUMMARY.md` — **Type:** Doc. **Summary:** Auto-generated overview of 36 NUnit tests (ConsentManager, AdError, Logger, SDK init, ad formats) with instructions for Unity Test Runner & CLI. **Dependencies:** `Tests/Runtime/*.cs`. **Risks/TODOs:** Claims no AuctionClient tests; matches current gaps and should be actioned. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Tests/Runtime/PerformanceBudgetTests.cs` — **Type:** Test. **Summary:** NUnit tests ensuring `PerformanceBudgetMonitor` enforces request payload/idle budgets/regressions using ScriptableObject configs. **Dependencies:** Unity Test Framework. **Risks/TODOs:** `EvaluateIdleSample` baseline test uses same monitor instance without cleaning between asserts—OK but ensure GC recorder disposed after tests. **Evidence:** Reviewed 2025‑11‑14.
- `Packages/com.rivalapexmediation.sdk/Tests/Runtime/WebGLCorsTests.cs` — **Type:** Test. **Summary:** Validates `AuctionClient.ApplyCorsHeaders` sets preflight headers on WebGL and no-ops elsewhere. **Dependencies:** UnityEngine.Networking, NUnit. **Risks/TODOs:** Doesn’t cover HTTP verb other than POST; acceptable. **Evidence:** Reviewed 2025‑11‑14.

> **Note:** `Packages/com.rivalapexmediation.sdk` currently contains 50+ files (Runtime, Editor, Tests, Documentation, Samples). Remaining Runtime/Tests files follow the same patterns described above; future passes should continue line-item verification if more granularity is required.

### quality/

#### Root files

- `quality/go.mod` — **Type:** Config. **Summary:** Declares the Go 1.21 module used for integration/load tests with direct deps on `google/uuid` and `stretchr/testify`. **Dependencies:** Go toolchain, testify assertions. **Risks/TODOs:** Module is named generically (`quality`); if published it could conflict with other paths—keep private. **Evidence:** Reviewed 2025‑11‑14.
- `quality/go.sum` — **Type:** Generated lockfile. **Summary:** Checksums for testify, uuid, go-spew, go-difflib, yaml, ensuring reproducible `go test` runs. **Dependencies:** Go modules proxy. **Risks/TODOs:** Regenerate (`go mod tidy`) whenever dependencies bump to avoid stale hashes. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/integration/`

- `quality/integration/end_to_end_test.go` — **Type:** Test (Go). **Summary:** High-level integration spec covering auction flow, fraud pipeline, payouts, staged config rollout, and load testing using testify asserts. Helper functions (`makeAPIRequest`, `createTestPublisher`, etc.) are stubs, so tests currently serve as living documentation rather than executable coverage. **Dependencies:** `net/http`, `testify`, `uuid`, ClickHouse/Postgres implied. **Risks/TODOs:** Implement helper bodies or import real test clients so the suite runs in CI; otherwise `go test` will panic on `nil` responses. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/e2e/`

- `quality/e2e/billing/usage-to-invoice.spec.ts` — **Type:** E2E test (Playwright). **Summary:** Logs into the console, optionally injects usage via backend API, and verifies invoices UI plus PDF link visibility. **Dependencies:** Playwright, console + backend servers, `API_URL` env for backend. **Risks/TODOs:** Smoke test ignores API failures (best-effort) but still assumes demo creds; parameterize user/password for environments. **Evidence:** Reviewed 2025‑11‑14.
- `quality/e2e/website/visual.spec.ts` — **Type:** Visual regression test. **Summary:** Iterates over light/dark themes, three breakpoints, and five routes capturing screenshots + asserting presence of header/main/footer landmarks. **Dependencies:** Playwright snapshots, website at `localhost:3000`. **Risks/TODOs:** Snapshot baselines must be committed per route; ensure CI artifacts stored for review. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/lighthouse/`

- `quality/lighthouse/website.config.cjs` — **Type:** Config. **Summary:** Lighthouse CI definition collecting a single run per marketing route and enforcing ≥0.9 scores across performance/a11y/best-practices/SEO plus CLS/LCP/FID thresholds; outputs to `.lighthouse-website`. **Dependencies:** `@lhci/cli`, local website instance. **Risks/TODOs:** Single run may flake due to cold caches—consider `numberOfRuns>1` for stability. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/lint/`

- `quality/lint/no-hardcoded-hex.js` — **Type:** Script. **Summary:** Custom lint that recursively scans provided paths for hex color literals outside allowlisted files, failing builds when tokens aren’t sourced from Tailwind. **Dependencies:** Node.js, run via `node quality/lint/no-hardcoded-hex.js <paths>`. **Risks/TODOs:** Currently only looks at file extensions; SCSS or JSON theme files won’t be scanned—extend if needed. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/load-tests/`

- `quality/load-tests/auction-load-test.js` — **Type:** k6 scenario. **Summary:** Posts synthetic RTB bid traffic (default 20 VUs, 1m) to `/rtb/bid`, enforcing p95 <120 ms. **Dependencies:** k6 runtime, JWT token optional for auth. **Risks/TODOs:** Payload uses placeholder placement/devices; align with staging fixtures to catch adapter issues. **Evidence:** Reviewed 2025‑11‑14.
- `quality/load-tests/tracking-load-test.js` — **Type:** k6 scenario. **Summary:** Hammers impression/click tracking endpoints using provided tokens, accepting 204/302/4xx responses to exercise dedupe + rate limits with strict <1 % failure threshold. **Dependencies:** Tokens from backend, k6. **Risks/TODOs:** Without valid signed tokens the run “fails” gracefully but doesn’t validate success path—add setup hook to mint tokens. **Evidence:** Reviewed 2025‑11‑14.
- `quality/load-tests/fraud-smoke-test.js` — **Type:** k6 scenario. **Summary:** Multi-stage load for ML fraud scoring API recording custom latency metrics, high fraud prediction rates, ready-checks, and JSON summary export. **Dependencies:** Fraud scoring service at `BASE_URL`. **Risks/TODOs:** Handles summary writes to `/tmp`; ensure CI runners allow file output. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/perf/billing/`

- `quality/perf/billing/invoices-api.js` — **Type:** k6 perf test. **Summary:** Constant-arrival 100 RPS GET benchmark for `/billing/invoices` enforcing p95<200 ms and <0.1 % failures. **Dependencies:** Billing API + dataset seeded with invoices. **Risks/TODOs:** Hard-coded org ID; parameterize to avoid hitting non-existent tenant. **Evidence:** Reviewed 2025‑11‑14.
- `quality/perf/billing/usage-api.js` — **Type:** k6 perf test. **Summary:** Mirrors invoices test for `/billing/usage/current` to catch regressions in metering queries. **Dependencies:** Node env for API_BASE. **Risks/TODOs:** Doesn’t authenticate—expect 401; consider injecting JWT to exercise happy path. **Evidence:** Reviewed 2025‑11‑14.
- `quality/perf/billing/pdf-load.js` — **Type:** k6 perf test. **Summary:** Exercises invoice PDF endpoint with optional If-None-Match header to test caching. **Dependencies:** Billing API, valid `INVOICE_ID`. **Risks/TODOs:** Mutates `__ENV.K6_ETAG` globally; acceptable per-VU but note when running multiple scripts concurrently. **Evidence:** Reviewed 2025‑11‑14.

#### `quality/tools/`

- `quality/tools/capture-website-screenshots.js` — **Type:** Utility script. **Summary:** Uses Playwright (Chromium/optional Firefox/WebKit) to capture themed, multi-viewport screenshots for website routes, ensuring header/main/footer exist. **Dependencies:** Node.js, Playwright browsers, running website at `WEBSITE_BASE_URL`. **Risks/TODOs:** Saves output under timestamped `artifacts/website-screenshots`—clean up periodically to avoid bloat. **Evidence:** Reviewed 2025‑11‑14.

### scripts/

#### Root files

- `scripts/README.md` — **Type:** Doc. **Summary:** 500+ line catalog of every script (dev, deployment, billing, infra, ML) including inputs, prerequisites, idempotency guarantees, and exit codes. **Dependencies:** References backend/console services, AWS, Stripe. **Risks/TODOs:** Keep descriptions synced with actual script behavior when flags/envs change. **Evidence:** Reviewed 2025‑11‑14.

- `scripts/capture-console.sh` — **Type:** Script (bash). **Summary:** Installs dependencies, builds/starts console on port 3001, then reuses Playwright screenshot tool to snapshot admin routes. **Dependencies:** Node 18, npm, Playwright Chromium, curl, `quality/tools/capture-website-screenshots.js`. **Risks/TODOs:** Runs `npm ci` in root + console every call (slow); consider caching. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/capture-website.sh` — **Type:** Script. **Summary:** Same flow for marketing website: install deps, build, start on port 3000, collect screenshots for core routes. **Dependencies:** Node 18, Playwright. **Risks/TODOs:** Hard-coded routes; allow route override env like console script. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/dev-transparency-metrics.sh` — **Type:** Script. **Summary:** End-to-end transparency smoke test: spins up Postgres/Redis/ClickHouse via compose, migrates schema, boots backend with aggressive transparency sampling, seeds successes/failures, then asserts Prometheus + JSON metrics contain expected counters. **Dependencies:** Docker Compose v2, Node (for JWT generation), python3, backend build artifacts. **Risks/TODOs:** Embeds a private key literal directly in script—move to env/fixture to avoid accidental exposure. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/install-accounting-deps.sh` — **Type:** Script. **Summary:** Installs Stripe, PDFKit, AWS S3 SDK, fast-xml-parser, date-fns (and PDFKit types) inside backend workspace to support accounting automations, printing next steps. **Dependencies:** npm, backend directory write access. **Risks/TODOs:** Uses `npm install @latest` which mutates `package.json/package-lock`; run through review before committing. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/ios-docs.sh` — **Type:** Script. **Summary:** Generates iOS SDK docs via Swift-DocC (pref) or Jazzy fallback, archives to `build/ios-docs.zip`. **Dependencies:** Swift toolchain, DocC plugin or `jazzy`, zip. **Risks/TODOs:** Requires module `RivalApexMediationSDK` scheme; ensure name stays in sync with Package.swift. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/run-billing-migrations.sh` — **Type:** Script. **Summary:** Sequentially runs SQL migrations 017/018 via `psql`, then lists resulting tables. **Dependencies:** `DATABASE_URL`, PostgreSQL client. **Risks/TODOs:** Hard-coded migration numbers—remember to extend script when new billing migrations land. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/setup-s3-accounting.sh` — **Type:** Script. **Summary:** Provisions/updates accounting S3 bucket with Object Lock compliance (7-year), versioning, encryption, lifecycle policies, tags. **Dependencies:** AWS CLI with perms. **Risks/TODOs:** Prompts before modifying existing bucket but still enforces compliance mode; document irreversible nature for operators. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/validate-billing-tests.sh` — **Type:** Script. **Summary:** Friendly reporting wrapper verifying presence/counts of billing-related frontend/backend files, referencing sections 7.1–7.5, printing LOC metrics. **Dependencies:** bash, `wc`, `find`, `cat`, project tree. **Risks/TODOs:** Paths are hard-coded; update as files move to avoid false negatives. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/validate-deployment.sh` — **Type:** Script. **Summary:** Comprehensive pre-deploy checklist printing PASS/WARN/FAIL per database, build, AI cost controls, docs, services, security, and infra; intentionally keeps `set +e` to continue after failures. **Dependencies:** bash, npm, terraform/k8s files, environment variables. **Risks/TODOs:** Some checks assume exact counts (e.g., 14 migrations) and may break as repo evolves—consider parameterizing. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/verify-billing-wiring.sh` — **Type:** Script. **Summary:** Greps for service files, exports, route registrations, feature flags, and console billing client to ensure everything is wired; fails fast on missing imports. **Dependencies:** bash, `grep`. **Risks/TODOs:** Doesn’t actually hit runtime endpoints—pure file presence; pair with API tests for stronger guarantee. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/verify-console-connection.sh` — **Type:** Script. **Summary:** Validates backend health, console `.env.local`, dependency installs, and hits several API endpoints (auth, placements, analytics, queues) to confirm connectivity. **Dependencies:** curl, jq, backend & console servers. **Risks/TODOs:** Hard-coded demo creds for login call; mask or externalize for security. **Evidence:** Reviewed 2025‑11‑14.

#### `scripts/ml/`

- `scripts/ml/fetch_enrichment.sh` — **Type:** Script. **Summary:** Thin wrapper around `python -m ML.scripts.fetch_enrichment`, ensuring repo root on `PYTHONPATH`. **Dependencies:** Python 3, ML package. **Risks/TODOs:** Relies on `PYTHON` env for custom interpreters; document usage. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/ml/prepare_dataset.py` — **Type:** Script (Python). **Summary:** Builds offline feature datasets from enrichment manifests via `OfflineFeatureBuilder`, optionally dry-running, then exercises `OnlineFeatureCalculator` to validate lookups. **Dependencies:** Internal ML modules, pandas. **Risks/TODOs:** Hard-coded sample columns (`network`); guard for missing column to avoid KeyError. **Evidence:** Reviewed 2025‑11‑14.
- `scripts/ml/train_models.py` — **Type:** Script. **Summary:** CLI for fraud model training; parses training hyperparameters, builds `TrainingConfig`, calls `train_models`, and prints manifest metadata. **Dependencies:** pandas, `ml_pipelines.models`. **Risks/TODOs:** Doesn’t validate dataset path existence before constructing config—add early check for nicer errors. **Evidence:** Reviewed 2025‑11‑14.

### sdk/ & sdks/

#### `sdk/adapters/`

- `sdk/adapters/admob/AdMobAdapter.kt` — **Type:** Source (Kotlin). **Summary:** Full-featured AdMob adapter implementing `AdNetworkAdapter` with one-time initialization, configurable request keywords, and support for banner/interstitial/rewarded ads, mapping callbacks into the shared `Ad` model. **Dependencies:** Google Mobile Ads SDK 22+, Android Context, shared models/callbacks. **Risks/TODOs:** Custom targeting helper is a stub (AdMob lacks APIs) yet method name implies functionality; doesn’t expose paid event info so eCPM always `0.0`, which can mis-rank waterfall ordering. **Evidence:** Reviewed 2025‑11‑14.
- `sdk/adapters/applovin/AppLovinAdapter.kt` — **Type:** Source. **Summary:** AppLovin MAX adapter wiring consent flags and MAX listeners for banners/interstitials/rewarded units while surfacing revenue via `MaxAd.revenue`. **Dependencies:** AppLovin SDK 11+, AppLovin privacy APIs. **Risks/TODOs:** Singleton `AppLovinSdk` reused globally—multi-process apps may require manual init; reward callbacks currently no-op (no reward dispatch to host). **Evidence:** Reviewed 2025‑11‑14.
- `sdk/adapters/facebook/FacebookAdapter.kt` — **Type:** Source. **Summary:** Meta Audience Network adapter covering banner/interstitial/rewarded/native formats with GDPR toggles, placement-based size selection, and `Ad` objects carrying Meta-specific handles for rendering. **Dependencies:** Meta Audience Network SDK 6+, `AdSettings`. **Risks/TODOs:** eCPM field also stubbed to `0.0`; native load path lacks view binder utility; debugging logs absent, making production triage harder. **Evidence:** Reviewed 2025‑11‑14.
- `sdk/adapters/ironsource/IronSourceAdapter.kt` — **Type:** Source. **Summary:** IronSource adapter handling consent, metadata, listener wiring, and circuit-breaker-friendly callbacks for interstitial/rewarded placements with optional banner support flag. **Dependencies:** IronSource SDK ≥7.2, Activity context, shared `AdLoadCallback`. **Risks/TODOs:** Requires `Activity` context to initialize and throws otherwise; uses single pending callback—parallel loads will clobber each other; revenue/eCPM data absent. **Evidence:** Reviewed 2025‑11‑14.

#### `sdk/core/android/`

- `sdk/core/android/src/main/kotlin/MediationSDK.kt` — **Type:** Source (Kotlin). **Summary:** Central Android SDK singleton that enforces strict-mode policies, loads remote config (`ConfigManager`), initializes adapters, manages telemetry, consent, S2S auction fallback, per-adapter circuit breakers, and placement caches before invoking callbacks on the main thread. **Dependencies:** Android handlers/StrictMode, `ConfigManager`, `TelemetryCollector`, `AuctionClient`, Kotlin coroutines/executors. **Risks/TODOs:** Many helper calls (`makeAPIRequest`, etc.) referenced in integration docs remain TODO; auction fallback hard-codes interstitial options; ad cache only stores single entry per placement with manual expiry. **Evidence:** Reviewed 2025‑11‑14.
- `sdk/core/android/src/main/kotlin/AdapterRegistry.kt` — **Type:** Source. **Summary:** Thread-safe registry for `AdAdapter` implementations with register/get/shutdown operations used by `MediationSDK`. **Dependencies:** `ConcurrentHashMap`, shared adapter interfaces. **Risks/TODOs:** Does not auto-populate adapters; callers must register manually; shutdown swallows exceptions silently. **Evidence:** Reviewed 2025‑11‑14.
- `sdk/core/android/src/main/kotlin/BelInterstitial.kt` and `BelRewarded.kt` — **Type:** Source. **Summary:** Thin public facades providing `load/show/isReady` APIs, storing last placement, consuming cached ads, and kicking off OM SDK sessions around `Ad.show()` placeholders. **Dependencies:** `MediationSDK`, OM SDK registry, Android Activity/Context. **Risks/TODOs:** Only the most recent placement is tracked, so multi-placement apps must manage caches themselves; show path assumes `Ad.show` implemented by adapters, currently placeholder. **Evidence:** Reviewed 2025‑11‑14.
- Remaining directories (`config/`, `telemetry/`, `network/`, `measurement/`, `threading/`, etc.) contain config signature verification, telemetry emitters, OM SDK helpers, executor utilities, and sample strict-mode app wiring plus Gradle/proguard configs for distribution. **Risks/TODOs:** Several packages remain stubs (e.g., measurement controllers) and ProGuard rules need audit once adapters start shipping. **Evidence:** Directory inspection 2025‑11‑14.

#### `sdk/core/ios/`

- `sdk/core/ios/Sources/MediationSDK.swift` — **Type:** Source (Swift). **Summary:** Main Swift actor orchestrating initialization, config signature verification, adapter registry wiring, telemetry collection, consent/test mode state, remote config refresh, and adapter load loops with latency/error taxonomy instrumentation. **Dependencies:** Swift Concurrency, `ConfigManager`, `TelemetryCollector`, `AdapterRegistry`, `SignatureVerifier`. **Risks/TODOs:** Explicitly throws on repeated `initialize` instead of acting idempotently; ad caching unimplemented (TODO); adapters are initialized eagerly from config with no hot-reload path. **Evidence:** Reviewed 2025‑11‑14.
- Supporting directories provide adapter shims, consent storage, networking, telemetry, threading, plus docs (`README`, `CHANGELOG`, `CONTRIBUTING`, `DISTRIBUTION`) and Demo project. **Risks/TODOs:** Need automated `swift test` lane and DocC pipeline to keep docs synchronized; some submodules still skeletal. **Evidence:** Directory skim 2025‑11‑14.

#### `sdk/core/unity/`

- `sdk/core/unity/package.json` — **Type:** Config (UPM). **Summary:** Declares scoped package metadata for Unity Editor tooling. **Dependencies:** Unity Package Manager. **Risks/TODOs:** No runtime assemblies or entrypoints yet—package is Editor-only scaffold. **Evidence:** Reviewed 2025‑11‑14.
- `sdk/core/unity/Editor/MediationManagerWindow.cs` — **Type:** Source (C#). **Summary:** Simple `EditorWindow` stub exposing placeholder buttons for placements/adapters/payouts accessible via `Platform/Mediation Manager`. **Dependencies:** UnityEditor API. **Risks/TODOs:** Buttons only log to console; runtime API + adapter wiring still TODO; add asmdef + tests before publishing. **Evidence:** Reviewed 2025‑11‑14.

#### `sdk/ctv/`

- `sdk/ctv/README.md` — **Type:** Doc. **Summary:** Describes Android TV/tvOS SDK scaffolding status, initialization stubs, consent handling, performance targets, and next steps toward feature parity. **Dependencies:** CTV modules. **Risks/TODOs:** Highlights missing telemetry/AuctionClient parity; track these items in backlog. **Evidence:** Reviewed 2025‑11‑14.
- `sdk/ctv/android-tv/src/main/kotlin/com/rivalapexmediation/ctv/ApexMediation.kt` — **Type:** Source. **Summary:** Kotlin singleton for CTV platform managing init, consent manager, auction client, OTA config, and providing synchronous getter helpers for renderers. **Dependencies:** Android TV Context/Looper, local consent + config classes. **Risks/TODOs:** Remote config load is best-effort but silently swallows errors; renderers (`VideoRenderer`, `ImageRenderer`) are placeholders. **Evidence:** Reviewed 2025‑11‑14.
- Additional Kotlin files cover config DTOs, consent parsing (TCF), network DTOs, render beacons, and adapter scaffolds; `tvos/` folder mirrors Swift Package skeleton awaiting implementation. **Risks/TODOs:** tvOS codebase largely TODO; ensure parity before distribution. **Evidence:** Directory inspection 2025‑11‑14.

#### `sdks/ios/`

- `sdks/ios/Tests/ApexMediationTests/ConsentPropagationTests.swift` — **Type:** Test. **Summary:** Mocks URLSession via `MockURLProtocol` to assert consent metadata is embedded in auction payloads and taxonomy for 204 no-fill remains consistent. **Dependencies:** XCTest, ApexMediation module. **Risks/TODOs:** Only positive consent scenario tested; add cases for missing/false consent strings. **Evidence:** Reviewed 2025‑11‑14.
- `sdks/ios/Tests/ApexMediationTests/TaxonomyAndMainQueueTests.swift` — **Type:** Test. **Summary:** Ensures HTTP 429/5xx map to taxonomy-specific errors and that BelInterstitial completions execute on the main queue. **Dependencies:** XCTest, ApexMediation, `BelInterstitial`. **Risks/TODOs:** Doesn’t cover retry logic or concurrency; consider adding stress tests for repeated requests. **Evidence:** Reviewed 2025‑11‑14.

### services/

#### `services/fraud-inference/`

- `services/fraud-inference/main.py` — **Type:** Source (FastAPI). **Summary:** CPU-optimized fraud inference microservice with structured logging, Prometheus RED metrics (per-endpoint counters/histograms), health/readiness endpoints, ONNXRuntime scoring for single/batch payloads, and configurable thresholds loaded from metadata. **Dependencies:** FastAPI, onnxruntime, numpy, prometheus-client, joblib. **Risks/TODOs:** Assumes model + metadata exist under `/app/models/...`; service refuses requests if missing but offers no download automation; `/v1/score` lacks auth/tenant scoping; config errors bubble as 500. **Evidence:** Reviewed 2025‑11‑14.
- `services/fraud-inference/requirements.txt` — **Type:** Config. **Summary:** Pins FastAPI 0.115, uvicorn 0.34, pydantic 2.10, prometheus-client 0.21, onnxruntime 1.21, numpy 1.26. **Dependencies:** pip installs. **Risks/TODOs:** No hash verification; mixing FastAPI + Pydantic version ranges could break compatibility during updates. **Evidence:** Reviewed 2025‑11‑14.
- `services/fraud-inference/Dockerfile` — **Type:** Config. **Summary:** Python 3.10 slim base installing requirements, copying app, setting non-root user, exposing 8080, and defining healthcheck using inline Python `requests` import. **Dependencies:** Debian apt (libgomp1), pip. **Risks/TODOs:** Healthcheck imports `requests` but dependency not installed—either pip install requests or switch to `curl`; model assets commented out (mount via volume). **Evidence:** Reviewed 2025‑11‑14.

#### `services/inference-ml/`

- `services/inference-ml/README.md` — **Type:** Doc. **Summary:** Detailed operator guide (features, quick start, Docker/K8s/Helm instructions, API examples, metrics, configuration, monitoring, troubleshooting) for the multi-model inference service. **Dependencies:** FastAPI app + Helm chart. **Risks/TODOs:** Example responses assume mock predictions; update once real models shipped to avoid confusion. **Evidence:** Reviewed 2025‑11‑14.
- `services/inference-ml/main.py` — **Type:** Source (FastAPI). **Summary:** Multi-endpoint inference API with structured logging middleware, Prometheus metrics (requests/latency/errors/model load), health + metrics endpoints, `/predict/fraud|ctr|bid` routes returning placeholder predictions, and `/models` metadata list populated at startup. **Dependencies:** FastAPI, Pydantic, structlog, prometheus-client. **Risks/TODOs:** Currently returns mock values (TODO); no authentication or rate limits; metrics not multiprocess-safe; relies on global `models` dict with no dynamic reload. **Evidence:** Reviewed 2025‑11‑14.
- `services/inference-ml/requirements.txt` — **Type:** Config. **Summary:** Pins FastAPI 0.109, uvicorn 0.27, torch 2.1.2, scikit-learn 1.4, onnxruntime 1.16, redis 5, structlog 24, numpy 1.26, enabling broader ML workloads. **Dependencies:** pip. **Risks/TODOs:** Mixing heavy torch + scikit-learn inflates image size (>2 GB) on slim base; consider optional extras for GPU builds. **Evidence:** Reviewed 2025‑11‑14.
- `services/inference-ml/Dockerfile` — **Type:** Config. **Summary:** Python 3.10 slim base installing requirements, copying repo, adding curl-based healthcheck, exposing 8000/9090, and running uvicorn with two workers. **Dependencies:** Apt curl, pip. **Risks/TODOs:** Runs as root; consider non-root user; healthcheck hitting `/health` may succeed even if models unloaded—add readiness variant. **Evidence:** Reviewed 2025‑11‑14.
- `services/inference-ml/helm/ml-inference/values.yaml` — **Type:** Config. **Summary:** Helm defaults for deploying the service (image repo/tag, autoscaling, probes, Prometheus annotations, PVC for models, ServiceMonitor, PDB). **Dependencies:** Helm, Kubernetes, Prometheus Operator. **Risks/TODOs:** Defaults use `latest` tag; set version-pin in CI/CD; PVC name hard-coded (`ml-models-pvc`)—document requirement. **Evidence:** Reviewed 2025‑11‑14.

### website/
- `website/README.md` — **Type:** Doc. **Summary:** 900-line onboarding + marketing spec covering homepage sections, dashboard features, design tokens, commands, API routes, testing targets, and performance/security OKRs. **Dependencies:** References `Design.md`, `WEBSITE_DESIGN.md`, project scripts. **Risks/TODOs:** Contains dated claims (e.g., “all dashboards complete,” “zero errors”) and hard-coded metrics; schedule regular reviews so status stays truthful. **Evidence:** Reviewed 2025‑11‑14.
- `website/Design.md` — **Type:** Doc (visual spec). **Summary:** Study-in-Sweden design recipe detailing palette, typography, layout motifs (notification bar, scalloped dividers), component recipes, responsive rules, and implementation checklist. **Dependencies:** Tailwind config, component library. **Risks/TODOs:** Purely prescriptive; update when UI diverges so designers/devs don’t follow stale guidance. **Evidence:** Reviewed 2025‑11‑14.
- `website/WEBSITE_DESIGN.md` — **Type:** Doc (technical design). **Summary:** Backend integration blueprint describing auth flows, API contracts, dashboard functionality, realtime plans, and code snippets for `auth.ts`, API routes, and middleware. **Dependencies:** Backend `/api/v1/*`, Next.js App Router. **Risks/TODOs:** Documents aspirational endpoints (realtime, analytics) not yet wired—label roadmap sections to avoid misinterpretation. **Evidence:** Reviewed 2025‑11‑14.
- `website/PROJECT_STATUS.md` — **Type:** Doc. **Summary:** Status report listing completed features (design system, homepage, auth, dashboards) with detailed per-page capability descriptions and next-step checklist. **Dependencies:** Website implementation, design docs. **Risks/TODOs:** Reads like marketing copy, asserting ML accuracy/uptime before telemetry exists; ensure metrics tie to real data. **Evidence:** Reviewed 2025‑11‑14.
- `website/PHASE_1_COMPLETE.md` — **Type:** Doc. **Summary:** Phase 1 closeout describing auth system, dashboard shell, files touched, test plans, future revenue/analytics goals, and backend integration requirements. **Dependencies:** `src/lib/auth.ts`, API auth routes, middleware. **Risks/TODOs:** Needs follow-up addenda for later phases or archival to prevent confusion about current scope. **Evidence:** Reviewed 2025‑11‑14.
- `website/UI_IMPLEMENTATION_AUDIT.md` — **Type:** Doc. **Summary:** 500+ line gap analysis comparing current UI to `Design.md`, enumerating missing components (notification bar, cookie banner, footer) and per-page compliance status. **Dependencies:** Design spec + actual React components. **Risks/TODOs:** Last audited 2025‑11‑04; rerun after new UI work so backlog reflects reality. **Evidence:** Reviewed 2025‑11‑14.
- `website/DEPLOYMENT_CHECKLIST.md` — **Type:** Doc. **Summary:** End-to-end release checklist covering local validation, env setup, quality gates, Vercel deploy, DNS, monitoring/SEO, and post-launch verification with commands/scripts. **Dependencies:** `scripts/deploy.sh`, `scripts/monitor.sh`, Vercel, GitHub Actions. **Risks/TODOs:** Includes unchecked tasks (responsive tests, SEO submission) and placeholder env secrets; enforce completion tracking. **Evidence:** Reviewed 2025‑11‑14.
- `website/SECURITY.md` — **Type:** Doc. **Summary:** Security posture summary with npm audit snapshot, vulnerability table, mitigation steps, response plan, compliance roadmap, and contacts. **Dependencies:** `npm audit`, Next security headers. **Risks/TODOs:** States CSP/helmet pending despite partial CSP in `next.config.js`; keep doc aligned with implementation + rerun audits regularly. **Evidence:** Reviewed 2025‑11‑14.
- `website/.env.example` — **Type:** Config template. **Summary:** Sample environment values for public API/console/site URLs, analytics toggles, feature flags, plus placeholders for server secrets (API/SENDGRID/STRIPE). **Dependencies:** Next env system, Vercel secrets. **Risks/TODOs:** Mixing public (`NEXT_PUBLIC_*`) and server-only secrets in one file risks confusion; add comments or split templates to prevent leaking sensitive values client-side. **Evidence:** Reviewed 2025‑11‑14.
- `website/.github/workflows/deploy.yml` — **Type:** CI config. **Summary:** GitHub Actions workflow running lint, type-check, tests, Next build, uploading artifacts, and invoking Vercel preview/prod deploys with PR comments. **Dependencies:** Node 18, npm ci, Vercel CLI, repository secrets (VERCEL_* + NEXT_PUBLIC_*). **Risks/TODOs:** Each job reinstalls dependencies, lengthening CI; introduce caching or composite actions; ensure secrets exist or deployments fail. **Evidence:** Reviewed 2025‑11‑14.
- `website/package.json` — **Type:** Config. **Summary:** Next.js workspace manifest with scripts (dev/build/start/lint/type-check/analyze/vercel deploy/test) plus deps (Next 14, React, Heroicons, axios, framer-motion) and dev tooling (ESLint, Jest, Tailwind, Vercel CLI). **Dependencies:** Node ≥18/npm ≥9. **Risks/TODOs:** `npm test` references Jest but there’s no jest config/tests beyond security header check; either add coverage or drop script. **Evidence:** Reviewed 2025‑11‑14.
- `website/package-lock.json` — **Type:** Generated lockfile. **Summary:** npm lock ensuring deterministic installs for website workspace. **Dependencies:** npm CLI. **Risks/TODOs:** Must be regenerated with each dependency update; rerun `npm audit` after changes. **Evidence:** Verified presence 2025‑11‑14.
- `website/next.config.js` — **Type:** Config. **Summary:** Next settings enabling strict mode, env defaults, i18n (en/et), security headers (HSTS, CSP, permissions), redirects, optional bundle analyzer, experimental CSS/package import optimizations. **Dependencies:** Next build runtime, `@next/bundle-analyzer`. **Risks/TODOs:** CSP hardcodes `'self'` for scripts/styles, blocking GA/Hotjar referenced elsewhere; add nonce or `connect-src` exceptions when integrating analytics. **Evidence:** Reviewed 2025‑11‑14.
- `website/tailwind.config.ts` — **Type:** Config. **Summary:** Tailwind theme defining Study-in-Sweden tokens (colors, font sizes, animations, container sizing) and scanning src/pages/components/app directories. **Dependencies:** Tailwind 3. **Risks/TODOs:** `plugins` array empty though README references forms/typography utilities; add official plugins or remove docs references. **Evidence:** Reviewed 2025‑11‑14.
- `website/tsconfig.json` — **Type:** Config. **Summary:** Strict TS settings (ES2020 target, bundler resolution, Next plugin, path aliases) with `allowJs` enabled and noEmit builds for App Router. **Dependencies:** TypeScript compiler. **Risks/TODOs:** Allowing JS can hide stray legacy files—disable once migration complete to keep codebase pure TS. **Evidence:** Reviewed 2025‑11‑14.
- `website/vercel.json` — **Type:** Deploy config. **Summary:** Declares Vercel build (Next) with simple route rewrites, env secret aliases, and region pin to `arn1`. **Dependencies:** Vercel platform. **Risks/TODOs:** Routes section redundant (source/dest identical) and env placeholders require defined secrets; confirm before deployment. **Evidence:** Reviewed 2025‑11‑14.
- `website/public/Logo.jpg` — **Type:** Asset. **Summary:** Brand logo consumed by about/contact sections via `/Logo.jpg`. **Dependencies:** Static Next public assets. **Risks/TODOs:** Only JPEG available despite docs recommending WebP/AVIF alternatives; add optimized formats for Lighthouse targets. **Evidence:** Verified file 2025‑11‑14.
- `website/public/README.md` — **Type:** Doc. **Summary:** Notes how to place static assets, warns to update about/contact when renaming `Logo.jpg`, and suggests supplying modern image formats. **Dependencies:** Next static serving. **Risks/TODOs:** Doesn’t mention favicons/OpenGraph images referenced in deployment checklist; extend once added. **Evidence:** Reviewed 2025‑11‑14.
- `website/scripts/deploy.sh` — **Type:** Script. **Summary:** Bash deployment helper handling prereq checks, npm install/test/build, Vercel preview/prod deploys, and post-deploy monitoring with colored logs. **Dependencies:** Node/npm, Vercel CLI, curl. **Risks/TODOs:** Runs `npm install` inside `scripts/` dir due to `cd $(dirname "$0")`, so dependencies install in wrong place; adjust to `cd "$repo_root"` before npm commands. **Evidence:** Reviewed 2025‑11‑14.
- `website/scripts/monitor.sh` — **Type:** Script. **Summary:** Bash health monitor polling site via curl, logging latency, checking SSL expiry, optional Lighthouse runs, and emailing alerts. **Dependencies:** curl, openssl, bc, optional `lhci`, `mail`. **Risks/TODOs:** Uses macOS-specific `date -j` flag and writes logs relative to script directory; ensure portability for Linux CI hosts. **Evidence:** Reviewed 2025‑11‑14.
- `website/src/app/dashboard/layout.tsx` — **Type:** Source (layout component). **Summary:** Server layout that enforces authentication with `requireAuth` before rendering, redirecting unauthenticated visitors to `/signin`, and wraps all nested dashboard routes inside `DashboardLayoutFrame` so shared nav/chrome stays consistent. **Dependencies:** `DashboardLayoutFrame` UI shell, `requireAuth` helper, Next.js `redirect`. **Risks/TODOs:** Redirect happens client-side after catching any error, so legitimate server issues also send users to `/signin`; consider differentiating auth failures vs unexpected errors and adding logging/telemetry. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/page.tsx` — **Type:** Source (server page). **Summary:** Dashboard landing view that greets the signed-in user via `getSession`, embeds `RevenueOverview`, shows placeholder stat cards with static `$0` data, and a getting-started checklist encouraging onboarding steps. **Dependencies:** `RevenueOverview` component, `getSession` auth helper, Tailwind/Study-in-Sweden styles, local `StatCard` + `ChecklistItem` components. **Risks/TODOs:** Metrics are hard-coded zeros and checklists are non-interactive, so live tenants get misleading data; add real API hooks and completion tracking before exposing to customers. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/observability/overview/page.tsx` — **Type:** Source (client component). **Summary:** Live observability overview that polls adapter time-series + SLO status every 5 s via `auctionApi`, renders per-adapter sparkline cards with estimated p95 latency, request volume, error/fill rates, and surfaces CRIT/WARN SLO badges with dismissible alert banners. **Dependencies:** `website/src/lib/auctionApi.ts` helpers (`getAdapterMetricsTimeSeries`, `getAdapterSLO`), React hooks (`useEffect`, `useMemo`), Study-in-Sweden Tailwind theme, shared helpers inside the same file (`Sparkline`, `estimateP95`). **Risks/TODOs:** Polling interval is hard-coded (5 s) with no abort or exponential backoff, so slow APIs can stack requests; Sparkline renders in SVG but lacks empty-state aria descriptions; error messaging is generic and doesn’t differentiate between SLO vs time-series failures. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/revenue/page.tsx` — **Type:** Source (client page). **Summary:** Revenue dashboard with time-range toggle, stat cards, mock bar charts, top apps/networks lists, and payout summary, all currently driven by static demo data seeded in-component. **Dependencies:** React state, Heroicons outline set, shared Study-in-Sweden Tailwind utilities, internal helper components defined in file. **Risks/TODOs:** Entire experience runs on mock objects so no API integration, currency localization, or accessibility for charts; payout CTA links to `/dashboard/settings?tab=payouts` which doesn’t exist yet. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/analytics/page.tsx` — **Type:** Source (client page). **Summary:** Analytics dashboard providing key metrics cards, engagement funnel, platform/country breakdowns, ad-format performance, and “live” activity tiles using static arrays and UI-only sparkline bars. **Dependencies:** React state, Heroicons, Tailwind components defined locally (`MetricCard`, `FunnelStep`, etc.). **Risks/TODOs:** Metrics and funnels are fixed numbers with no data fetching; sparkline bars are decorative divs lacking aria labels; real-time indicator never checks actual WebSocket/stream so may mislead operators. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/ab-tests/page.tsx` — **Type:** Source (client page). **Summary:** A/B testing showcase listing mock experiments with summary cards, variant comparisons, Bayesian confidence, lift calculations, and explanatory copy about Bayesian + Thompson Sampling methods. **Dependencies:** React state hooks, Heroicons, local helper components for cards/bars, Study-in-Sweden styling utilities. **Risks/TODOs:** All experiment data is hard-coded so “Create New Test” button does nothing and lift/confidence values don’t reflect backend analytics; component lacks pagination/search for large suites and surfaces potentially misleading marketing claims (e.g., “30% faster”) without real telemetry. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/fraud/page.tsx` — **Type:** Source (client page). **Summary:** Fraud detection dashboard showing ML stats, fraud type breakdowns, country lists, timeline of recent events, and feature weights, entirely backed by static demo arrays. **Dependencies:** React state, Heroicons, local helper components (`StatCard`, `FraudTypeBar`, etc.). **Risks/TODOs:** Demo data includes geo flags/IPs hard-coded in UI, which could confuse actual customers; there’s no API wiring to real fraud services, and accessibility for color-only severity indicators is lacking. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/apps/page.tsx` — **Type:** Source (client page). **Summary:** Apps management surface with mock portfolio list, summary cards, interactive cards for configure/resume/fix flows, SDK integration guide, and modal that reuses placeholder copy + fake SDK keys. **Dependencies:** React state, Heroicons, Tailwind UI components defined inline (`AppCard`, `AppModal`). **Risks/TODOs:** Entire dataset lives in component state with duplicated app names, so no backend truth or pagination; modal actions just show text with static SDK key format; resume/fix handlers arbitrarily mutate mock numbers without persistence. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/apps/[id]/page.tsx` — **Type:** Source (client page). **Summary:** Placeholder detail page that reads the dynamic `id` param and renders a simple card instructing users to check documentation, with only a back button link. **Dependencies:** Next App Router `useParams`, `next/link`, Tailwind components. **Risks/TODOs:** No data fetching or error handling if ID missing; linking to docs rather than actual app configuration is confusing for users clicking through from the modal. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/networks/page.tsx` — **Type:** Source (client page). **Summary:** Ad network management UI listing mock integrations, KPIs, and instructions on adding networks with configure/view buttons that currently don’t connect to APIs. **Dependencies:** React state, Heroicons, inline `NetworkCard` helper, Study-in-Sweden styles. **Risks/TODOs:** Data is static so statuses, revenue, and sync times never reflect real connectors; “Add Network” button has no handler; error/inactive cards don’t expose remediation workflows or logging. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/placements/page.tsx` — **Type:** Source (client page). **Summary:** Ad placement management experience that seeds eight mock placements, calculates KPI tiles, exposes format filter chips, renders a “format heatmap,” placement cards with metrics/actions, and a modal for create/configure/detail flows, plus static best-practices content. **Dependencies:** React `useState`, Heroicons (`PlusCircleIcon`, `CheckCircleIcon`, `XCircleIcon`), inline helper components (`FormatHeatmapCard`, `PlacementCard`, `PlacementModal`), Study-in-Sweden Tailwind utilities. **Risks/TODOs:** Entire workflow is local state with no API persistence—activating/configuring placements just mutates mock data; currency/metric formatting is US-centric and avg eCPM math divides by impressions without zero guards; modal “create” path only shows instructions and “configure/view” links jump to placeholder detail/doc pages. Needs real CRUD endpoints, accessibility review for emoji-only labels, telemetry, and integration with backend placement controller. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/placements/[id]/page.tsx` — **Type:** Source (client page). **Summary:** Detail stub that reads the dynamic placement ID via `useParams`, presents placeholder copy promising future analytics, and offers links back to the placements list or documentation. **Dependencies:** Next App Router `useParams`, `next/link`, Study-in-Sweden button styles. **Risks/TODOs:** No data loading or validation—invalid IDs render indistinguishable page; lacks breadcrumbs, metrics, or edit actions even though list cards promise “View Details”; must be replaced with real analytics/config UI before GA. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/observability/metrics/page.tsx` — **Type:** Source (client component). **Summary:** Tabular adapter metrics dashboard that refreshes every 5 s or on demand, showing request/success/no-fill/timeout counts, latency percentiles, and error breakdowns using data from `auctionApi.getAdapterMetrics()`. **Dependencies:** `website/src/lib/auctionApi.ts`, React state/effects, Tailwind table styling utilities shared across dashboard pages. **Risks/TODOs:** Error lists render raw reason keys without localization or grouping; table lacks virtualization/pagination so large adapter fleets could re-render hundreds of rows every poll; no accessibility summaries describing column purpose for screen readers. **Evidence:** Reviewed file 2025‑11‑14.
- `website/src/app/dashboard/observability/debugger/page.tsx` — **Type:** Source (client component). **Summary:** Mediation debugger console with placement/limit filters that polls debug events every 5 s, groups them by adapter, and displays request/response snippets, timing JSON, and outcome chips for recent auctions to aid troubleshooting. **Dependencies:** `website/src/lib/auctionApi.ts` (`getMediationDebugEvents`), React hooks (`useState`, `useEffect`, `useMemo`), Tailwind grid utilities, helper components defined inline (`OutcomeChip`, `CodeBlock`, `CodeInline`). **Risks/TODOs:** Request/response bodies are stringified wholesale with no redaction—PII may leak if API returns sensitive fields; polling never stops when tab hidden and lacks AbortController cleanup; grouping logic reverses arrays on every render which can be expensive with large datasets. **Evidence:** Reviewed file 2025‑11‑14.

### Remaining folders / verification
> _Pending detailed review._

### infrastructure/, monitoring/, logs/
> _Pending detailed review._